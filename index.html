<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is Now a Good Time? | Job Search Timing</title>
    
    <!-- FOIT Prevention: Apply theme BEFORE body renders -->
    <script>
        (function() {
            const saved = localStorage.getItem('dashboard-theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = saved || (prefersDark ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <style>
        /* ========================================
           CSS CUSTOM PROPERTIES - DARK (DEFAULT)
           ======================================== */
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --bg-card: #161620;
            --text-primary: #e8e8ed;
            --text-secondary: #9898a8;
            --text-muted: #606070;
            
            /* Base accent colors */
            --accent-green: #00d9a0;
            --accent-green-dim: rgba(0, 217, 160, 0.12);
            --accent-yellow: #ffc940;
            --accent-yellow-dim: rgba(255, 201, 64, 0.12);
            --accent-orange: #ff8c40;
            --accent-orange-dim: rgba(255, 140, 64, 0.12);
            --accent-red: #ff4d6a;
            --accent-red-dim: rgba(255, 77, 106, 0.12);
            --accent-blue: #4d9fff;
            --border-color: #28283a;
            
            /* Text-on-background accent variants */
            --accent-green-text: #00d9a0;
            --accent-yellow-text: #ffc940;
            --accent-orange-text: #ff8c40;
            --accent-red-text: #ff4d6a;
            
            /* Chart-specific */
            --chart-grid: rgba(255, 255, 255, 0.04);
            --chart-tooltip-bg: rgba(22, 22, 32, 0.95);
            --chart-tooltip-border: #28283a;
            
            /* Sparkline colors */
            --sparkline-good: #00d9a0;
            --sparkline-neutral: #ffc940;
            --sparkline-bad: #ff4d6a;
            
            /* Noise overlay */
            --noise-opacity: 0.025;
            
            /* Theme transition */
            --theme-transition: 200ms ease;
        }

        /* ========================================
           LIGHT MODE OVERRIDES
           ======================================== */
        [data-theme="light"] {
            --bg-primary: #f5f6f8;
            --bg-secondary: #ffffff;
            --bg-tertiary: #ecedf0;
            --bg-card: #ffffff;
            
            --text-primary: #1a1a2e;
            --text-secondary: #5a5a6e;
            --text-muted: #8888a0;
            
            --border-color: #d8dae0;
            
            /* Adjusted dim colors for light backgrounds */
            --accent-green-dim: rgba(0, 160, 112, 0.12);
            --accent-yellow-dim: rgba(180, 140, 0, 0.15);
            --accent-orange-dim: rgba(220, 120, 40, 0.12);
            --accent-red-dim: rgba(220, 60, 80, 0.12);
            
            /* Darker text variants for readability on white */
            --accent-green-text: #00a070;
            --accent-yellow-text: #c99700;
            --accent-orange-text: #d2691e;
            --accent-red-text: #dc3545;
            
            /* Chart-specific */
            --chart-grid: rgba(0, 0, 0, 0.06);
            --chart-tooltip-bg: rgba(255, 255, 255, 0.95);
            --chart-tooltip-border: #d8dae0;
            
            /* Sparkline colors - adjusted for light bg */
            --sparkline-good: #00a070;
            --sparkline-neutral: #b48c00;
            --sparkline-bad: #dc3545;
            
            /* Hide noise in light mode */
            --noise-opacity: 0;
        }

        /* Skeleton loading animation */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Screen reader only - visually hidden but accessible */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles for keyboard navigation */
        .accordion-trigger:focus,
        .about-header:focus {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }

        .accordion-trigger:focus:not(:focus-visible),
        .about-header:focus:not(:focus-visible) {
            outline: none;
        }

        .skeleton {
            background: linear-gradient(90deg, 
                var(--bg-tertiary) 25%, 
                rgba(255,255,255,0.08) 50%, 
                var(--bg-tertiary) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
        }

        .skeleton-text {
            height: 1em;
            display: inline-block;
            min-width: 60px;
        }

        .skeleton-score {
            width: 80px;
            height: 4.5rem;
            display: inline-block;
        }

        .skeleton-badge {
            width: 120px;
            height: 32px;
            border-radius: 20px;
        }

        /* Hide dynamic content until JS loads - prevents FOUC */
        .js-loading .metric-value,
        .js-loading .score-value,
        .js-loading .score-verdict,
        .js-loading .score-change,
        .js-loading .action-content,
        .js-loading .context-value:not(:last-child),
        .js-loading .recovery-summary,
        .js-loading #decompositionList,
        .js-loading #triggerList,
        .js-loading #sensitivityList,
        .js-loading .data-freshness {
            visibility: hidden;
        }

        .js-loading .skeleton {
            visibility: visible;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            transition: background var(--theme-transition), color var(--theme-transition);
        }

        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: var(--noise-opacity);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            z-index: 1000;
            transition: opacity var(--theme-transition);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        header {
            margin-bottom: 32px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 24px;
            transition: border-color var(--theme-transition);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        h1 {
            font-family: 'Instrument Serif', serif;
            font-size: 2.2rem;
            font-weight: 400;
            letter-spacing: -0.02em;
            color: var(--text-primary);
        }

        .header-meta {
            text-align: right;
        }

        .last-updated {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 4px;
            display: block;
            margin-bottom: 6px;
            transition: background var(--theme-transition), color var(--theme-transition);
        }

        .next-update {
            font-size: 0.6rem;
            color: var(--text-muted);
            transition: color var(--theme-transition);
        }

        .data-freshness {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.6rem;
            margin-top: 4px;
        }

        .freshness-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .freshness-dot.fresh {
            background: var(--accent-green);
            box-shadow: 0 0 4px var(--accent-green);
        }

        .freshness-dot.stale {
            background: var(--accent-yellow);
            box-shadow: 0 0 4px var(--accent-yellow);
        }

        .freshness-dot.old {
            background: var(--accent-orange);
            box-shadow: 0 0 4px var(--accent-orange);
        }

        .freshness-text {
            color: var(--text-muted);
        }

        .freshness-text.fresh { color: var(--accent-green-text); }
        .freshness-text.stale { color: var(--accent-yellow-text); }
        .freshness-text.old { color: var(--accent-orange-text); }

        /* Theme Toggle Button */
        .theme-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-top: 8px;
            transition: all var(--theme-transition);
        }

        .theme-toggle:hover {
            background: var(--border-color);
            color: var(--text-secondary);
        }

        .theme-toggle svg {
            width: 14px;
            height: 14px;
        }

        .theme-toggle .icon-sun {
            display: none;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }
        
        .theme-toggle .icon-moon {
            display: block;
            fill: currentColor;
        }
        
        [data-theme="light"] .theme-toggle .icon-sun { display: block; }
        [data-theme="light"] .theme-toggle .icon-moon { display: none; }

        .subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
            max-width: 700px;
        }

        /* Collapsible About Section */
        .about-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 24px;
            overflow: hidden;
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .about-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            cursor: pointer;
            user-select: none;
            transition: background var(--theme-transition);
        }

        .about-header:hover {
            background: var(--bg-tertiary);
        }

        .about-header h2 {
            font-family: 'Instrument Serif', serif;
            font-size: 1.1rem;
            font-weight: 400;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: color var(--theme-transition);
        }

        .about-toggle {
            font-size: 0.7rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color var(--theme-transition);
        }

        .about-toggle .icon {
            transition: transform 0.2s ease;
        }

        .about-section.collapsed .about-toggle .icon {
            transform: rotate(-90deg);
        }

        .about-content {
            padding: 0 24px 24px 24px;
            display: grid;
            grid-template-columns: 1.4fr 1fr;
            gap: 32px;
        }

        .about-section.collapsed .about-content {
            display: none;
        }

        .about-main p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 10px;
            transition: color var(--theme-transition);
        }

        .about-main p:last-child {
            margin-bottom: 0;
        }

        .about-main strong {
            color: var(--text-primary);
        }

        .about-main em {
            color: var(--accent-yellow-text);
            font-style: normal;
        }

        .about-note {
            font-size: 0.7rem !important;
            color: var(--text-muted) !important;
            margin-top: 12px !important;
        }

        .about-how {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px 20px;
            transition: background var(--theme-transition);
        }

        .about-how h3 {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 12px;
            transition: color var(--theme-transition);
        }

        .about-how ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .about-how li {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            padding-left: 0;
            transition: color var(--theme-transition);
        }

        .about-how li strong {
            color: var(--text-primary);
        }

        /* Hero Score Section */
        .hero-score {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 28px 32px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .hero-score::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-orange) 33%, var(--accent-yellow) 66%, var(--accent-green));
        }

        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .score-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 8px;
            transition: color var(--theme-transition);
        }

        .score-display {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .score-value {
            font-size: 4.5rem;
            font-weight: 700;
            line-height: 1;
            font-variant-numeric: tabular-nums;
            transition: color var(--theme-transition);
        }

        .score-approx {
            font-size: 1.5rem;
            font-weight: 400;
            color: var(--text-muted);
            margin-right: -4px;
            transition: color var(--theme-transition);
        }

        .score-value.good-time { color: var(--accent-green-text); }
        .score-value.worth-exploring { color: var(--accent-yellow-text); }
        .score-value.build-your-position { color: var(--accent-orange-text); }
        .score-value.tough-market { color: var(--accent-red-text); }

        .score-max {
            font-size: 1.2rem;
            color: var(--text-muted);
            transition: color var(--theme-transition);
        }

        .score-meta {
            text-align: right;
        }

        .score-verdict {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
            transition: background var(--theme-transition), color var(--theme-transition), border-color var(--theme-transition);
        }

        .score-verdict.good-time {
            background: var(--accent-green-dim);
            color: var(--accent-green-text);
            border: 1px solid var(--accent-green);
        }

        .score-verdict.worth-exploring {
            background: var(--accent-yellow-dim);
            color: var(--accent-yellow-text);
            border: 1px solid var(--accent-yellow);
        }

        .score-verdict.build-your-position {
            background: var(--accent-orange-dim);
            color: var(--accent-orange-text);
            border: 1px solid var(--accent-orange);
        }

        .score-verdict.tough-market {
            background: var(--accent-red-dim);
            color: var(--accent-red-text);
            border: 1px solid var(--accent-red);
        }

        .verdict-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .verdict-icon.good-time { background: var(--accent-green); }
        .verdict-icon.worth-exploring { background: var(--accent-yellow); }
        .verdict-icon.build-your-position { background: var(--accent-orange); }
        .verdict-icon.tough-market { background: var(--accent-red); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .score-change {
            font-size: 0.75rem;
            color: var(--text-muted);
            transition: color var(--theme-transition);
        }

        /* What Should I Do Section */
        .action-section {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 20px 24px;
            transition: background var(--theme-transition);
        }

        .action-header {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color var(--theme-transition);
        }

        .action-content {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.7;
            transition: color var(--theme-transition);
        }

        .action-content strong {
            color: var(--text-primary);
        }

        .action-list {
            margin-top: 12px;
            padding-left: 0;
            list-style: none;
        }

        .action-list li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .action-list li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--accent-green-text);
            font-size: 0.7rem;
        }

        .action-section.build-your-position .action-list li::before,
        .action-section.tough-market .action-list li::before {
            content: '→';
            color: var(--text-muted);
        }

        /* Score Guide (expandable) */
        .score-guide {
            padding-top: 16px;
            margin-top: 20px;
            border-top: 1px solid var(--border-color);
            transition: border-color var(--theme-transition);
        }

        .score-guide-trigger {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 0.65rem;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            background: none;
            border: none;
            width: 100%;
            font-family: 'JetBrains Mono', monospace;
            transition: color var(--theme-transition);
        }

        .score-guide-trigger:hover {
            color: var(--text-secondary);
        }

        .score-guide-trigger:focus {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }

        .score-guide-trigger:focus:not(:focus-visible) {
            outline: none;
        }

        .score-guide-content {
            display: none;
            margin-top: 12px;
        }

        .score-guide-content.show {
            display: block;
        }

        .score-guide-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        @media (max-width: 600px) {
            .score-guide-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .score-guide-item {
            text-align: center;
            padding: 12px 10px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            border-top: 2px solid;
            transition: background var(--theme-transition);
        }

        .score-guide-item.green { border-top-color: var(--accent-green); }
        .score-guide-item.yellow { border-top-color: var(--accent-yellow); }
        .score-guide-item.orange { border-top-color: var(--accent-orange); }
        .score-guide-item.red { border-top-color: var(--accent-red); }

        .score-guide-item.current {
            background: var(--bg-primary);
            box-shadow: inset 0 0 0 1px var(--border-color);
        }

        .score-guide-range {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            transition: color var(--theme-transition);
        }

        .score-guide-feel {
            font-size: 0.7rem;
            color: var(--text-muted);
            line-height: 1.4;
            transition: color var(--theme-transition);
        }

        /* Main Chart */
        .main-chart {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .chart-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            transition: color var(--theme-transition);
        }

        .chart-legend {
            display: flex;
            gap: 16px;
            font-size: 0.65rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }

        .legend-dot.green { background: var(--accent-green); }
        .legend-dot.yellow { background: var(--accent-yellow); }
        .legend-dot.orange { background: var(--accent-orange); }
        .legend-dot.red { background: var(--accent-red); }

        .chart-container {
            position: relative;
            height: 320px;
        }

        /* Tier Sections */
        .tier-section {
            margin-bottom: 32px;
        }

        .tier-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .tier-badge {
            font-size: 0.55rem;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: rgba(77, 159, 255, 0.15);
            color: var(--accent-blue);
            border: 1px solid rgba(77, 159, 255, 0.3);
        }

        .tier-title {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .tier-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-left: 4px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            overflow: hidden; /* Prevent chart overflow */
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .metric-info h3 {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            transition: color var(--theme-transition);
        }

        .metric-info .description {
            font-size: 0.65rem;
            color: var(--text-muted);
            transition: color var(--theme-transition);
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            flex-shrink: 0;
            transition: color var(--theme-transition);
        }

        .metric-value.good { color: var(--accent-green-text); }
        .metric-value.neutral { color: var(--accent-yellow-text); }
        .metric-value.bad { color: var(--accent-red-text); }

        .metric-delta {
            font-size: 0.65rem;
            font-weight: 500;
            margin-left: 6px;
            padding: 2px 5px;
            border-radius: 3px;
            font-variant-numeric: tabular-nums;
            transition: color var(--theme-transition), background var(--theme-transition);
        }

        .metric-delta.up {
            color: var(--accent-green-text);
            background: var(--accent-green-dim);
        }

        .metric-delta.down {
            color: var(--accent-red-text);
            background: var(--accent-red-dim);
        }

        .metric-delta.flat {
            color: var(--text-muted);
            background: var(--bg-tertiary);
        }

        /* For inverted metrics where down is good */
        .metric-delta.up.inverted {
            color: var(--accent-red-text);
            background: var(--accent-red-dim);
        }

        .metric-delta.down.inverted {
            color: var(--accent-green-text);
            background: var(--accent-green-dim);
        }

        .metric-chart-wrapper {
            display: flex;
            align-items: stretch;
            gap: 6px;
            margin-top: 8px;
            width: 100%;
            max-width: 100%;
        }

        .metric-chart {
            height: 80px;
            flex: 1;
            min-width: 0;
            max-width: calc(100% - 38px); /* Account for sparkline-range width + gap */
            position: relative;
        }

        .sparkline-range {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 0.55rem;
            color: var(--text-muted);
            text-align: right;
            padding: 2px 0;
            min-width: 32px;
        }

        .sparkline-range .max,
        .sparkline-range .min {
            font-variant-numeric: tabular-nums;
        }

        .sparkline-time {
            display: flex;
            justify-content: space-between;
            font-size: 0.5rem;
            color: var(--text-muted);
            margin-top: 4px;
            padding: 0 2px;
            opacity: 0.7;
        }

        /* How Does This Compare Section */
        .context-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .context-header {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            transition: color var(--theme-transition);
        }

        .context-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
        }

        .context-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            transition: background var(--theme-transition);
        }

        .context-label {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 4px;
            transition: color var(--theme-transition);
        }

        .context-value {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            transition: color var(--theme-transition);
        }

        .context-value.highlight {
            color: var(--accent-yellow-text);
        }

        /* Path to Better Section */
        .recovery-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .recovery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
            transition: border-color var(--theme-transition);
        }

        .recovery-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            transition: color var(--theme-transition);
        }

        .distance-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.7rem;
            font-weight: 600;
            background: var(--accent-yellow-dim);
            color: var(--accent-yellow);
            border: 1px solid rgba(255, 201, 64, 0.3);
        }

        .recovery-summary {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.6;
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .recovery-summary strong {
            color: var(--text-primary);
        }

        .recovery-summary .trend-positive {
            color: var(--accent-green);
            font-weight: 600;
        }

        .recovery-summary .trend-negative {
            color: var(--accent-red);
            font-weight: 600;
        }

        .recovery-summary .trend-neutral {
            color: var(--accent-yellow);
            font-weight: 600;
        }

        .recovery-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .recovery-grid {
                grid-template-columns: 1fr;
            }
        }

        .recovery-panel {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px;
        }

        .panel-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        /* Score Decomposition */
        .decomposition-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .decomposition-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric-name {
            font-size: 0.7rem;
            color: var(--text-secondary);
            width: 100px;
            flex-shrink: 0;
        }

        .metric-current {
            font-size: 0.65rem;
            color: var(--text-muted);
            width: 45px;
            flex-shrink: 0;
            font-variant-numeric: tabular-nums;
        }

        .metric-bar-container {
            flex: 1;
            height: 8px;
            background: var(--bg-primary);
            border-radius: 4px;
            overflow: hidden;
        }

        .metric-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .metric-bar.good { background: var(--accent-green); }
        .metric-bar.neutral { background: var(--accent-yellow); }
        .metric-bar.poor { background: var(--accent-orange); }
        .metric-bar.bad { background: var(--accent-red); }

        .metric-score {
            font-size: 0.65rem;
            color: var(--text-muted);
            width: 28px;
            text-align: right;
        }

        .decomposition-footnote {
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            font-size: 0.6rem;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .footnote-marker {
            color: var(--accent-yellow);
            font-weight: 600;
        }

        /* Trigger Conditions */
        .trigger-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .trigger-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: var(--bg-primary);
            border-radius: 6px;
            border-left: 3px solid var(--text-muted);
        }

        .trigger-item.watching {
            border-left-color: var(--accent-yellow);
        }

        .trigger-item.met {
            border-left-color: var(--accent-green);
        }

        .trigger-icon {
            font-size: 0.7rem;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .trigger-item .trigger-icon {
            background: var(--bg-tertiary);
            color: var(--text-muted);
        }

        .trigger-item.watching .trigger-icon {
            background: var(--accent-yellow-dim);
            color: var(--accent-yellow);
        }

        .trigger-item.met .trigger-icon {
            background: var(--accent-green-dim);
            color: var(--accent-green);
        }

        .trigger-content {
            flex: 1;
        }

        .trigger-condition {
            font-size: 0.75rem;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .trigger-status {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        .trigger-trend {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
            font-size: 0.6rem;
        }

        .trend-arrow {
            font-weight: 700;
            font-size: 0.75rem;
        }

        .trend-history {
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        .trigger-trend.trend-good .trend-arrow { color: var(--accent-green); }
        .trigger-trend.trend-bad .trend-arrow { color: var(--accent-red); }
        .trigger-trend.trend-flat .trend-arrow { color: var(--text-muted); }

        /* Sensitivity / What Would It Take */
        .sensitivity-intro {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 12px;
            font-style: italic;
        }

        .sensitivity-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .sensitivity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: var(--bg-primary);
            border-radius: 6px;
        }

        .sensitivity-scenario {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .sensitivity-result {
            font-size: 0.75rem;
            font-weight: 600;
        }

        .sensitivity-result.positive { color: var(--accent-green); }
        .sensitivity-result.neutral { color: var(--accent-yellow); }
        .sensitivity-result.negative { color: var(--accent-orange); }

        /* Understanding the Score Accordion */
        .accordion-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .accordion-header {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .accordion-item {
            border-bottom: 1px solid var(--border-color);
        }

        .accordion-item:last-child {
            border-bottom: none;
        }

        .accordion-trigger {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 16px 24px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            text-align: left;
        }

        .accordion-trigger:hover {
            background: var(--bg-tertiary);
        }

        .accordion-trigger .icon {
            color: var(--text-muted);
            transition: transform 0.2s ease;
            font-size: 0.6rem;
        }

        /* CSS Chevron */
        .chevron {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-right: 2px solid var(--text-muted);
            border-bottom: 2px solid var(--text-muted);
            transform: rotate(45deg);
            transition: transform 0.2s ease;
            margin-bottom: 2px;
        }

        .accordion-item.open .chevron,
        .about-section.collapsed .chevron {
            transform: rotate(-135deg);
            margin-bottom: -2px;
        }

        .about-section:not(.collapsed) .chevron {
            transform: rotate(45deg);
        }

        .accordion-item.open .accordion-trigger .icon {
            transform: rotate(180deg);
        }

        .accordion-panel {
            display: none;
            padding: 0 24px 20px 24px;
        }

        .accordion-item.open .accordion-panel {
            display: block;
        }

        .accordion-panel p {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .accordion-panel p:last-child {
            margin-bottom: 0;
        }

        .accordion-panel ul {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .accordion-panel li {
            margin-bottom: 6px;
        }

        .accordion-panel strong {
            color: var(--text-primary);
        }

        .accordion-panel a {
            color: var(--accent-blue);
            text-decoration: none;
        }

        .accordion-panel a:hover {
            text-decoration: underline;
        }

        .formula-block {
            margin-top: 16px;
            padding: 14px 16px;
            background: var(--bg-primary);
            border-radius: 8px;
            border-left: 3px solid var(--accent-blue);
        }

        .formula-block strong {
            display: block;
            margin-bottom: 8px;
            font-size: 0.7rem;
        }

        .formula-block code {
            display: block;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--accent-yellow);
            background: var(--bg-tertiary);
            padding: 10px 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            overflow-x: auto;
        }

        .formula-block p {
            font-size: 0.65rem;
            margin-bottom: 8px;
        }

        .formula-block a {
            font-size: 0.65rem;
        }

        /* Footer */
        footer {
            text-align: left;
            padding: 28px 0;
            font-size: 0.7rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border-color);
            margin-top: 20px;
            transition: color var(--theme-transition), border-color var(--theme-transition);
        }

        .footer-content {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr;
            gap: 32px;
            margin-bottom: 20px;
        }

        .footer-content strong {
            color: var(--text-secondary);
            display: block;
            margin-bottom: 6px;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            transition: color var(--theme-transition);
        }

        .footer-about {
            line-height: 1.6;
        }

        .footer-links a {
            color: var(--accent-blue);
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .footer-bottom {
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.65rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .about-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .chart-legend {
                justify-content: flex-start;
            }

            .recovery-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .score-value {
                font-size: 3rem;
            }
            
            .score-approx {
                font-size: 1.2rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .header-top {
                flex-direction: column;
                gap: 12px;
            }

            .header-meta {
                text-align: left;
            }

            .context-grid {
                grid-template-columns: 1fr 1fr;
            }

            .chart-legend {
                gap: 8px;
                font-size: 0.55rem;
            }

            .legend-item {
                gap: 4px;
            }

            .legend-dot {
                width: 8px;
                height: 8px;
            }

            .score-header {
                flex-direction: column;
                gap: 16px;
            }

            .score-meta {
                text-align: left;
            }

            .tier-header {
                flex-wrap: wrap;
            }

            .tier-subtitle {
                width: 100%;
                margin-left: 0;
                margin-top: 4px;
            }

            .accordion-trigger {
                padding: 14px 16px;
                font-size: 0.75rem;
            }

            .accordion-panel {
                padding: 0 16px 16px 16px;
            }

            .recovery-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .sensitivity-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .trigger-trend {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .context-grid {
                grid-template-columns: 1fr;
            }

            .chart-legend {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .about-how ul {
                font-size: 0.7rem;
            }

            .action-list li {
                font-size: 0.75rem;
            }

            .metric-header {
                flex-direction: column;
                gap: 8px;
            }

            .metric-value {
                font-size: 1.5rem;
            }

            .sparkline-range {
                font-size: 0.5rem;
                min-width: 28px;
            }

            .metric-chart {
                max-width: calc(100% - 34px); /* Smaller range column on mobile */
            }

            .metric-card {
                padding: 16px;
            }
        }

        /* Print styles */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            body {
                background: white !important;
                color: #1a1a1a !important;
                font-size: 11pt;
            }

            .noise-overlay {
                display: none !important;
            }

            .container {
                max-width: 100%;
                padding: 0;
            }

            /* Hide interactive elements */
            .about-section,
            .accordion-section,
            .chevron,
            .about-toggle,
            footer {
                display: none !important;
            }

            /* Header adjustments */
            header {
                border-bottom: 2px solid #333;
                padding-bottom: 12px;
                margin-bottom: 16px;
            }

            h1 {
                color: #1a1a1a !important;
                font-size: 24pt;
            }

            .subtitle {
                color: #444 !important;
            }

            .header-meta {
                text-align: left;
                margin-top: 8px;
            }

            .last-updated {
                background: none !important;
                padding: 0;
                color: #666 !important;
                display: inline;
            }

            .next-update,
            .data-freshness {
                display: none;
            }

            /* Hero score */
            .hero-score {
                background: #f5f5f5 !important;
                border: 1px solid #ccc !important;
                page-break-inside: avoid;
            }

            .hero-score::before {
                display: none;
            }

            .score-value {
                color: #1a1a1a !important;
            }

            .score-verdict {
                background: none !important;
                border: 1px solid currentColor !important;
            }

            .action-section {
                background: #f9f9f9 !important;
                border-color: #999 !important;
            }

            /* Charts - hide sparklines, keep main chart */
            .metric-chart-wrapper,
            .sparkline-time,
            .sparkline-range {
                display: none !important;
            }

            /* Metric cards as compact list */
            .metrics-grid {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
            }

            .metric-card {
                background: #f5f5f5 !important;
                border: 1px solid #ddd !important;
                padding: 8px !important;
                page-break-inside: avoid;
            }

            .metric-header {
                flex-direction: column;
                gap: 2px;
            }

            .metric-info h3 {
                font-size: 9pt;
                color: #333 !important;
            }

            .metric-info .description {
                display: none;
            }

            .metric-value {
                font-size: 14pt !important;
            }

            .metric-delta {
                display: none;
            }

            /* Main chart */
            .main-chart {
                background: white !important;
                border: 1px solid #ccc !important;
                page-break-inside: avoid;
            }

            .chart-title {
                color: #1a1a1a !important;
            }

            .chart-legend {
                font-size: 8pt;
            }

            .legend-dot {
                border: 1px solid #999;
            }

            /* Context section */
            .context-section {
                background: #f5f5f5 !important;
                border: 1px solid #ccc !important;
                page-break-inside: avoid;
            }

            .context-header {
                color: #1a1a1a !important;
            }

            .context-item {
                background: white !important;
            }

            .context-label {
                color: #666 !important;
            }

            .context-value {
                color: #1a1a1a !important;
            }

            /* Recovery section */
            .recovery-section {
                background: #f5f5f5 !important;
                border: 1px solid #ccc !important;
                page-break-before: always;
            }

            .recovery-panel {
                background: white !important;
            }

            .trigger-item,
            .sensitivity-item {
                background: #f9f9f9 !important;
            }

            /* Tier sections */
            .tier-badge {
                background: none !important;
                border: 1px solid currentColor !important;
            }

            .tier-title,
            .tier-subtitle {
                color: #333 !important;
            }

            /* Page breaks */
            .tier-section {
                page-break-inside: avoid;
            }

            .context-section {
                page-break-before: always;
            }
        }
    </style>
</head>
<body class="js-loading">
    <div class="noise-overlay"></div>
    
    <div class="container">
        <header>
            <div class="header-top">
                <h1>Is Now a Good Time?</h1>
                <div class="header-meta">
                    <span class="last-updated" id="lastUpdated"><span class="skeleton skeleton-text" style="width: 180px;"></span></span>
                    <span class="next-update" id="nextUpdate">Next update expected: ~Feb 7</span>
                    <div class="data-freshness" id="dataFreshness">
                        <span class="freshness-dot"></span>
                        <span class="freshness-text"></span>
                    </div>
                    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle light/dark theme">
                        <svg class="icon-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
                        <svg class="icon-moon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
                        <span>Theme</span>
                    </button>
                </div>
            </div>
            <p class="subtitle">Data to help you decide when to look for a new job.</p>
        </header>

        <!-- Collapsible About Section -->
        <section class="about-section" id="aboutSection">
            <div class="about-header" 
                 onclick="toggleAbout()" 
                 onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleAbout();}"
                 role="button" 
                 tabindex="0" 
                 aria-expanded="true" 
                 aria-controls="aboutContent"
                 id="aboutHeader">
                <h2>What is this?</h2>
                <span class="about-toggle">
                    <span id="aboutToggleText">Hide</span>
                    <span class="chevron"></span>
                </span>
            </div>
            <div class="about-content" id="aboutContent">
                <div class="about-main">
                    <p>This page tracks whether the job market currently favors <strong>people looking for work</strong> or <strong>employers doing the hiring</strong>. It combines eight economic indicators into a single score to help answer: <em>is now a good time to look for a new job?</em></p>
                    <p>The score runs from 0 to 100. Higher means better for job seekers. The data comes from the Bureau of Labor Statistics and Federal Reserve, updated monthly.</p>
                    <p class="about-note">This tracks the US labor market overall — tech, healthcare, and finance each behave differently.</p>
                </div>
                <div class="about-how">
                    <h3>What the score means</h3>
                    <ul>
                        <li><strong>70+</strong> — Recruiters reaching out. Negotiation pays off.</li>
                        <li><strong>55–69</strong> — Opportunities if you look. Some room to negotiate.</li>
                        <li><strong>40–54</strong> — Competitive. Employers have options.</li>
                        <li><strong>&lt;40</strong> — Hiring freezes. Little leverage.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Hero Score -->
        <section class="hero-score">
            <div class="score-header">
                <div>
                    <div class="score-label">The Score</div>
                    <div class="score-display">
                        <span class="score-approx">~</span>
                        <span class="score-value" id="currentScore"><span class="skeleton skeleton-score"></span></span>
                        <span class="score-max">/ 100</span>
                    </div>
                </div>
                <div class="score-meta">
                    <div class="score-verdict" id="scoreVerdict">
                        <span class="verdict-icon" id="verdictIcon"></span>
                        <span id="verdictText"><span class="skeleton skeleton-text" style="width: 100px;"></span></span>
                    </div>
                    <div class="score-change" id="scoreChange"><span class="skeleton skeleton-text" style="width: 140px;"></span></div>
                </div>
            </div>
            
            <!-- What Should I Do Section -->
            <div class="action-section" id="actionSection">
                <div class="action-header">
                    <span>💡</span>
                    <span>What should I do?</span>
                </div>
                <div class="action-content" id="actionContent">
                    <span class="skeleton skeleton-text" style="width: 100%;"></span>
                    <span class="skeleton skeleton-text" style="width: 90%; margin-top: 8px;"></span>
                </div>
            </div>

            <!-- Expandable Score Guide -->
            <div class="score-guide">
                <button class="score-guide-trigger" 
                        onclick="toggleScoreGuide()"
                        aria-expanded="false"
                        aria-controls="scoreGuideContent"
                        id="scoreGuideTrigger">
                    <span id="scoreGuideText">What do these scores mean?</span>
                    <span id="scoreGuideChevron">▾</span>
                </button>
                <div class="score-guide-content" id="scoreGuideContent">
                    <div class="score-guide-grid">
                        <div class="score-guide-item red" id="guideRed">
                            <div class="score-guide-range">&lt;40</div>
                            <div class="score-guide-feel">Hiring freezes. Little leverage.</div>
                        </div>
                        <div class="score-guide-item orange" id="guideOrange">
                            <div class="score-guide-range">40–54</div>
                            <div class="score-guide-feel">Competitive. Employers have options.</div>
                        </div>
                        <div class="score-guide-item yellow" id="guideYellow">
                            <div class="score-guide-range">55–69</div>
                            <div class="score-guide-feel">Opportunities if you look. Some room to negotiate.</div>
                        </div>
                        <div class="score-guide-item green" id="guideGreen">
                            <div class="score-guide-range">70+</div>
                            <div class="score-guide-feel">Recruiters reaching out. Negotiation pays off.</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Time Series Chart -->
        <section class="main-chart">
            <div class="chart-header">
                <div class="chart-title" id="chartTitle">The Score Over Time</div>
                <div class="chart-legend">
                    <div class="legend-item"><span class="legend-dot green"></span> Good Time to Move (70+)</div>
                    <div class="legend-item"><span class="legend-dot yellow"></span> Worth Exploring (55–69)</div>
                    <div class="legend-item"><span class="legend-dot orange"></span> Build Your Position (40–54)</div>
                    <div class="legend-item"><span class="legend-dot red"></span> Challenging (&lt;40)</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="mainChart" role="img" aria-label="Line chart showing job search readiness composite score from 2015 to present, with scores ranging from 0 to 100"></canvas>
                <p class="sr-only" id="mainChartDesc">Historical composite score tracking labor market conditions for job seekers. Higher scores indicate better conditions for finding new employment.</p>
            </div>
        </section>

        <!-- Core Metrics -->
        <section class="tier-section">
            <div class="tier-header">
                <span class="tier-badge">Core</span>
                <span class="tier-title">The Core Metrics</span>
                <span class="tier-subtitle">— How much leverage do workers have right now?</span>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Quit Rate</h3>
                            <span class="description">Workers confident enough to leave voluntarily</span>
                        </div>
                        <span class="metric-value" id="quitValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="quitChart" role="img" aria-label="Quit rate trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="quitRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Jobs per Job Seeker</h3>
                            <span class="description">Open positions ÷ unemployed workers</span>
                        </div>
                        <span class="metric-value" id="ratioValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="openingsChart" role="img" aria-label="Jobs per job seeker trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="ratioRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Hiring Rate</h3>
                            <span class="description">Actual hires happening, not just postings</span>
                        </div>
                        <span class="metric-value" id="hiresValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="hiresChart" role="img" aria-label="Hiring rate trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="hiresRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Layoff Rate</h3>
                            <span class="description">Involuntary job losses</span>
                        </div>
                        <span class="metric-value" id="layoffsValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="layoffsChart" role="img" aria-label="Layoff rate trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="layoffsRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
            </div>
        </section>

        <!-- Bigger Picture -->
        <section class="tier-section">
            <div class="tier-header">
                <span class="tier-badge">Context</span>
                <span class="tier-title">The Bigger Picture</span>
                <span class="tier-subtitle">— Economic forces shaping the job market</span>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Unemployment Rate</h3>
                            <span class="description">Share of workforce without jobs</span>
                        </div>
                        <span class="metric-value" id="unempValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="unempChart" role="img" aria-label="Unemployment rate trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="unempRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Fed Interest Rate</h3>
                            <span class="description">Cost of borrowing that affects hiring budgets</span>
                        </div>
                        <span class="metric-value" id="fedValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="fedChart" role="img" aria-label="Federal interest rate trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="fedRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Wage Growth</h3>
                            <span class="description">Year-over-year change in average pay</span>
                        </div>
                        <span class="metric-value" id="wageValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="wageChart" role="img" aria-label="Wage growth trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="wageRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Workforce Participation</h3>
                            <span class="description">Share of 25-54 year olds working or looking</span>
                        </div>
                        <span class="metric-value" id="lfprValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="lfprChart" role="img" aria-label="Workforce participation trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="lfprRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
            </div>
        </section>

        <!-- How Does This Compare -->
        <section class="context-section">
            <div class="context-header">How Does This Compare?</div>
            <div class="context-grid">
                <div class="context-item">
                    <div class="context-label">Current Conditions</div>
                    <div class="context-value highlight" id="cyclePosition"><span class="skeleton skeleton-text"></span></div>
                </div>
                <div class="context-item">
                    <div class="context-label">Similar to</div>
                    <div class="context-value" id="historicalAnalog"><span class="skeleton skeleton-text"></span></div>
                </div>
                <div class="context-item">
                    <div class="context-label">Best on Record</div>
                    <div class="context-value" id="peakContext"><span class="skeleton skeleton-text"></span></div>
                </div>
                <div class="context-item">
                    <div class="context-label">COVID Crash</div>
                    <div class="context-value" id="covidContext"><span class="skeleton skeleton-text"></span></div>
                </div>
                <div class="context-item">
                    <div class="context-label">Before Pandemic</div>
                    <div class="context-value" id="prePandemicContext"><span class="skeleton skeleton-text"></span></div>
                </div>
                <div class="context-item">
                    <div class="context-label">Key Signal to Watch</div>
                    <div class="context-value">Quit rate above 2.3% for 3+ months</div>
                </div>
            </div>
        </section>

        <!-- Path to Better Section -->
        <section class="recovery-section">
            <div class="recovery-header">
                <div class="recovery-title" id="recoveryTitle">Path to "Worth Exploring"</div>
                <div class="distance-badge" id="distanceBadge">
                    <span id="distancePoints">--</span> points to go
                </div>
            </div>
            <div class="recovery-summary" id="recoverySummary">
                <span class="skeleton skeleton-text" style="width: 100%;"></span>
                <span class="skeleton skeleton-text" style="width: 80%; margin-top: 8px;"></span>
            </div>
            <div class="recovery-grid">
                <!-- What's Holding the Score Down -->
                <div class="recovery-panel">
                    <div class="panel-title">What's Holding the Score Down?</div>
                    <div class="decomposition-list" id="decompositionList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Signs of Improvement -->
                <div class="recovery-panel">
                    <div class="panel-title">Signs of Improvement to Watch</div>
                    <div class="trigger-list" id="triggerList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- What Would It Take -->
                <div class="recovery-panel" style="grid-column: 1 / -1;">
                    <div class="panel-title">What Would It Take?</div>
                    <div class="sensitivity-intro">These scenarios show individual changes. In practice, multiple metrics often move together.</div>
                    <div class="sensitivity-list" id="sensitivityList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Understanding the Score -->
        <section class="accordion-section">
            <div class="accordion-header">Understanding the Score</div>
            
            <div class="accordion-item" id="accordion-calc">
                <button class="accordion-trigger" 
                        onclick="toggleAccordion('accordion-calc')"
                        aria-expanded="false"
                        aria-controls="panel-calc">
                    <span>How is this calculated?</span>
                    <span class="chevron"></span>
                </button>
                <div class="accordion-panel" id="panel-calc" role="region" aria-labelledby="accordion-calc">
                    <p>The score combines eight labor market indicators, weighted by how directly they measure worker leverage:</p>
                    <ul>
                        <li><strong>Core metrics (60% of score):</strong> Quit rate, job openings per unemployed worker, hiring rate, and layoff rate. These directly measure whether workers or employers have the upper hand.</li>
                        <li><strong>Context metrics (40% of score):</strong> Unemployment rate, Fed interest rate, wage growth, and workforce participation. These shape the environment but are less direct.</li>
                    </ul>
                    <p>The score also applies adjustments for unusual conditions: when the job openings ratio falls below 1.0 (more seekers than jobs), when the market is "frozen" (low hiring AND low quitting), and when Fed rates are near zero (historically stimulative).</p>
                    <div class="formula-block">
                        <strong>The formula:</strong>
                        <code>Score = (0.6 × CoreAvg + 0.4 × ContextAvg) × 100 × adjustments</code>
                        <p>Each metric is normalized to 0–1 based on historical ranges (e.g., quit rate: 1.5% = 0, 3.0% = 1). Adjustments: ×0.92 if jobs/seeker &lt; 1.0; up to ×0.88 for frozen market; ×1.08 if Fed rate &lt; 0.5%.</p>
                        <a href="https://github.com/jricciardi/labor-market-dashboard/blob/main/index.html#L1850" target="_blank">View source code →</a>
                    </div>
                </div>
            </div>
            
            <div class="accordion-item" id="accordion-limits">
                <button class="accordion-trigger" 
                        onclick="toggleAccordion('accordion-limits')"
                        aria-expanded="false"
                        aria-controls="panel-limits">
                    <span>What are the limitations?</span>
                    <span class="chevron"></span>
                </button>
                <div class="accordion-panel" id="panel-limits" role="region">
                    <p><strong>This is national data.</strong> Your industry, region, and role may differ significantly. Tech hiring can freeze while healthcare booms. San Francisco and rural Ohio are different markets.</p>
                    <p><strong>The data lags reality.</strong> BLS releases come 4-6 weeks after the reference month. By the time you see it here, conditions may have shifted.</p>
                    <p><strong>The thresholds are calibrated to recent history.</strong> A "bad" quit rate today might have been normal in 2010. The score tells you how now compares to 2015-2025, not to all of history.</p>
                    <p><strong>There's no confidence interval.</strong> The score of "47" should really be read as "somewhere around 45-50" given measurement uncertainty and model choices.</p>
                </div>
            </div>
            
            <div class="accordion-item" id="accordion-data">
                <button class="accordion-trigger" 
                        onclick="toggleAccordion('accordion-data')"
                        aria-expanded="false"
                        aria-controls="panel-data">
                    <span>Where does the data come from?</span>
                    <span class="chevron"></span>
                </button>
                <div class="accordion-panel" id="panel-data" role="region">
                    <p>All data comes from official government sources, retrieved via the <a href="https://fred.stlouisfed.org/" target="_blank">Federal Reserve Economic Data (FRED)</a> API:</p>
                    <ul>
                        <li><strong>Quit rate, hiring rate, layoff rate, job openings:</strong> Bureau of Labor Statistics <a href="https://www.bls.gov/jlt/" target="_blank">Job Openings and Labor Turnover Survey (JOLTS)</a></li>
                        <li><strong>Unemployment rate, workforce participation, wage growth:</strong> Bureau of Labor Statistics <a href="https://www.bls.gov/ces/" target="_blank">Employment Situation Report</a></li>
                        <li><strong>Fed interest rate:</strong> Federal Reserve <a href="https://www.federalreserve.gov/monetarypolicy/openmarket.htm" target="_blank">Open Market Operations</a></li>
                    </ul>
                    <p>Data updates automatically each month after BLS releases. The code is open source if you want to verify or adapt it.</p>
                </div>
            </div>
        </section>

        <footer>
            <div class="footer-content">
                <div class="footer-about">
                    <strong>About this project</strong><br>
                    Built to help workers make informed decisions about job search timing. The score synthesizes government data into an actionable signal—no spin, no narratives, just numbers.<br><br>
                    This project is <a href="https://github.com/jricciardi/labor-market-dashboard">open source</a>. Fork it, adapt it for your industry, or suggest improvements. Built with AI assistance as an experiment in pro-worker tooling.
                </div>
                <div class="footer-links">
                    <strong>Resources</strong><br>
                    <a href="https://www.bls.gov/jlt/">BLS JOLTS</a> · 
                    <a href="https://fred.stlouisfed.org/">FRED</a> · 
                    <a href="https://github.com/jricciardi/labor-market-dashboard">Source Code</a>
                </div>
                <div class="footer-data">
                    <strong>Data Sources</strong><br>
                    BLS JOLTS, BLS Employment Situation, Federal Reserve
                </div>
            </div>
            <div class="footer-bottom">
                Updated monthly after BLS data releases (usually first week of the month). Not financial or career advice.
            </div>
        </footer>
    </div>

    <script>
        // Theme toggle function
        let mainChartInstance = null;
        let sparklineInstances = {};
        
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem('dashboard-theme', next);
            
            // Update charts with new theme colors
            updateChartsForTheme();
        }
        
        function getThemeColors() {
            const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
            return {
                grid: isDark ? 'rgba(255, 255, 255, 0.04)' : 'rgba(0, 0, 0, 0.06)',
                tooltipBg: isDark ? 'rgba(22, 22, 32, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                tooltipBorder: isDark ? '#28283a' : '#d8dae0',
                tooltipText: isDark ? '#e8e8ed' : '#1a1a2e',
                tooltipSecondary: isDark ? '#9898a8' : '#5a5a6e',
                textMuted: isDark ? '#606070' : '#8888a0',
                sparklineGood: isDark ? '#00d9a0' : '#00a070',
                sparklineNeutral: isDark ? '#ffc940' : '#b48c00',
                sparklineBad: isDark ? '#ff4d6a' : '#dc3545',
            };
        }
        
        function updateChartsForTheme() {
            const colors = getThemeColors();
            
            // Update main chart
            if (mainChartInstance) {
                mainChartInstance.options.scales.x.grid.color = colors.grid;
                mainChartInstance.options.scales.y.grid.color = colors.grid;
                mainChartInstance.options.scales.x.ticks.color = colors.textMuted;
                mainChartInstance.options.scales.y.ticks.color = colors.textMuted;
                mainChartInstance.options.plugins.tooltip.backgroundColor = colors.tooltipBg;
                mainChartInstance.options.plugins.tooltip.borderColor = colors.tooltipBorder;
                mainChartInstance.options.plugins.tooltip.titleColor = colors.tooltipText;
                mainChartInstance.options.plugins.tooltip.bodyColor = colors.tooltipSecondary;
                mainChartInstance.update('none');
            }
            
            // Update sparklines
            Object.values(sparklineInstances).forEach(chart => {
                if (chart && chart.data && chart.data.datasets[0]) {
                    // Update colors based on current theme
                    chart.update('none');
                }
            });
        }
        
        // Toggle functions for collapsible sections
        function toggleAbout() {
            const section = document.getElementById('aboutSection');
            const toggleText = document.getElementById('aboutToggleText');
            const header = document.getElementById('aboutHeader');
            const isCollapsed = !section.classList.contains('collapsed');
            
            section.classList.toggle('collapsed');
            toggleText.textContent = isCollapsed ? 'Show' : 'Hide';
            header.setAttribute('aria-expanded', !isCollapsed);
            
            // Remember preference
            localStorage.setItem('aboutCollapsed', isCollapsed);
        }

        function toggleAccordion(id) {
            const item = document.getElementById(id);
            const trigger = item.querySelector('.accordion-trigger');
            const isOpen = !item.classList.contains('open');
            
            item.classList.toggle('open');
            trigger.setAttribute('aria-expanded', isOpen);
        }

        function toggleScoreGuide() {
            const content = document.getElementById('scoreGuideContent');
            const trigger = document.getElementById('scoreGuideTrigger');
            const text = document.getElementById('scoreGuideText');
            const chevron = document.getElementById('scoreGuideChevron');
            const isOpen = content.classList.contains('show');
            
            content.classList.toggle('show');
            trigger.setAttribute('aria-expanded', !isOpen);
            text.textContent = isOpen ? 'What do these scores mean?' : 'Hide score guide';
            chevron.textContent = isOpen ? '▾' : '▴';
            
            // Remember preference
            localStorage.setItem('scoreGuideOpen', !isOpen);
        }

        // Check if about section should be collapsed on load
        document.addEventListener('DOMContentLoaded', function() {
            const aboutCollapsed = localStorage.getItem('aboutCollapsed');
            if (aboutCollapsed === 'true') {
                document.getElementById('aboutSection').classList.add('collapsed');
                document.getElementById('aboutToggleText').textContent = 'Show';
                document.getElementById('aboutHeader').setAttribute('aria-expanded', 'false');
            }
            
            // Restore score guide state
            const scoreGuideOpen = localStorage.getItem('scoreGuideOpen');
            if (scoreGuideOpen === 'true') {
                document.getElementById('scoreGuideContent').classList.add('show');
                document.getElementById('scoreGuideTrigger').setAttribute('aria-expanded', 'true');
                document.getElementById('scoreGuideText').textContent = 'Hide score guide';
                document.getElementById('scoreGuideChevron').textContent = '▴';
            }
        });

        // Tier name mappings
        const tierNames = {
            'good-time': 'Good Time to Move',
            'worth-exploring': 'Worth Exploring', 
            'build-your-position': 'Build Your Position',
            'tough-market': 'Challenging'
        };

        // Action advice for each tier
        const actionAdvice = {
            'good-time': {
                intro: 'The market favors job seekers right now. If you\'ve been considering a move, this is a rational time to act.',
                actions: [
                    'Apply actively to roles that interest you',
                    'Respond positively to recruiter outreach',
                    'Negotiate confidently—you have leverage',
                    'Take informational interviews to expand options'
                ]
            },
            'worth-exploring': {
                intro: 'Conditions are decent for job seekers. Selective searching makes sense, but be thoughtful about what you pursue.',
                actions: [
                    'Apply to roles that are strong fits',
                    'Maintain and expand your network',
                    'Take informational interviews when offered',
                    'Don\'t feel rushed—wait for good opportunities'
                ]
            },
            'build-your-position': {
                intro: 'The market currently favors employers. If you can stay put, this may not be the best time to search actively.',
                actions: [
                    'Focus on building skills in your current role',
                    'Network quietly without urgency',
                    'Save aggressively for runway',
                    'Only pursue exceptional opportunities'
                ]
            },
            'tough-market': {
                intro: 'Conditions favor employers right now. Focus on stability unless you have a compelling reason to move.',
                actions: [
                    'Protect your current position',
                    'Build skills that will matter when conditions improve',
                    'Keep your network warm but don\'t push',
                    'Only move for truly compelling opportunities or necessity'
                ]
            }
        };

        // Fetch data and initialize dashboard
        async function initDashboard() {
            const response = await fetch('data.json');
            const data = await response.json();
            
            const monthlyData = {
                labels: data.labels,
                quitRate: data.quitRate,
                openingsRatio: data.openingsRatio,
                hiresRate: data.hiresRate,
                layoffsRate: data.layoffsRate,
                unempRate: data.unempRate,
                fedRate: data.fedRate,
                wageGrowth: data.wageGrowth,
                lfpr: data.lfpr
            };
            
            // Update timestamps
            const lastUpdated = new Date(data.metadata.lastUpdated);
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            const formattedDate = lastUpdated.toLocaleDateString('en-US', options);
            const dataMonth = data.metadata.dataThrough.split('-');
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const dataThrough = monthNames[parseInt(dataMonth[1]) - 1] + ' ' + dataMonth[0];
            document.getElementById('lastUpdated').textContent = `Updated ${formattedDate} • Data through ${dataThrough}`;
            
            // Calculate next update based on dataThrough
            // JOLTS data for month X is released ~5-6 weeks after month X ends
            // If we have data through month X, next release (month X+1 data) comes ~X+2 months
            // But if today is past that date, we should show X+3 months
            const dataThroughDate = new Date(parseInt(dataMonth[0]), parseInt(dataMonth[1]) - 1, 1);
            const today = new Date();
            
            // Calculate when the next data release should be
            let nextReleaseMonth = new Date(dataThroughDate);
            nextReleaseMonth.setMonth(nextReleaseMonth.getMonth() + 2);
            nextReleaseMonth.setDate(7);
            
            // If that date has passed, show the following month
            if (nextReleaseMonth < today) {
                nextReleaseMonth.setMonth(nextReleaseMonth.getMonth() + 1);
            }
            
            const nextUpdateText = `Next update: ~${monthNames[nextReleaseMonth.getMonth()]} ${nextReleaseMonth.getDate()}`;
            document.getElementById('nextUpdate').textContent = nextUpdateText;
            
            // Calculate data freshness
            // Data is considered "fresh" if the most recent available data is less than 6 weeks old
            // "stale" if 6-10 weeks old, "old" if more than 10 weeks
            const dataEndDate = new Date(parseInt(dataMonth[0]), parseInt(dataMonth[1]), 0); // Last day of data month
            const daysSinceData = Math.floor((today - dataEndDate) / (1000 * 60 * 60 * 24));
            
            const freshnessEl = document.getElementById('dataFreshness');
            const freshnessDot = freshnessEl.querySelector('.freshness-dot');
            const freshnessText = freshnessEl.querySelector('.freshness-text');
            
            let freshnessClass, freshnessLabel;
            if (daysSinceData <= 42) { // 6 weeks
                freshnessClass = 'fresh';
                freshnessLabel = 'Current';
            } else if (daysSinceData <= 70) { // 10 weeks
                freshnessClass = 'stale';
                freshnessLabel = `${Math.floor(daysSinceData / 7)} weeks old`;
            } else {
                freshnessClass = 'old';
                freshnessLabel = `${Math.floor(daysSinceData / 7)} weeks old`;
            }
            
            freshnessDot.className = `freshness-dot ${freshnessClass}`;
            freshnessText.className = `freshness-text ${freshnessClass}`;
            freshnessText.textContent = freshnessLabel;
            
            // Update chart title with actual data range
            const firstLabel = monthlyData.labels[0];
            const lastLabel = monthlyData.labels[monthlyData.labels.length - 1];
            document.getElementById('chartTitle').textContent = `The Score Over Time (${firstLabel} – ${lastLabel})`;

            // Calculate composite scores
            function calculateCompositeScore(idx) {
                const quit = monthlyData.quitRate[idx];
                const ratio = monthlyData.openingsRatio[idx];
                const hires = monthlyData.hiresRate[idx];
                const layoffs = monthlyData.layoffsRate[idx];
                const unemp = monthlyData.unempRate[idx];
                const fed = monthlyData.fedRate[idx];
                const wage = monthlyData.wageGrowth[idx];
                const lfpr = monthlyData.lfpr[idx];
                
                if (quit == null || ratio == null) return null;
                
                const quitScore = Math.min(1, Math.max(0, (quit - 1.5) / 1.5));
                const ratioScore = Math.min(1, Math.max(0, (ratio - 0.3) / 1.7));
                const hiresScore = Math.min(1, Math.max(0, (hires - 2.0) / 2.5));
                const layoffsScore = Math.min(1, Math.max(0, (2.5 - layoffs) / 1.7));
                const unempScore = unemp != null ? Math.min(1, Math.max(0, (7.0 - unemp) / 3.5)) : 0.5;
                const fedScore = Math.min(1, Math.max(0, (5.5 - fed) / 5.5));
                const wageScore = wage != null ? Math.min(1, Math.max(0, (wage - 2.0) / 3.0)) : 0.5;
                const lfprScore = lfpr != null ? Math.min(1, Math.max(0, (lfpr - 79) / 4.0)) : 0.5;
                
                const tier1 = (quitScore + ratioScore + hiresScore + layoffsScore) / 4 * 0.6;
                const tier2 = (unempScore + fedScore + wageScore + lfprScore) / 4 * 0.4;
                
                let baseScore = (tier1 + tier2) * 100;
                
                if (ratio < 1.0) baseScore *= 0.92;
                const churnPenalty = 0.12 * (1 - Math.min(quitScore, hiresScore));
                baseScore *= (1 - churnPenalty);
                if (fed < 0.5) baseScore *= 1.08;
                
                return Math.min(100, Math.round(baseScore));
            }

            const compositeScores = monthlyData.labels.map((_, idx) => calculateCompositeScore(idx));
            
            // Find peak and current
            let peakScore = 0;
            let peakIdx = 0;
            compositeScores.forEach((score, idx) => {
                if (score !== null && score > peakScore) {
                    peakScore = score;
                    peakIdx = idx;
                }
            });
            
            let currentScore = compositeScores[compositeScores.length - 1];
            let currentIdx = compositeScores.length - 1;
            while (currentScore === null && currentIdx > 0) {
                currentIdx--;
                currentScore = compositeScores[currentIdx];
            }
            
            // Determine tier
            let tierClass, tierKey;
            if (currentScore >= 70) {
                tierClass = 'good-time';
                tierKey = 'good-time';
            } else if (currentScore >= 55) {
                tierClass = 'worth-exploring';
                tierKey = 'worth-exploring';
            } else if (currentScore >= 40) {
                tierClass = 'build-your-position';
                tierKey = 'build-your-position';
            } else {
                tierClass = 'tough-market';
                tierKey = 'tough-market';
            }
            
            // Update score display
            document.getElementById('currentScore').textContent = currentScore;
            document.getElementById('currentScore').className = 'score-value ' + tierClass;
            document.getElementById('scoreVerdict').className = 'score-verdict ' + tierClass;
            document.getElementById('verdictIcon').className = 'verdict-icon ' + tierClass;
            document.getElementById('verdictText').textContent = tierNames[tierKey];
            document.getElementById('actionSection').className = 'action-section ' + tierClass;
            
            // Set border color for action section
            const accentColors = {
                'good-time': 'var(--accent-green)',
                'worth-exploring': 'var(--accent-yellow)',
                'build-your-position': 'var(--accent-orange)',
                'tough-market': 'var(--accent-red)'
            };
            document.getElementById('actionSection').style.borderLeft = '3px solid ' + accentColors[tierKey];
            
            // Highlight current tier in score guide
            const guideMapping = {
                'good-time': 'guideGreen',
                'worth-exploring': 'guideYellow',
                'build-your-position': 'guideOrange',
                'tough-market': 'guideRed'
            };
            ['guideGreen', 'guideYellow', 'guideOrange', 'guideRed'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.classList.remove('current');
                    // Add arrow to current tier's range
                    const rangeEl = el.querySelector('.score-guide-range');
                    if (rangeEl) {
                        rangeEl.textContent = rangeEl.textContent.replace(' ←', '');
                    }
                }
            });
            const currentGuideEl = document.getElementById(guideMapping[tierKey]);
            if (currentGuideEl) {
                currentGuideEl.classList.add('current');
                const rangeEl = currentGuideEl.querySelector('.score-guide-range');
                if (rangeEl && !rangeEl.textContent.includes('←')) {
                    rangeEl.textContent += ' ←';
                }
            }
            
            const diff = peakScore - currentScore;
            document.getElementById('scoreChange').textContent = `↓ ${diff} pts from peak (${monthlyData.labels[peakIdx]})`;
            
            // Update action content
            const advice = actionAdvice[tierKey];
            let actionHTML = `<p>${advice.intro}</p><ul class="action-list">`;
            advice.actions.forEach(action => {
                actionHTML += `<li>${action}</li>`;
            });
            actionHTML += '</ul>';
            document.getElementById('actionContent').innerHTML = actionHTML;
            
            // Update metric values
            const currentMetrics = {
                quitRate: monthlyData.quitRate[currentIdx],
                openingsRatio: monthlyData.openingsRatio[currentIdx],
                hiresRate: monthlyData.hiresRate[currentIdx],
                layoffsRate: monthlyData.layoffsRate[currentIdx],
                unempRate: monthlyData.unempRate[currentIdx],
                fedRate: monthlyData.fedRate[currentIdx],
                wageGrowth: monthlyData.wageGrowth[currentIdx],
                lfpr: monthlyData.lfpr[currentIdx]
            };
            
            // Update displayed values with color coding
            function getMetricClass(value, metric) {
                const thresholds = {
                    quitRate: { good: 2.5, neutral: 2.0 },
                    openingsRatio: { good: 1.2, neutral: 1.0 },
                    hiresRate: { good: 3.8, neutral: 3.4 },
                    layoffsRate: { good: 1.0, neutral: 1.3, inverted: true },
                    unempRate: { good: 4.0, neutral: 4.5, inverted: true },
                    fedRate: { good: 2.5, neutral: 4.0, inverted: true },
                    wageGrowth: { good: 4.0, neutral: 3.0 },
                    lfpr: { good: 83.0, neutral: 82.0 }
                };
                const t = thresholds[metric];
                if (!t) return 'neutral';
                if (t.inverted) {
                    if (value <= t.good) return 'good';
                    if (value <= t.neutral) return 'neutral';
                    return 'bad';
                } else {
                    if (value >= t.good) return 'good';
                    if (value >= t.neutral) return 'neutral';
                    return 'bad';
                }
            }
            
            // Get previous month's value for delta calculation
            const prevIdx = currentIdx > 0 ? currentIdx - 1 : currentIdx;
            const prevMetrics = {
                quitRate: monthlyData.quitRate[prevIdx],
                openingsRatio: monthlyData.openingsRatio[prevIdx],
                hiresRate: monthlyData.hiresRate[prevIdx],
                layoffsRate: monthlyData.layoffsRate[prevIdx],
                unempRate: monthlyData.unempRate[prevIdx],
                fedRate: monthlyData.fedRate[prevIdx],
                wageGrowth: monthlyData.wageGrowth[prevIdx],
                lfpr: monthlyData.lfpr[prevIdx]
            };
            
            // Helper to create delta HTML
            function getDeltaHTML(current, previous, decimals, isInverted = false) {
                if (previous == null || current == null) return '';
                const diff = current - previous;
                if (Math.abs(diff) < 0.01) return '<span class="metric-delta flat">—</span>';
                
                const sign = diff > 0 ? '+' : '';
                const direction = diff > 0 ? 'up' : 'down';
                const invertedClass = isInverted ? ' inverted' : '';
                return `<span class="metric-delta ${direction}${invertedClass}">${sign}${diff.toFixed(decimals)}</span>`;
            }
            
            // Update metric displays with deltas
            document.getElementById('quitValue').innerHTML = currentMetrics.quitRate.toFixed(1) + '%' + getDeltaHTML(currentMetrics.quitRate, prevMetrics.quitRate, 1);
            document.getElementById('quitValue').className = 'metric-value ' + getMetricClass(currentMetrics.quitRate, 'quitRate');
            
            document.getElementById('ratioValue').innerHTML = currentMetrics.openingsRatio.toFixed(2) + getDeltaHTML(currentMetrics.openingsRatio, prevMetrics.openingsRatio, 2);
            document.getElementById('ratioValue').className = 'metric-value ' + getMetricClass(currentMetrics.openingsRatio, 'openingsRatio');
            
            document.getElementById('hiresValue').innerHTML = currentMetrics.hiresRate.toFixed(1) + '%' + getDeltaHTML(currentMetrics.hiresRate, prevMetrics.hiresRate, 1);
            document.getElementById('hiresValue').className = 'metric-value ' + getMetricClass(currentMetrics.hiresRate, 'hiresRate');
            
            document.getElementById('layoffsValue').innerHTML = currentMetrics.layoffsRate.toFixed(1) + '%' + getDeltaHTML(currentMetrics.layoffsRate, prevMetrics.layoffsRate, 1, true);
            document.getElementById('layoffsValue').className = 'metric-value ' + getMetricClass(currentMetrics.layoffsRate, 'layoffsRate');
            
            document.getElementById('unempValue').innerHTML = (currentMetrics.unempRate || 0).toFixed(1) + '%' + getDeltaHTML(currentMetrics.unempRate, prevMetrics.unempRate, 1, true);
            document.getElementById('unempValue').className = 'metric-value ' + getMetricClass(currentMetrics.unempRate || 5, 'unempRate');
            
            document.getElementById('fedValue').innerHTML = currentMetrics.fedRate.toFixed(2) + '%' + getDeltaHTML(currentMetrics.fedRate, prevMetrics.fedRate, 2, true);
            document.getElementById('fedValue').className = 'metric-value ' + getMetricClass(currentMetrics.fedRate, 'fedRate');
            
            document.getElementById('wageValue').innerHTML = (currentMetrics.wageGrowth || 0).toFixed(1) + '%' + getDeltaHTML(currentMetrics.wageGrowth, prevMetrics.wageGrowth, 1);
            document.getElementById('wageValue').className = 'metric-value ' + getMetricClass(currentMetrics.wageGrowth || 3, 'wageGrowth');
            
            document.getElementById('lfprValue').innerHTML = (currentMetrics.lfpr || 0).toFixed(1) + '%' + getDeltaHTML(currentMetrics.lfpr, prevMetrics.lfpr, 1);
            document.getElementById('lfprValue').className = 'metric-value ' + getMetricClass(currentMetrics.lfpr || 82, 'lfpr');

            // Historical context
            document.getElementById('peakContext').textContent = `${peakScore} (${monthlyData.labels[peakIdx]})`;
            
            const covidIdx = monthlyData.labels.indexOf('Apr-20');
            const covidScore = compositeScores[covidIdx];
            document.getElementById('covidContext').textContent = `${covidScore} (Apr 2020)`;
            
            const prePandemicIdx = monthlyData.labels.indexOf('Dec-19');
            const prePandemicScore = compositeScores[prePandemicIdx];
            document.getElementById('prePandemicContext').textContent = `${prePandemicScore} (Dec 2019)`;
            
            // Cycle position
            const cycleEl = document.getElementById('cyclePosition');
            if (currentScore >= 70) {
                cycleEl.textContent = 'Favoring workers';
            } else if (currentScore >= 55) {
                cycleEl.textContent = 'Roughly balanced';
            } else if (currentScore >= 40) {
                cycleEl.textContent = 'Favoring employers';
            } else {
                cycleEl.textContent = 'Strongly favoring employers';
            }
            
            // Historical analog
            const analogEl = document.getElementById('historicalAnalog');
            let bestMatch = { idx: -1, diff: Infinity };
            const excludeStart = monthlyData.labels.indexOf('Mar-20');
            const excludeEnd = monthlyData.labels.indexOf('Dec-20');
            const recentCutoff = compositeScores.length - 12;
            
            compositeScores.forEach((score, idx) => {
                if (score === null) return;
                if (idx >= excludeStart && idx <= excludeEnd) return;
                if (idx >= recentCutoff) return;
                
                const scoreDiff = Math.abs(score - currentScore);
                if (scoreDiff < bestMatch.diff) {
                    bestMatch = { idx, diff: scoreDiff, score };
                }
            });
            
            if (bestMatch.idx >= 0 && bestMatch.diff <= 5) {
                analogEl.textContent = `${monthlyData.labels[bestMatch.idx]} (score: ${bestMatch.score})`;
            } else {
                analogEl.textContent = 'No close match';
            }

            // Recovery section
            const nextTierThreshold = currentScore >= 55 ? 70 : 55;
            const nextTierName = currentScore >= 55 ? 'Good Time to Move' : 'Worth Exploring';
            const distanceToTarget = Math.max(0, nextTierThreshold - currentScore);
            
            document.getElementById('recoveryTitle').textContent = `Path to "${nextTierName}"`;
            document.getElementById('distancePoints').textContent = distanceToTarget;

            // Score decomposition
            function getMetricScore(metric, value) {
                switch(metric) {
                    case 'quitRate': return Math.min(1, Math.max(0, (value - 1.5) / 1.5));
                    case 'openingsRatio': return Math.min(1, Math.max(0, (value - 0.3) / 1.7));
                    case 'hiresRate': return Math.min(1, Math.max(0, (value - 2.0) / 2.5));
                    case 'layoffsRate': return Math.min(1, Math.max(0, (2.5 - value) / 1.7));
                    case 'unempRate': return Math.min(1, Math.max(0, (7.0 - value) / 3.5));
                    case 'fedRate': return Math.min(1, Math.max(0, (5.5 - value) / 5.5));
                    case 'wageGrowth': return Math.min(1, Math.max(0, (value - 2.0) / 3.0));
                    case 'lfpr': return Math.min(1, Math.max(0, (value - 79) / 4.0));
                    default: return 0.5;
                }
            }
            
            function getScoreCategory(score) {
                if (score >= 0.7) return 'good';
                if (score >= 0.5) return 'neutral';
                if (score >= 0.3) return 'poor';
                return 'bad';
            }
            
            const metricDisplayNames = {
                quitRate: 'Quit Rate',
                openingsRatio: 'Jobs/Seeker',
                hiresRate: 'Hiring Rate',
                layoffsRate: 'Layoff Rate',
                unempRate: 'Unemployment',
                fedRate: 'Fed Rate',
                wageGrowth: 'Wage Growth',
                lfpr: 'Participation'
            };

            // Format metric values for display
            const formatMetricValue = (metric, value) => {
                switch(metric) {
                    case 'openingsRatio': return value.toFixed(2);
                    case 'fedRate': return value.toFixed(2) + '%';
                    case 'lfpr': return value.toFixed(1) + '%';
                    default: return value.toFixed(1) + '%';
                }
            };
            
            const metricScores = Object.entries(currentMetrics)
                .filter(([k, v]) => v != null)
                .map(([metric, value]) => ({
                    metric,
                    value,
                    score: getMetricScore(metric, value),
                    name: metricDisplayNames[metric]
                }))
                .sort((a, b) => a.score - b.score);
            
            const quitScoreVal = getMetricScore('quitRate', currentMetrics.quitRate);
            const hiresScoreVal = getMetricScore('hiresRate', currentMetrics.hiresRate);
            const isFrozenMarket = quitScoreVal < 0.5 && hiresScoreVal < 0.6;
            
            const decompositionEl = document.getElementById('decompositionList');
            decompositionEl.innerHTML = metricScores.map(m => {
                const isLayoffs = m.metric === 'layoffsRate';
                const showFootnote = isLayoffs && isFrozenMarket && m.score > 0.7;
                const formattedValue = formatMetricValue(m.metric, m.value);
                return `
                    <div class="decomposition-item">
                        <span class="metric-name">${m.name}${showFootnote ? ' <span class="footnote-marker">†</span>' : ''}</span>
                        <span class="metric-current">${formattedValue}</span>
                        <div class="metric-bar-container">
                            <div class="metric-bar ${getScoreCategory(m.score)}" style="width: ${m.score * 100}%"></div>
                        </div>
                        <span class="metric-score">${Math.round(m.score * 100)}</span>
                    </div>
                `;
            }).join('');
            
            if (isFrozenMarket) {
                decompositionEl.innerHTML += `
                    <div class="decomposition-footnote">
                        <span class="footnote-marker">†</span> Low layoffs in a "frozen" market (low quits + low hiring) provides less benefit than the score suggests. 
                        Employers aren't cutting, but they're also not hiring—limited opportunities for job seekers.
                    </div>
                `;
            }

            // Trigger conditions
            const getRecentValues = (dataArray, count = 3) => {
                const values = [];
                for (let i = 0; i < count && (currentIdx - i) >= 0; i++) {
                    const val = dataArray[currentIdx - i];
                    if (val != null) values.push(val);
                }
                return values;
            };
            
            const getTrend = (values) => {
                if (values.length < 2) return { arrow: '→', direction: 'flat' };
                const recent = values[0];
                const older = values[values.length - 1];
                const diff = recent - older;
                const threshold = Math.abs(older) * 0.05;
                
                if (diff > threshold) return { arrow: '↑', direction: 'up' };
                if (diff < -threshold) return { arrow: '↓', direction: 'down' };
                return { arrow: '→', direction: 'flat' };
            };
            
            const formatTrendHistory = (values, decimals = 2) => {
                return values.slice(0, 3).reverse().map(v => v.toFixed(decimals)).join(' → ');
            };
            
            const triggers = [
                {
                    condition: 'Quit rate rises above 2.3% for 3+ months',
                    current: currentMetrics.quitRate,
                    target: 2.3,
                    recentValues: getRecentValues(monthlyData.quitRate),
                    decimals: 1,
                    goodDirection: 'up',
                    status: currentMetrics.quitRate > 2.3 ? 'met' : 
                            currentMetrics.quitRate > 2.1 ? 'watching' : ''
                },
                {
                    condition: 'Jobs per seeker rises above 1.1',
                    current: currentMetrics.openingsRatio,
                    target: 1.1,
                    recentValues: getRecentValues(monthlyData.openingsRatio),
                    decimals: 2,
                    goodDirection: 'up',
                    status: currentMetrics.openingsRatio > 1.1 ? 'met' :
                            currentMetrics.openingsRatio > 1.0 ? 'watching' : ''
                },
                {
                    condition: 'Hiring rate rises above 3.5%',
                    current: currentMetrics.hiresRate,
                    target: 3.5,
                    recentValues: getRecentValues(monthlyData.hiresRate),
                    decimals: 1,
                    goodDirection: 'up',
                    status: currentMetrics.hiresRate > 3.5 ? 'met' :
                            currentMetrics.hiresRate > 3.3 ? 'watching' : ''
                },
                {
                    condition: 'Fed rate drops below 3.0%',
                    current: currentMetrics.fedRate,
                    target: 3.0,
                    recentValues: getRecentValues(monthlyData.fedRate),
                    decimals: 2,
                    goodDirection: 'down',
                    status: currentMetrics.fedRate < 3.0 ? 'met' :
                            currentMetrics.fedRate < 3.5 ? 'watching' : ''
                }
            ];
            
            const triggerEl = document.getElementById('triggerList');
            triggerEl.innerHTML = triggers.map(t => {
                // Use clearer icons: ✓ for met, ● for watching, ○ for not met
                const icon = t.status === 'met' ? '✓' : t.status === 'watching' ? '●' : '○';
                const trend = getTrend(t.recentValues);
                const trendIsGood = (trend.direction === t.goodDirection) || 
                                   (trend.direction === 'flat' && t.status === 'met');
                const trendClass = trendIsGood ? 'trend-good' : 
                                  trend.direction === 'flat' ? 'trend-flat' : 'trend-bad';
                const trendHistory = formatTrendHistory(t.recentValues, t.decimals);
                
                const statusText = t.status === 'met' ? 'Condition met' :
                                  t.status === 'watching' ? 'Getting close' :
                                  `Current: ${t.current.toFixed(t.decimals)}`;
                return `
                    <div class="trigger-item ${t.status}">
                        <span class="trigger-icon">${icon}</span>
                        <div class="trigger-content">
                            <div class="trigger-condition">${t.condition}</div>
                            <div class="trigger-status">${statusText}</div>
                            <div class="trigger-trend ${trendClass}">
                                <span class="trend-arrow">${trend.arrow}</span>
                                <span class="trend-history">Last 3 months: ${trendHistory}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Recovery summary
            const triggerAnalysis = triggers.map(t => {
                const trend = getTrend(t.recentValues);
                const trendIsGood = trend.direction === t.goodDirection;
                const trendIsBad = trend.direction !== 'flat' && !trendIsGood;
                return { ...t, trend, trendIsGood, trendIsBad };
            });
            
            const metConditions = triggerAnalysis.filter(t => t.status === 'met');
            const improvingConditions = triggerAnalysis.filter(t => t.trendIsGood);
            const worseningConditions = triggerAnalysis.filter(t => t.trendIsBad);
            
            let summaryParts = [];
            
            if (metConditions.length >= 3) {
                summaryParts.push(`<strong>Recovery signals strengthening.</strong> ${metConditions.length} of 4 conditions now met.`);
            } else if (metConditions.length >= 2) {
                summaryParts.push(`<strong>Early signs of improvement.</strong> ${metConditions.length} of 4 conditions met—worth watching.`);
            } else if (improvingConditions.length >= 2) {
                summaryParts.push(`<strong>Some positive movement.</strong> No trigger conditions met yet, but trends bear watching.`);
            } else if (worseningConditions.length >= 3) {
                summaryParts.push(`<strong>Conditions weakening.</strong> Most indicators moving in the wrong direction.`);
            } else {
                summaryParts.push(`<strong>Holding pattern.</strong> No trigger conditions met, limited momentum in either direction.`);
            }
            
            if (improvingConditions.length > 0) {
                const names = improvingConditions.map(t => {
                    if (t.condition.includes('Quit')) return 'quit rate';
                    if (t.condition.includes('Jobs')) return 'jobs ratio';
                    if (t.condition.includes('Hiring')) return 'hiring';
                    if (t.condition.includes('Fed')) return 'Fed rate';
                    return '';
                }).filter(n => n);
                if (names.length) summaryParts.push(`<span class="trend-positive">↑ Improving:</span> ${names.join(', ')}.`);
            }
            
            if (worseningConditions.length > 0) {
                const names = worseningConditions.map(t => {
                    if (t.condition.includes('Quit')) return 'quit rate';
                    if (t.condition.includes('Jobs')) return 'jobs ratio';
                    if (t.condition.includes('Hiring')) return 'hiring';
                    if (t.condition.includes('Fed')) return 'Fed rate';
                    return '';
                }).filter(n => n);
                if (names.length) summaryParts.push(`<span class="trend-negative">↓ Worsening:</span> ${names.join(', ')}.`);
            }
            
            document.getElementById('recoverySummary').innerHTML = summaryParts.join(' ');

            // Sensitivity analysis
            function calculateHypotheticalScore(overrides) {
                const metrics = { ...currentMetrics, ...overrides };
                
                const quitScore = Math.min(1, Math.max(0, (metrics.quitRate - 1.5) / 1.5));
                const ratioScore = Math.min(1, Math.max(0, (metrics.openingsRatio - 0.3) / 1.7));
                const hiresScore = Math.min(1, Math.max(0, (metrics.hiresRate - 2.0) / 2.5));
                const layoffsScore = Math.min(1, Math.max(0, (2.5 - metrics.layoffsRate) / 1.7));
                const unempScore = Math.min(1, Math.max(0, (7.0 - metrics.unempRate) / 3.5));
                const fedScore = Math.min(1, Math.max(0, (5.5 - metrics.fedRate) / 5.5));
                const wageScore = Math.min(1, Math.max(0, (metrics.wageGrowth - 2.0) / 3.0));
                const lfprScore = Math.min(1, Math.max(0, (metrics.lfpr - 79) / 4.0));
                
                const tier1 = (quitScore + ratioScore + hiresScore + layoffsScore) / 4 * 0.6;
                const tier2 = (unempScore + fedScore + wageScore + lfprScore) / 4 * 0.4;
                
                let baseScore = (tier1 + tier2) * 100;
                
                if (metrics.openingsRatio < 1.0) baseScore *= 0.92;
                const churnPenalty = 0.12 * (1 - Math.min(quitScore, hiresScore));
                baseScore *= (1 - churnPenalty);
                if (metrics.fedRate < 0.5) baseScore *= 1.08;
                
                return Math.min(100, Math.round(baseScore));
            }
            
            const scenarios = [
                {
                    name: 'Quit rate rises to 2.3%',
                    score: calculateHypotheticalScore({ quitRate: 2.3 })
                },
                {
                    name: 'Jobs per seeker returns to 1.1',
                    score: calculateHypotheticalScore({ openingsRatio: 1.1 })
                },
                {
                    name: 'Fed cuts rates to 2.5%',
                    score: calculateHypotheticalScore({ fedRate: 2.5 })
                },
                {
                    name: 'Hiring rate recovers to 3.6%',
                    score: calculateHypotheticalScore({ hiresRate: 3.6 })
                },
                {
                    name: 'Combined: Quit 2.3% + Ratio 1.1',
                    score: calculateHypotheticalScore({ quitRate: 2.3, openingsRatio: 1.1 })
                }
            ];
            
            const sensitivityEl = document.getElementById('sensitivityList');
            sensitivityEl.innerHTML = scenarios.map(s => {
                const delta = s.score - currentScore;
                const deltaStr = delta >= 0 ? `+${delta}` : `${delta}`;
                const category = s.score >= 55 ? 'positive' : s.score >= 48 ? 'neutral' : 'negative';
                const reachesTarget = s.score >= nextTierThreshold ? ` → ${nextTierName}` : '';
                return `
                    <div class="sensitivity-item">
                        <span class="sensitivity-scenario">${s.name}</span>
                        <span class="sensitivity-result ${category}">Score: ${s.score} (${deltaStr})${reachesTarget}</span>
                    </div>
                `;
            }).join('');

            // Charts
            Chart.defaults.color = '#9898a8';
            Chart.defaults.font.family = "'JetBrains Mono', monospace";
            Chart.defaults.font.size = 10;

            // Main chart
            const mainCtx = document.getElementById('mainChart').getContext('2d');
            const themeColors = getThemeColors();
            mainChartInstance = new Chart(mainCtx, {
                type: 'line',
                data: {
                    labels: monthlyData.labels,
                    datasets: [{
                        label: 'Score',
                        data: compositeScores,
                        borderColor: 'rgba(255, 201, 64, 1)',
                        spanGaps: true,
                        segment: {
                            borderColor: ctx => {
                                const val = ctx.p0.parsed.y;
                                if (val == null) return 'rgba(255, 140, 64, 1)';
                                if (val >= 70) return 'rgba(0, 217, 160, 1)';
                                if (val >= 55) return 'rgba(255, 201, 64, 1)';
                                if (val >= 40) return 'rgba(255, 140, 64, 1)';
                                return 'rgba(255, 77, 106, 1)';
                            }
                        },
                        backgroundColor: function(context) {
                            const chart = context.chart;
                            const {ctx, chartArea} = chart;
                            if (!chartArea) return 'rgba(255, 201, 64, 0.05)';
                            const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
                            gradient.addColorStop(0, 'rgba(255, 77, 106, 0.08)');
                            gradient.addColorStop(0.4, 'rgba(255, 140, 64, 0.08)');
                            gradient.addColorStop(0.55, 'rgba(255, 201, 64, 0.08)');
                            gradient.addColorStop(0.7, 'rgba(0, 217, 160, 0.08)');
                            return gradient;
                        },
                        fill: true,
                        tension: 0.3,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointHoverBackgroundColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: themeColors.tooltipBg,
                            titleColor: themeColors.tooltipText,
                            bodyColor: themeColors.tooltipSecondary,
                            borderColor: themeColors.tooltipBorder,
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                title: (items) => items[0].label,
                                label: (item) => {
                                    const score = item.raw;
                                    let status = 'Challenging';
                                    if (score >= 70) status = 'Good Time to Move';
                                    else if (score >= 55) status = 'Worth Exploring';
                                    else if (score >= 40) status = 'Build Your Position';
                                    return [`Score: ~${score}`, `${status}`];
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                line70: { type: 'line', yMin: 70, yMax: 70, borderColor: 'rgba(0, 217, 160, 0.3)', borderWidth: 1, borderDash: [5, 5] },
                                line55: { type: 'line', yMin: 55, yMax: 55, borderColor: 'rgba(255, 201, 64, 0.3)', borderWidth: 1, borderDash: [5, 5] },
                                line40: { type: 'line', yMin: 40, yMax: 40, borderColor: 'rgba(255, 140, 64, 0.3)', borderWidth: 1, borderDash: [5, 5] }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: themeColors.grid, drawBorder: false },
                            ticks: { 
                                maxTicksLimit: window.innerWidth < 480 ? 5 : window.innerWidth < 768 ? 8 : 12, 
                                maxRotation: 0,
                                font: { size: window.innerWidth < 480 ? 8 : 10 },
                                color: themeColors.textMuted
                            }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            grid: { color: themeColors.grid, drawBorder: false },
                            ticks: { stepSize: 20, color: themeColors.textMuted }
                        }
                    }
                }
            });

            // Sparklines with min/max range labels
            function createSparkline(canvasId, dataArray, metric, rangeId) {
                const ctx = document.getElementById(canvasId).getContext('2d');
                const thresholds = {
                    quitRate: { good: 2.5, neutral: 2.0 },
                    openingsRatio: { good: 1.2, neutral: 1.0 },
                    hiresRate: { good: 3.8, neutral: 3.4 },
                    layoffsRate: { good: 1.0, neutral: 1.3, inverted: true },
                    unempRate: { good: 4.0, neutral: 4.5, inverted: true },
                    fedRate: { good: 2.5, neutral: 4.0, inverted: true },
                    wageGrowth: { good: 4.0, neutral: 3.0 },
                    lfpr: { good: 83.0, neutral: 82.0 }
                };
                
                // Calculate and display min/max range
                const validData = dataArray.filter(v => v != null && !isNaN(v));
                const minVal = Math.min(...validData);
                const maxVal = Math.max(...validData);
                
                // Format based on metric type
                const formatValue = (val) => {
                    if (metric === 'openingsRatio') return val.toFixed(1);
                    if (metric === 'lfpr') return val.toFixed(0);
                    return val.toFixed(1);
                };
                
                // Populate range labels
                if (rangeId) {
                    const rangeEl = document.getElementById(rangeId);
                    if (rangeEl) {
                        rangeEl.querySelector('.max').textContent = formatValue(maxVal);
                        rangeEl.querySelector('.min').textContent = formatValue(minVal);
                    }
                }
                
                const getColor = (val) => {
                    const t = thresholds[metric];
                    const colors = getThemeColors();
                    if (!t) return colors.sparklineNeutral;
                    if (t.inverted) {
                        if (val <= t.good) return colors.sparklineGood;
                        if (val <= t.neutral) return colors.sparklineNeutral;
                        return colors.sparklineBad;
                    } else {
                        if (val >= t.good) return colors.sparklineGood;
                        if (val >= t.neutral) return colors.sparklineNeutral;
                        return colors.sparklineBad;
                    }
                };
                
                const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
                const fillColor = isDark ? 'rgba(255, 255, 255, 0.03)' : 'rgba(0, 0, 0, 0.03)';
                
                sparklineInstances[canvasId] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: monthlyData.labels,
                        datasets: [{
                            data: dataArray,
                            borderColor: getThemeColors().sparklineNeutral,
                            segment: {
                                borderColor: ctx => getColor(ctx.p0.parsed.y)
                            },
                            backgroundColor: fillColor,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0,
                            borderWidth: 1.5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false }, tooltip: { enabled: false } },
                        scales: { x: { display: false }, y: { display: false } }
                    }
                });
            }

            createSparkline('quitChart', monthlyData.quitRate, 'quitRate', 'quitRange');
            createSparkline('openingsChart', monthlyData.openingsRatio, 'openingsRatio', 'ratioRange');
            createSparkline('hiresChart', monthlyData.hiresRate, 'hiresRate', 'hiresRange');
            createSparkline('layoffsChart', monthlyData.layoffsRate, 'layoffsRate', 'layoffsRange');
            createSparkline('unempChart', monthlyData.unempRate.map(v => v || 0), 'unempRate', 'unempRange');
            createSparkline('fedChart', monthlyData.fedRate, 'fedRate', 'fedRange');
            createSparkline('wageChart', monthlyData.wageGrowth.map(v => v || 0), 'wageGrowth', 'wageRange');
            createSparkline('lfprChart', monthlyData.lfpr.map(v => v || 0), 'lfpr', 'lfprRange');

            // Remove loading state - reveal all content
            document.body.classList.remove('js-loading');
        }

        // Initialize
        initDashboard();
    </script>
</body>
</html>
