<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is Now a Good Time? | Job Search Timing</title>
    
    <!-- FOIT Prevention: Apply theme BEFORE body renders -->
    <script>
        (function() {
            const saved = localStorage.getItem('dashboard-theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = saved || (prefersDark ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <style>
        /* ========================================
           CSS CUSTOM PROPERTIES - DARK (DEFAULT)
           ======================================== */
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --bg-card: #161620;
            --text-primary: #e8e8ed;
            --text-secondary: #9898a8;
            --text-muted: #606070;
            
            --accent-green: #00d9a0;
            --accent-green-dim: rgba(0, 217, 160, 0.12);
            --accent-yellow: #ffc940;
            --accent-yellow-dim: rgba(255, 201, 64, 0.12);
            --accent-orange: #ff8c40;
            --accent-orange-dim: rgba(255, 140, 64, 0.12);
            --accent-red: #ff4d6a;
            --accent-red-dim: rgba(255, 77, 106, 0.12);
            --accent-blue: #4d9fff;
            --border-color: #28283a;
            --bg-hover: #1e1e2a;
            --accent-blue-dim: rgba(77, 159, 255, 0.12);
            
            --accent-green-text: #00d9a0;
            --accent-yellow-text: #ffc940;
            --accent-orange-text: #ff8c40;
            --accent-red-text: #ff4d6a;
            
            --chart-grid: rgba(255, 255, 255, 0.04);
            --chart-tooltip-bg: rgba(22, 22, 32, 0.95);
            --chart-tooltip-border: #28283a;
            
            --sparkline-good: #00d9a0;
            --sparkline-neutral: #ffc940;
            --sparkline-bad: #ff4d6a;
            
            --noise-opacity: 0.025;
            --theme-transition: 200ms ease;
        }

        /* ========================================
           LIGHT MODE OVERRIDES
           ======================================== */
        [data-theme="light"] {
            --bg-primary: #f5f6f8;
            --bg-secondary: #ffffff;
            --bg-tertiary: #ecedf0;
            --bg-card: #ffffff;
            
            --text-primary: #1a1a2e;
            --text-secondary: #5a5a6e;
            --text-muted: #8888a0;
            
            --border-color: #d8dae0;
            --bg-hover: #e8e9ec;
            --accent-blue-dim: rgba(30, 100, 200, 0.12);
            
            --accent-green-dim: rgba(0, 160, 112, 0.12);
            --accent-yellow-dim: rgba(180, 140, 0, 0.15);
            --accent-orange-dim: rgba(220, 120, 40, 0.12);
            --accent-red-dim: rgba(220, 60, 80, 0.12);
            
            --accent-green-text: #00a070;
            --accent-yellow-text: #c99700;
            --accent-orange-text: #d2691e;
            --accent-red-text: #dc3545;
            
            --chart-grid: rgba(0, 0, 0, 0.06);
            --chart-tooltip-bg: rgba(255, 255, 255, 0.95);
            --chart-tooltip-border: #d8dae0;
            
            --sparkline-good: #00a070;
            --sparkline-neutral: #b48c00;
            --sparkline-bad: #dc3545;
            
            --noise-opacity: 0;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .accordion-trigger:focus,
        .about-header:focus {
            outline: 2px solid var(--accent-blue);
            outline-offset: 2px;
        }

        .accordion-trigger:focus:not(:focus-visible),
        .about-header:focus:not(:focus-visible) {
            outline: none;
        }

        .skeleton {
            background: linear-gradient(90deg, 
                var(--bg-tertiary) 25%, 
                rgba(255,255,255,0.08) 50%, 
                var(--bg-tertiary) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
        }

        .skeleton-text { height: 1em; display: inline-block; min-width: 60px; }
        .skeleton-score { width: 80px; height: 4.5rem; display: inline-block; }
        .skeleton-badge { width: 120px; height: 32px; border-radius: 20px; }

        .js-loading .metric-value,
        .js-loading .score-value,
        .js-loading .score-verdict,
        .js-loading .score-change,
        .js-loading .score-context,
        .js-loading .action-content,
        .js-loading .scenarios-section .narrative-assessment,
        .js-loading .scenarios-section .narrative-interpretation,
        .js-loading .scenarios-section .controls-row,
        .js-loading .data-freshness {
            visibility: hidden;
        }

        .js-loading .skeleton { visibility: visible; }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            transition: background var(--theme-transition), color var(--theme-transition);
        }

        .noise-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            opacity: var(--noise-opacity);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            z-index: 1000;
            transition: opacity var(--theme-transition);
        }

        /* ========================================
           PHASE 8: STICKY NAVIGATION
           ======================================== */
        .sticky-nav {
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 500;
            background: rgba(10, 10, 15, 0.88);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
            transform: translateY(-100%);
            transition: transform 0.3s ease, background var(--theme-transition), border-color var(--theme-transition);
            padding: 0 24px;
        }

        .sticky-nav.visible { transform: translateY(0); }

        [data-theme="light"] .sticky-nav {
            background: rgba(245, 246, 248, 0.88);
        }

        .nav-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 24px;
            height: 40px;
        }

        .nav-link {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            text-decoration: none;
            padding: 10px 0;
            border: none;
            border-bottom: 2px solid transparent;
            background: none;
            cursor: pointer;
            transition: color 0.2s, border-color 0.2s;
            white-space: nowrap;
        }

        .nav-link:hover { color: var(--text-secondary); }

        .nav-link.active {
            color: var(--text-primary);
            border-bottom-color: var(--accent-blue);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        header {
            margin-bottom: 32px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 24px;
            transition: border-color var(--theme-transition);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        h1 {
            font-family: 'Instrument Serif', serif;
            font-size: 2.2rem;
            font-weight: 400;
            letter-spacing: -0.02em;
            color: var(--text-primary);
        }

        .header-meta { text-align: right; }

        .last-updated {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 4px;
            display: block;
            margin-bottom: 6px;
            transition: background var(--theme-transition), color var(--theme-transition);
        }

        .next-update {
            font-size: 0.6rem;
            color: var(--text-muted);
            transition: color var(--theme-transition);
        }

        .data-freshness {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.6rem;
            margin-top: 4px;
        }

        .freshness-dot { width: 6px; height: 6px; border-radius: 50%; }
        .freshness-dot.fresh { background: var(--accent-green); box-shadow: 0 0 4px var(--accent-green); }
        .freshness-dot.stale { background: var(--accent-yellow); box-shadow: 0 0 4px var(--accent-yellow); }
        .freshness-dot.old { background: var(--accent-orange); box-shadow: 0 0 4px var(--accent-orange); }
        .freshness-text { color: var(--text-muted); }
        .freshness-text.fresh { color: var(--accent-green-text); }
        .freshness-text.stale { color: var(--accent-yellow-text); }
        .freshness-text.old { color: var(--accent-orange-text); }

        .theme-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-top: 8px;
            transition: all var(--theme-transition);
        }

        .theme-toggle:hover { background: var(--border-color); color: var(--text-secondary); }
        .theme-toggle svg { width: 14px; height: 14px; }
        .theme-toggle .icon-sun { display: none; stroke: currentColor; stroke-width: 2; fill: none; }
        .theme-toggle .icon-moon { display: block; fill: currentColor; }
        [data-theme="light"] .theme-toggle .icon-sun { display: block; }
        [data-theme="light"] .theme-toggle .icon-moon { display: none; }

        .subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
            max-width: 700px;
        }

        /* About Section */
        .about-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 24px;
            overflow: hidden;
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .about-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            cursor: pointer;
            user-select: none;
            transition: background var(--theme-transition);
        }

        .about-header:hover { background: var(--bg-tertiary); border-radius: 8px; }

        .about-header h2 {
            font-family: 'Instrument Serif', serif;
            font-size: 1.1rem;
            font-weight: 400;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: color var(--theme-transition);
        }

        .about-toggle {
            font-size: 0.7rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color var(--theme-transition);
        }

        .about-toggle .icon { transition: transform 0.2s ease; }
        .about-section.collapsed .about-toggle .icon { transform: rotate(-90deg); }

        .about-content {
            padding: 0 24px 24px 24px;
            display: grid;
            grid-template-columns: 1.4fr 1fr;
            gap: 32px;
        }

        .about-section.collapsed .about-content { display: none; }

        .about-main p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 10px;
            transition: color var(--theme-transition);
        }

        .about-main p:last-child { margin-bottom: 0; }
        .about-main strong { color: var(--text-primary); }
        .about-main em { color: var(--accent-yellow-text); font-style: normal; }
        .about-note { font-size: 0.7rem !important; color: var(--text-muted) !important; margin-top: 12px !important; }

        .about-how {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px 20px;
            transition: background var(--theme-transition);
        }

        .about-how h3 {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 12px;
            transition: color var(--theme-transition);
        }

        .about-how ul { list-style: none; padding: 0; margin: 0; }

        .about-how li {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            padding-left: 0;
            transition: color var(--theme-transition);
        }

        .about-how li strong { color: var(--text-primary); }

        /* Hero Score Section */
        .hero-score {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 28px 32px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .hero-score::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-orange) 33%, var(--accent-yellow) 66%, var(--accent-green));
        }

        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .score-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 8px;
            transition: color var(--theme-transition);
        }

        .score-display { display: flex; align-items: baseline; gap: 8px; }

        .score-value {
            font-size: 4.5rem;
            font-weight: 700;
            line-height: 1;
            font-variant-numeric: tabular-nums;
            transition: color var(--theme-transition);
        }

        .score-approx {
            font-size: 1.5rem;
            font-weight: 400;
            color: var(--text-muted);
            margin-right: -4px;
            transition: color var(--theme-transition);
        }

        .score-value.good-time { color: var(--accent-green-text); }
        .score-value.worth-exploring { color: var(--accent-yellow-text); }
        .score-value.build-your-position { color: var(--accent-orange-text); }
        .score-value.tough-market { color: var(--accent-red-text); }

        .score-max { font-size: 1.2rem; color: var(--text-muted); transition: color var(--theme-transition); }
        .score-meta { text-align: right; }

        .score-verdict {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
            transition: background var(--theme-transition), color var(--theme-transition), border-color var(--theme-transition);
        }

        .score-verdict.good-time { background: var(--accent-green-dim); color: var(--accent-green-text); border: 1px solid var(--accent-green); }
        .score-verdict.worth-exploring { background: var(--accent-yellow-dim); color: var(--accent-yellow-text); border: 1px solid var(--accent-yellow); }
        .score-verdict.build-your-position { background: var(--accent-orange-dim); color: var(--accent-orange-text); border: 1px solid var(--accent-orange); }
        .score-verdict.tough-market { background: var(--accent-red-dim); color: var(--accent-red-text); border: 1px solid var(--accent-red); }

        .verdict-icon { width: 8px; height: 8px; border-radius: 50%; animation: pulse 2s infinite; }
        .verdict-icon.good-time { background: var(--accent-green); }
        .verdict-icon.worth-exploring { background: var(--accent-yellow); }
        .verdict-icon.build-your-position { background: var(--accent-orange); }
        .verdict-icon.tough-market { background: var(--accent-red); }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        .score-change { font-size: 0.75rem; color: var(--text-muted); transition: color var(--theme-transition); }

        /* PHASE 8: Inline Score Context */
        .score-context {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 4px 12px;
            margin-top: 10px;
            font-size: 0.65rem;
        }

        .context-chip { display: inline-flex; align-items: center; gap: 4px; }
        .context-chip-label { color: var(--text-muted); transition: color var(--theme-transition); }
        .context-chip-value { color: var(--text-secondary); font-weight: 500; font-variant-numeric: tabular-nums; transition: color var(--theme-transition); }
        .context-sep { color: var(--text-muted); opacity: 0.4; transition: color var(--theme-transition); }

        /* Action Section */
        .action-section {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 20px 24px;
            transition: background var(--theme-transition);
        }

        .action-header {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color var(--theme-transition);
        }

        .action-content {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.7;
            transition: color var(--theme-transition);
        }

        .action-content strong { color: var(--text-primary); }

        .action-list { margin-top: 12px; padding-left: 0; list-style: none; }

        .action-list li { margin-bottom: 8px; padding-left: 20px; position: relative; }

        .action-list li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--accent-green-text);
            font-size: 0.7rem;
        }

        .action-section.build-your-position .action-list li::before,
        .action-section.tough-market .action-list li::before {
            content: '→';
            color: var(--text-muted);
        }

        .vibe-validation {
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding: 12px 16px;
            margin: 12px 0;
            background: var(--bg-primary);
            border-radius: 6px;
            border-left: 3px solid var(--text-muted);
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .vibe-validation em {
            font-style: normal;
        }

        .action-section.build-your-position .vibe-validation,
        .action-section.tough-market .vibe-validation {
            border-left-color: var(--accent-orange);
        }

        /* Score Guide */
        .score-guide {
            padding-top: 16px;
            margin-top: 20px;
            border-top: 1px solid var(--border-color);
            transition: border-color var(--theme-transition);
        }

        .score-guide-trigger {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 0.65rem;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            background: none;
            border: none;
            width: 100%;
            font-family: 'JetBrains Mono', monospace;
            transition: color var(--theme-transition);
        }

        .score-guide-trigger:hover { color: var(--text-secondary); }
        .score-guide-trigger:focus { outline: 2px solid var(--accent-blue); outline-offset: 2px; }
        .score-guide-trigger:focus:not(:focus-visible) { outline: none; }

        .score-guide-content { display: none; margin-top: 12px; }
        .score-guide-content.show { display: block; }

        .score-guide-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }

        @media (max-width: 600px) {
            .score-guide-grid { grid-template-columns: repeat(2, 1fr); }
        }

        .score-guide-item {
            text-align: center;
            padding: 12px 10px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            border-top: 2px solid;
            transition: background var(--theme-transition);
        }

        .score-guide-item.green { border-top-color: var(--accent-green); }
        .score-guide-item.yellow { border-top-color: var(--accent-yellow); }
        .score-guide-item.orange { border-top-color: var(--accent-orange); }
        .score-guide-item.red { border-top-color: var(--accent-red); }
        .score-guide-item.current { background: var(--bg-primary); box-shadow: inset 0 0 0 1px var(--border-color); }

        .score-guide-range { font-size: 0.75rem; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; transition: color var(--theme-transition); }
        .score-guide-feel { font-size: 0.7rem; color: var(--text-muted); line-height: 1.4; transition: color var(--theme-transition); }

        /* Main Chart */
        .main-chart {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .chart-title-row {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .chart-title { font-size: 0.9rem; font-weight: 600; color: var(--text-primary); transition: color var(--theme-transition); }

        .chart-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            font-size: 0.65rem;
            color: var(--text-muted);
            user-select: none;
            transition: color var(--theme-transition);
        }

        .chart-toggle:hover {
            color: var(--text-secondary);
        }

        .chart-toggle input[type="checkbox"] {
            width: 14px;
            height: 14px;
            accent-color: var(--accent-blue);
            cursor: pointer;
        }

        .toggle-label {
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .chart-legend { display: flex; gap: 16px; font-size: 0.65rem; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 6px; color: var(--text-secondary); }
        .legend-dot { width: 10px; height: 10px; border-radius: 2px; }
        .legend-dot.green { background: var(--accent-green); }
        .legend-dot.yellow { background: var(--accent-yellow); }
        .legend-dot.orange { background: var(--accent-orange); }
        .legend-dot.red { background: var(--accent-red); }

        .chart-container { position: relative; height: 320px; }

        /* Tier Sections */
        .tier-section { margin-bottom: 32px; }

        .tier-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .tier-badge {
            font-size: 0.55rem;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: rgba(77, 159, 255, 0.15);
            color: var(--accent-blue);
            border: 1px solid rgba(77, 159, 255, 0.3);
        }

        .tier-title { font-size: 0.85rem; font-weight: 500; color: var(--text-primary); }
        .tier-subtitle { font-size: 0.75rem; color: var(--text-muted); margin-left: 4px; }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        /* PHASE 8: Metrics Summary (mobile-only) */
        .metrics-summary { display: none; }

        .summary-items { display: flex; flex-wrap: wrap; gap: 6px 16px; margin-bottom: 10px; }

        .summary-item { display: inline-flex; align-items: center; gap: 5px; font-size: 0.7rem; }
        .summary-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
        .summary-dot.good { background: var(--accent-green); }
        .summary-dot.neutral { background: var(--accent-yellow); }
        .summary-dot.bad { background: var(--accent-red); }
        .summary-label { color: var(--text-secondary); transition: color var(--theme-transition); }
        .summary-val { color: var(--text-primary); font-weight: 600; font-variant-numeric: tabular-nums; transition: color var(--theme-transition); }

        .summary-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: var(--text-muted);
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 0;
            transition: color var(--theme-transition);
        }

        .summary-toggle:hover { color: var(--text-secondary); }
        .summary-toggle:focus { outline: 2px solid var(--accent-blue); outline-offset: 2px; }
        .summary-toggle:focus:not(:focus-visible) { outline: none; }
        .summary-toggle .chevron { transition: transform 0.2s ease; }
        .tier-section.metrics-expanded .summary-toggle .chevron { transform: rotate(180deg); margin-bottom: 0; }

        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            overflow: hidden;
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .metric-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .metric-info h3 { font-size: 0.75rem; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; transition: color var(--theme-transition); }
        .metric-info .description { font-size: 0.65rem; color: var(--text-muted); transition: color var(--theme-transition); }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            flex-shrink: 0;
            transition: color var(--theme-transition);
        }

        .metric-value.good { color: var(--accent-green-text); }
        .metric-value.neutral { color: var(--accent-yellow-text); }
        .metric-value.bad { color: var(--accent-red-text); }

        .metric-delta {
            font-size: 0.65rem; font-weight: 500; margin-left: 6px; padding: 2px 5px;
            border-radius: 3px; font-variant-numeric: tabular-nums;
            transition: color var(--theme-transition), background var(--theme-transition);
        }

        .metric-delta.up { color: var(--accent-green-text); background: var(--accent-green-dim); }
        .metric-delta.down { color: var(--accent-red-text); background: var(--accent-red-dim); }
        .metric-delta.flat { color: var(--text-muted); background: var(--bg-tertiary); }
        .metric-delta.up.inverted { color: var(--accent-red-text); background: var(--accent-red-dim); }
        .metric-delta.down.inverted { color: var(--accent-green-text); background: var(--accent-green-dim); }

        .metric-chart-wrapper { display: flex; align-items: stretch; gap: 6px; margin-top: 8px; width: 100%; max-width: 100%; }
        .metric-chart { height: 80px; flex: 1; min-width: 0; max-width: calc(100% - 38px); position: relative; }

        .sparkline-range {
            display: flex; flex-direction: column; justify-content: space-between;
            font-size: 0.55rem; color: var(--text-muted); text-align: right; padding: 2px 0; min-width: 32px;
        }

        .sparkline-range .max, .sparkline-range .min { font-variant-numeric: tabular-nums; }

        .sparkline-time {
            display: flex; justify-content: space-between;
            font-size: 0.5rem; color: var(--text-muted); margin-top: 4px; padding: 0 2px; opacity: 0.7;
        }

        /* Scenarios Section */
        .scenarios-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            transition: background var(--theme-transition), border-color var(--theme-transition);
        }

        .scenarios-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
            transition: border-color var(--theme-transition);
        }

        .scenarios-title { font-size: 0.85rem; font-weight: 600; color: var(--text-primary); }

        .narrative-assessment {
            font-size: 0.8rem; color: var(--text-secondary); line-height: 1.75;
            padding: 14px 16px; background: var(--bg-tertiary); border-radius: 8px;
            border-left: 3px solid var(--text-muted); margin-bottom: 16px;
            transition: background var(--theme-transition), color var(--theme-transition), border-color var(--theme-transition);
        }
        .narrative-assessment strong { color: var(--text-primary); }

        .narrative-interpretation {
            font-size: 0.8rem; color: var(--text-secondary); line-height: 1.75;
            padding: 14px 16px; background: var(--bg-tertiary); border-radius: 8px;
            border-left: 3px solid var(--accent-blue);
            transition: border-color 0.3s ease, background var(--theme-transition), color var(--theme-transition);
        }
        .narrative-interpretation strong { color: var(--text-primary); }

        .score-inline { font-weight: 700; font-variant-numeric: tabular-nums; }
        .category-inline { font-style: italic; }

        .narrative-interpretation.fading { opacity: 0; transition: opacity 0.2s ease; }
        .narrative-interpretation:not(.fading) { opacity: 1; transition: opacity 0.25s ease 0.05s; }

        .interp-more {
            display: none; font-family: inherit; font-size: 0.65rem; color: var(--accent-blue);
            background: none; border: none; cursor: pointer; padding: 6px 0 0; margin: 0;
        }
        .interp-more:hover { text-decoration: underline; }

        @media (max-width: 640px) {
            .interp-text:not(.expanded) {
                display: -webkit-box; -webkit-line-clamp: 3;
                -webkit-box-orient: vertical; overflow: hidden;
            }
            .interp-more.visible { display: inline-block; }
        }

        .scenario-chart-area { position: relative; height: 320px; margin-bottom: 16px; }

        .controls-row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }

        .preset-pill {
            display: inline-flex; align-items: center; gap: 5px; padding: 7px 12px;
            background: var(--bg-tertiary); border: 1px solid var(--border-color);
            border-radius: 20px; color: var(--text-secondary); font-family: inherit;
            font-size: 0.7rem; cursor: pointer; transition: all 0.2s; white-space: nowrap;
        }
        .preset-pill:hover { border-color: var(--text-muted); background: var(--bg-hover); }
        .preset-pill.active { border-color: var(--accent-blue); background: var(--accent-blue-dim); color: var(--text-primary); }
        .pill-score { font-weight: 700; font-variant-numeric: tabular-nums; }

        .controls-sep { width: 1px; height: 20px; background: var(--border-color); margin: 0 2px; }

        .slider-toggle {
            display: inline-flex; align-items: center; gap: 5px; padding: 7px 12px;
            background: transparent; border: 1px solid var(--border-color); border-radius: 20px;
            color: var(--text-muted); font-family: inherit; font-size: 0.7rem;
            cursor: pointer; transition: all 0.2s; white-space: nowrap;
        }
        .slider-toggle:hover { color: var(--text-secondary); border-color: var(--text-muted); }
        .slider-toggle.open { color: var(--text-primary); border-color: var(--accent-blue); background: var(--accent-blue-dim); }
        .toggle-arrow { transition: transform 0.3s; display: inline-block; font-size: 0.6rem; }
        .slider-toggle.open .toggle-arrow { transform: rotate(180deg); }

        .slider-panel {
            max-height: 500px; overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s ease, margin 0.3s ease;
            opacity: 1; margin-top: 16px;
        }
        .slider-panel.collapsed { max-height: 0; opacity: 0; margin-top: 0; }

        .slider-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .slider-grid .slider-group:last-child:nth-child(odd) { grid-column: 1 / -1; }

        .slider-group { padding: 12px 16px; background: var(--bg-tertiary); border-radius: 8px; transition: background var(--theme-transition); }
        .slider-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .slider-name { font-size: 0.7rem; color: var(--text-primary); font-weight: 500; }
        .slider-vals { display: flex; align-items: center; gap: 5px; font-size: 0.68rem; }
        .slider-cur { color: var(--text-muted); }
        .slider-arrow { color: var(--text-muted); font-size: 0.6rem; }
        .slider-proj { font-weight: 600; }
        .slider-proj.same { color: var(--text-secondary); }
        .slider-proj.better { color: var(--accent-green-text); }
        .slider-proj.worse { color: var(--accent-red-text); }

        input[type="range"] {
            width: 100%; height: 4px; -webkit-appearance: none; appearance: none;
            background: var(--bg-primary); border-radius: 2px; outline: none; margin-top: 4px;
            transition: background var(--theme-transition);
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 14px; height: 14px; border-radius: 50%;
            background: var(--text-secondary); cursor: pointer; border: 2px solid var(--bg-secondary);
            transition: background 0.15s;
        }
        input[type="range"]:focus::-webkit-slider-thumb { background: var(--accent-blue); box-shadow: 0 0 0 3px rgba(77, 159, 255, 0.2); }
        input[type="range"]::-moz-range-thumb {
            width: 14px; height: 14px; border-radius: 50%;
            background: var(--text-secondary); cursor: pointer; border: 2px solid var(--bg-secondary);
        }
        input[type="range"]:focus::-moz-range-thumb { background: var(--accent-blue); }

        /* Accordion */
        .accordion-section {
            background: var(--bg-secondary); border: 1px solid var(--border-color);
            border-radius: 12px; margin-bottom: 24px; overflow: hidden;
        }

        .accordion-header {
            font-size: 0.9rem; font-weight: 600; color: var(--text-primary);
            padding: 20px 24px; border-bottom: 1px solid var(--border-color);
        }

        .accordion-item { border-bottom: 1px solid var(--border-color); }
        .accordion-item:last-child { border-bottom: none; }

        .accordion-trigger {
            display: flex; justify-content: space-between; align-items: center;
            width: 100%; padding: 16px 24px; background: none; border: none;
            color: var(--text-primary); font-family: inherit; font-size: 0.8rem;
            font-weight: 500; cursor: pointer; text-align: left;
        }

        .accordion-trigger:hover { background: var(--bg-tertiary); }
        .accordion-trigger .icon { color: var(--text-muted); transition: transform 0.2s ease; font-size: 0.6rem; }

        .chevron {
            display: inline-block; width: 8px; height: 8px;
            border-right: 2px solid var(--text-muted); border-bottom: 2px solid var(--text-muted);
            transform: rotate(45deg); transition: transform 0.2s ease; margin-bottom: 2px;
        }

        .accordion-item.open .chevron,
        .about-section.collapsed .chevron {
            transform: rotate(-135deg); margin-bottom: -2px;
        }

        .about-section:not(.collapsed) .chevron { transform: rotate(45deg); }
        .accordion-item.open .accordion-trigger .icon { transform: rotate(180deg); }

        .accordion-panel { display: none; padding: 0 24px 20px 24px; }
        .accordion-item.open .accordion-panel { display: block; }

        .accordion-panel p { font-size: 0.75rem; color: var(--text-secondary); line-height: 1.7; margin-bottom: 12px; }
        .accordion-panel p:last-child { margin-bottom: 0; }
        .accordion-panel ul { font-size: 0.75rem; color: var(--text-secondary); line-height: 1.7; margin-left: 20px; margin-bottom: 12px; }
        .accordion-panel li { margin-bottom: 6px; }
        .accordion-panel strong { color: var(--text-primary); }
        .accordion-panel a { color: var(--accent-blue); text-decoration: none; }
        .accordion-panel a:hover { text-decoration: underline; }

        .formula-block { margin-top: 16px; padding: 14px 16px; background: var(--bg-primary); border-radius: 8px; border-left: 3px solid var(--accent-blue); }
        .formula-block strong { display: block; margin-bottom: 8px; font-size: 0.7rem; }
        .formula-block code { display: block; font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; color: var(--accent-yellow-text); background: var(--bg-tertiary); padding: 10px 12px; border-radius: 4px; margin-bottom: 10px; overflow-x: auto; }
        .formula-block p { font-size: 0.65rem; margin-bottom: 8px; }
        .formula-block a { font-size: 0.65rem; }

        /* Footer */
        footer {
            text-align: left; padding: 28px 0; font-size: 0.7rem; color: var(--text-muted);
            border-top: 1px solid var(--border-color); margin-top: 20px;
            transition: color var(--theme-transition), border-color var(--theme-transition);
        }

        .footer-content { display: grid; grid-template-columns: 1.5fr 1fr 1fr; gap: 32px; margin-bottom: 20px; }

        .footer-content strong {
            color: var(--text-secondary); display: block; margin-bottom: 6px;
            font-size: 0.65rem; text-transform: uppercase; letter-spacing: 0.08em;
            transition: color var(--theme-transition);
        }

        .footer-about { line-height: 1.6; }
        .footer-links a { color: var(--accent-blue); text-decoration: none; }
        .footer-links a:hover { text-decoration: underline; }

        .footer-bottom {
            padding-top: 16px; border-top: 1px solid var(--border-color);
            text-align: center; color: var(--text-muted); font-size: 0.65rem;
        }

        /* ========================================
           RESPONSIVE
           ======================================== */
        @media (max-width: 900px) {
            .about-content { grid-template-columns: 1fr; gap: 20px; }
            .footer-content { grid-template-columns: 1fr; gap: 20px; }
            .chart-legend { justify-content: flex-start; }
            .slider-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .container { padding: 16px; }
            h1 { font-size: 1.6rem; }
            .score-value { font-size: 3rem; }
            .score-approx { font-size: 1.2rem; }
            .metrics-grid { grid-template-columns: 1fr; }
            .header-top { flex-direction: column; gap: 12px; }
            .header-meta { text-align: left; }
            .chart-legend { gap: 8px; font-size: 0.55rem; }
            .legend-item { gap: 4px; }
            .legend-dot { width: 8px; height: 8px; }
            .score-header { flex-direction: column; gap: 16px; }
            .score-meta { text-align: left; }
            .tier-header { flex-wrap: wrap; }
            .tier-subtitle { width: 100%; margin-left: 0; margin-top: 4px; }
            .accordion-trigger { padding: 14px 16px; font-size: 0.75rem; }
            .accordion-panel { padding: 0 16px 16px 16px; }
            .scenarios-section { padding: 16px; }
            .scenario-chart-area { height: 260px; }
            .controls-sep { display: none; }
            .controls-row { gap: 6px; }
            .preset-pill, .slider-toggle { padding: 6px 10px; font-size: 0.65rem; }
            .nav-inner { gap: 16px; }
            .nav-link { font-size: 0.55rem; letter-spacing: 0.05em; }
            .sticky-nav { padding: 0 16px; }

            /* PHASE 8: Mobile metrics collapse */
            .metrics-summary {
                display: block;
                padding: 12px 16px;
                background: var(--bg-secondary);
                border: 1px solid var(--border-color);
                border-radius: 10px;
                margin-bottom: 12px;
                transition: background var(--theme-transition), border-color var(--theme-transition);
            }

            .metrics-grid {
                max-height: 3000px;
                overflow: hidden;
                opacity: 1;
                transition: max-height 0.4s ease, opacity 0.3s ease;
            }

            .metrics-grid.mobile-collapsed {
                max-height: 0;
                opacity: 0;
                margin-top: 0;
            }
        }

        @media (max-width: 480px) {
            .chart-legend { flex-direction: column; align-items: flex-start; gap: 6px; }
            .about-how ul { font-size: 0.7rem; }
            .action-list li { font-size: 0.75rem; }
            .metric-header { flex-direction: column; gap: 8px; }
            .metric-value { font-size: 1.5rem; }
            .sparkline-range { font-size: 0.5rem; min-width: 28px; }
            .metric-chart { max-width: calc(100% - 34px); }
            .metric-card { padding: 16px; }
            .nav-inner { gap: 12px; }
            .nav-link { font-size: 0.5rem; }
        }

        /* ========================================
           PRINT STYLES
           ======================================== */
        @media print {
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            body { background: white !important; color: #1a1a1a !important; font-size: 11pt; }
            .noise-overlay, .sticky-nav { display: none !important; }
            .container { max-width: 100%; padding: 0; }
            .about-section, .accordion-section, .chevron, .about-toggle, footer, .metrics-summary { display: none !important; }
            header { border-bottom: 2px solid #333; padding-bottom: 12px; margin-bottom: 16px; }
            h1 { color: #1a1a1a !important; font-size: 24pt; }
            .subtitle { color: #444 !important; }
            .header-meta { text-align: left; margin-top: 8px; }
            .last-updated { background: none !important; padding: 0; color: #666 !important; display: inline; }
            .next-update, .data-freshness { display: none; }
            .hero-score { background: #f5f5f5 !important; border: 1px solid #ccc !important; page-break-inside: avoid; }
            .hero-score::before { display: none; }
            .score-value { color: #1a1a1a !important; }
            .score-verdict { background: none !important; border: 1px solid currentColor !important; }
            .action-section { background: #f9f9f9 !important; border-color: #999 !important; }
            .metric-chart-wrapper, .sparkline-time, .sparkline-range { display: none !important; }
            .metrics-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; max-height: none !important; opacity: 1 !important; }
            .metric-card { background: #f5f5f5 !important; border: 1px solid #ddd !important; padding: 8px !important; page-break-inside: avoid; }
            .metric-header { flex-direction: column; gap: 2px; }
            .metric-info h3 { font-size: 9pt; color: #333 !important; }
            .metric-info .description { display: none; }
            .metric-value { font-size: 14pt !important; }
            .metric-delta { display: none; }
            .main-chart { background: white !important; border: 1px solid #ccc !important; page-break-inside: avoid; }
            .chart-title { color: #1a1a1a !important; }
            .chart-legend { font-size: 8pt; }
            .legend-dot { border: 1px solid #999; }
            .scenarios-section { background: #f5f5f5 !important; border: 1px solid #ccc !important; page-break-before: always; }
            .narrative-assessment, .narrative-interpretation { background: #f9f9f9 !important; border-left-color: #999 !important; }
            .slider-panel, .interp-more { display: none !important; }
            .tier-badge { background: none !important; border: 1px solid currentColor !important; }
            .tier-title, .tier-subtitle { color: #333 !important; }
            .tier-section { page-break-inside: avoid; }
        }
    </style>
</head>
<body class="js-loading">
    <div class="noise-overlay"></div>
    
    <!-- PHASE 8: Sticky Navigation -->
    <nav class="sticky-nav" id="stickyNav" aria-label="Section navigation">
        <div class="nav-inner">
            <button class="nav-link" data-nav-target="score">Score</button>
            <button class="nav-link" data-nav-target="chart">Chart</button>
            <button class="nav-link" data-nav-target="metrics">Metrics</button>
            <button class="nav-link" data-nav-target="scenarios">Scenarios</button>
            <button class="nav-link" data-nav-target="method">Method</button>
        </div>
    </nav>
    
    <div class="container">
        <header>
            <div class="header-top">
                <h1>Is Now a Good Time?</h1>
                <div class="header-meta">
                    <span class="last-updated" id="lastUpdated"><span class="skeleton skeleton-text" style="width: 180px;"></span></span>
                    <span class="next-update" id="nextUpdate">Next update expected: ~Feb 7</span>
                    <div class="data-freshness" id="dataFreshness">
                        <span class="freshness-dot"></span>
                        <span class="freshness-text"></span>
                    </div>
                    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle light/dark theme">
                        <svg class="icon-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>
                        <svg class="icon-moon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
                        <span>Theme</span>
                    </button>
                </div>
            </div>
            <p class="subtitle">Giving job seekers the same market intelligence employers have. An experiment in AI-assisted pro-worker tooling.</p>
        </header>

        <!-- PHASE 8: About section defaults to collapsed -->
        <section class="about-section collapsed" id="aboutSection">
            <div class="about-header" 
                 onclick="toggleAbout()" 
                 onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleAbout();}"
                 role="button" 
                 tabindex="0" 
                 aria-expanded="false" 
                 aria-controls="aboutContent"
                 id="aboutHeader">
                <h2>What is this?</h2>
                <span class="about-toggle">
                    <span id="aboutToggleText">Show</span>
                    <span class="chevron"></span>
                </span>
            </div>
            <div class="about-content" id="aboutContent">
                <div class="about-main">
                    <p>Job market conditions shift before the narrative catches up. By the time "it's a great market" or "hiring is frozen" becomes conventional wisdom, the data has usually been pointing that direction for months.</p>
                    <p>This dashboard uses eight economic indicators to cut through the noise and give job seekers a clearer, earlier read on conditions. The score runs from 0 to 100 — higher means better for workers. Data comes from the Bureau of Labor Statistics and Federal Reserve, updated monthly.</p>
                    <p>Start with the score, then explore what's driving it, then see what would need to change.</p>
                    <p class="about-note">This tracks the US labor market overall. Tech can freeze 18 months before it shows in national data; healthcare and government often move on different cycles entirely. If your sector feels worse than the score suggests, trust your network over the number.</p>
                </div>
                <div class="about-how">
                    <h3>What the score means</h3>
                    <ul>
                        <li><strong>70+</strong> — Opportunities find you. Real leverage to negotiate.</li>
                        <li><strong>55–69</strong> — Opportunities if you look. Some room to negotiate.</li>
                        <li><strong>40–54</strong> — Slow going. Employers can afford to wait.</li>
                        <li><strong>&lt;40</strong> — Hiring freezes. Little leverage.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Hero Score -->
        <section class="hero-score" data-nav-section="score">
            <div class="score-header">
                <div>
                    <div class="score-label">The Score</div>
                    <div class="score-display">
                        <span class="score-approx">~</span>
                        <span class="score-value" id="currentScore"><span class="skeleton skeleton-score"></span></span>
                        <span class="score-max">/ 100</span>
                    </div>
                </div>
                <div class="score-meta">
                    <div class="score-verdict" id="scoreVerdict">
                        <span class="verdict-icon" id="verdictIcon"></span>
                        <span id="verdictText"><span class="skeleton skeleton-text" style="width: 100px;"></span></span>
                    </div>
                    <div class="score-change" id="scoreChange"><span class="skeleton skeleton-text" style="width: 140px;"></span></div>
                    <!-- PHASE 8: Inline context replacing standalone section -->
                    <div class="score-context" id="scoreContext"></div>
                </div>
            </div>
            
            <div class="action-section" id="actionSection">
                <div class="action-header">
                    <span>💡</span>
                    <span>What does this mean?</span>
                </div>
                <div class="action-content" id="actionContent">
                    <span class="skeleton skeleton-text" style="width: 100%;"></span>
                    <span class="skeleton skeleton-text" style="width: 90%; margin-top: 8px;"></span>
                </div>
            </div>

            <div class="score-guide">
                <button class="score-guide-trigger" 
                        onclick="toggleScoreGuide()"
                        aria-expanded="false"
                        aria-controls="scoreGuideContent"
                        id="scoreGuideTrigger">
                    <span id="scoreGuideText">What does a different score feel like?</span>
                    <span id="scoreGuideChevron">▾</span>
                </button>
                <div class="score-guide-content" id="scoreGuideContent">
                    <div class="score-guide-grid">
                        <div class="score-guide-item red" id="guideRed">
                            <div class="score-guide-range">&lt;40</div>
                            <div class="score-guide-feel">Hiring freezes. Little leverage.</div>
                        </div>
                        <div class="score-guide-item orange" id="guideOrange">
                            <div class="score-guide-range">40–54</div>
                            <div class="score-guide-feel">Slow going. Employers can afford to wait.</div>
                        </div>
                        <div class="score-guide-item yellow" id="guideYellow">
                            <div class="score-guide-range">55–69</div>
                            <div class="score-guide-feel">Opportunities if you look. Some room to negotiate.</div>
                        </div>
                        <div class="score-guide-item green" id="guideGreen">
                            <div class="score-guide-range">70+</div>
                            <div class="score-guide-feel">Opportunities find you. Real leverage to negotiate.</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Time Series Chart -->
        <section class="main-chart" data-nav-section="chart">
            <div class="chart-header">
                <div class="chart-title-row">
                    <div class="chart-title" id="chartTitle">How has the market shifted?</div>
                    <label class="chart-toggle">
                        <input type="checkbox" id="annotationsToggle" onchange="toggleChartAnnotations()">
                        <span class="toggle-label">Show key moments</span>
                    </label>
                </div>
                <div class="chart-legend">
                    <div class="legend-item"><span class="legend-dot green"></span> Good Time to Move (70+)</div>
                    <div class="legend-item"><span class="legend-dot yellow"></span> Worth Exploring (55–69)</div>
                    <div class="legend-item"><span class="legend-dot orange"></span> Build Your Position (40–54)</div>
                    <div class="legend-item"><span class="legend-dot red"></span> Get Creative (&lt;40)</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="mainChart" role="img" aria-label="Line chart showing job search readiness composite score from 2015 to present, with scores ranging from 0 to 100"></canvas>
                <p class="sr-only" id="mainChartDesc">Historical composite score tracking labor market conditions for job seekers. Higher scores indicate better conditions for finding new employment.</p>
            </div>
        </section>

        <!-- Core Metrics -->
        <section class="tier-section" id="coreSection" data-nav-section="metrics">
            <div class="tier-header">
                <span class="tier-badge">Core</span>
                <span class="tier-title">The Core Metrics</span>
                <span class="tier-subtitle">— How much leverage do workers have right now?</span>
            </div>
            <!-- PHASE 8: Mobile summary -->
            <div class="metrics-summary" id="coreSummary">
                <div class="summary-items" id="coreSummaryItems"></div>
                <button class="summary-toggle" onclick="toggleMetrics('coreSection')" aria-expanded="false">
                    <span class="toggle-text">Show 4 metrics</span>
                    <span class="chevron"></span>
                </button>
            </div>
            <div class="metrics-grid" id="coreMetricsGrid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Quit Rate</h3>
                            <span class="description">Workers confident enough to leave voluntarily</span>
                        </div>
                        <span class="metric-value" id="quitValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="quitChart" role="img" aria-label="Quit rate trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="quitRange"><span class="max">--</span><span class="min">--</span></div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Jobs per Job Seeker</h3>
                            <span class="description">Open positions ÷ unemployed workers</span>
                        </div>
                        <span class="metric-value" id="ratioValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="openingsChart" role="img" aria-label="Jobs per job seeker trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="ratioRange"><span class="max">--</span><span class="min">--</span></div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Hiring Rate</h3>
                            <span class="description">Actual hires happening, not just postings</span>
                        </div>
                        <span class="metric-value" id="hiresValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="hiresChart" role="img" aria-label="Hiring rate trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="hiresRange"><span class="max">--</span><span class="min">--</span></div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Layoff Rate</h3>
                            <span class="description">Involuntary job losses</span>
                        </div>
                        <span class="metric-value" id="layoffsValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="layoffsChart" role="img" aria-label="Layoff rate trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="layoffsRange"><span class="max">--</span><span class="min">--</span></div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
            </div>
        </section>

        <!-- Bigger Picture -->
        <section class="tier-section" id="contextSection">
            <div class="tier-header">
                <span class="tier-badge">Context</span>
                <span class="tier-title">The Bigger Picture</span>
                <span class="tier-subtitle">— Economic forces shaping the job market</span>
            </div>
            <!-- PHASE 8: Mobile summary -->
            <div class="metrics-summary" id="contextSummary">
                <div class="summary-items" id="contextSummaryItems"></div>
                <button class="summary-toggle" onclick="toggleMetrics('contextSection')" aria-expanded="false">
                    <span class="toggle-text">Show 4 metrics</span>
                    <span class="chevron"></span>
                </button>
            </div>
            <div class="metrics-grid" id="contextMetricsGrid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Unemployment Rate</h3>
                            <span class="description">Share of workforce without jobs</span>
                        </div>
                        <span class="metric-value" id="unempValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="unempChart" role="img" aria-label="Unemployment rate trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="unempRange"><span class="max">--</span><span class="min">--</span></div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Fed Interest Rate</h3>
                            <span class="description">Cost of borrowing that affects hiring budgets</span>
                        </div>
                        <span class="metric-value" id="fedValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="fedChart" role="img" aria-label="Federal interest rate trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="fedRange"><span class="max">--</span><span class="min">--</span></div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Wage Growth</h3>
                            <span class="description">Year-over-year change in average pay</span>
                        </div>
                        <span class="metric-value" id="wageValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="wageChart" role="img" aria-label="Wage growth trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="wageRange"><span class="max">--</span><span class="min">--</span></div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Workforce Participation</h3>
                            <span class="description">Share of 25-54 year olds working or looking</span>
                        </div>
                        <span class="metric-value" id="lfprValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="lfprChart" role="img" aria-label="Workforce participation trend from 2015 to present"></canvas></div>
                        <div class="sparkline-range" id="lfprRange"><span class="max">--</span><span class="min">--</span></div>
                    </div>
                    <div class="sparkline-time"><span>'15</span><span>Now</span></div>
                </div>
            </div>
        </section>

        <!-- PHASE 8: "How Does This Compare?" section REMOVED — data inlined into hero score -->

        <!-- Scenarios Section -->
        <section class="scenarios-section" data-nav-section="scenarios">
            <div class="scenarios-header">
                <span class="scenarios-title">Where Things Could Go</span>
            </div>

            <div class="narrative-assessment">
                <strong>The market has been frozen since mid-2024.</strong> Overall layoffs at 1.1% remain historically low — though tech and media have seen concentrated cuts that national data smooths over. Meanwhile, hiring has stalled. Quit rates stuck near 2.0%, more job seekers than openings for the first time since 2021. Fed cuts are underway but haven't thawed hiring. The score has drifted from the mid-50s to the upper 40s.
            </div>

            <div class="scenario-chart-area">
                <canvas id="scenarioChart"></canvas>
            </div>

            <div class="narrative-interpretation" id="recoveryInterpretation" aria-live="polite">
                <div class="interp-text" id="interp-text">
                    <strong>Four scenarios show the range of plausible futures</strong> — from continued stasis to genuine recovery. The most likely path is more of the same. Pick one to explore what it means, or build your own.
                </div>
                <button class="interp-more" id="interp-more" aria-label="Read full interpretation">more ▾</button>
            </div>

            <div class="controls-row" style="margin-top: 16px;">
                <button class="preset-pill" data-key="worse" aria-pressed="false">
                    <span>⛈️</span> <span>Gets Worse</span> <span class="pill-score" data-pill="worse"></span>
                </button>
                <button class="preset-pill" data-key="frozen" aria-pressed="false">
                    <span>🥶</span> <span>Stays Frozen</span> <span class="pill-score" data-pill="frozen"></span>
                </button>
                <button class="preset-pill" data-key="now" aria-pressed="false">
                    <span>📍</span> <span>Now</span> <span class="pill-score" data-pill="now"></span>
                </button>
                <button class="preset-pill" data-key="thaw" aria-pressed="false">
                    <span>🌤️</span> <span>Gradual Thaw</span> <span class="pill-score" data-pill="thaw"></span>
                </button>
                <button class="preset-pill" data-key="boom" aria-pressed="false">
                    <span>🚀</span> <span>Bets Pay Off</span> <span class="pill-score" data-pill="boom"></span>
                </button>

                <span class="controls-sep"></span>

                <button class="slider-toggle" id="slider-toggle" aria-expanded="false" aria-controls="slider-panel">
                    Build your own <span class="toggle-arrow">▾</span>
                </button>
            </div>

            <div class="slider-panel collapsed" id="slider-panel" role="region" aria-label="Custom scenario sliders">
                <div class="slider-grid" id="slider-grid"></div>
            </div>
        </section>

        <!-- Understanding the Score -->
        <section class="accordion-section" data-nav-section="method">
            <div class="accordion-header">Understanding the Score</div>
            
            <div class="accordion-item" id="accordion-calc">
                <button class="accordion-trigger" 
                        onclick="toggleAccordion('accordion-calc')"
                        aria-expanded="false"
                        aria-controls="panel-calc">
                    <span>How is this calculated?</span>
                    <span class="chevron"></span>
                </button>
                <div class="accordion-panel" id="panel-calc" role="region" aria-labelledby="accordion-calc">
                    <p>The score combines eight labor market indicators, weighted by how directly they measure worker leverage:</p>
                    <ul>
                        <li><strong>Core metrics (60% of score):</strong> Quit rate, job openings per unemployed worker, hiring rate, and layoff rate. These directly measure whether workers or employers have the upper hand.</li>
                        <li><strong>Context metrics (40% of score):</strong> Unemployment rate, Fed interest rate, wage growth, and workforce participation. These shape the environment but are less direct.</li>
                    </ul>
                    <p>The score also applies adjustments for unusual conditions: when the job openings ratio falls below 1.0 (more seekers than jobs), when the market is "frozen" (low hiring AND low quitting), and when Fed rates are near zero (historically stimulative).</p>
                    <div class="formula-block">
                        <strong>The formula:</strong>
                        <code>Score = (0.6 × CoreAvg + 0.4 × ContextAvg) × 100 × adjustments</code>
                        <p>Each metric is normalized to 0–1 based on historical ranges (e.g., quit rate: 1.5% = 0, 3.0% = 1). Adjustments: ×0.92 if jobs/seeker &lt; 1.0; up to ×0.88 for frozen market; ×1.08 if Fed rate &lt; 0.5%.</p>
                        <a href="https://github.com/jricciardi/labor-market-dashboard/blob/main/index.html#L1850" target="_blank">View source code →</a>
                    </div>
                </div>
            </div>
            
            <div class="accordion-item" id="accordion-limits">
                <button class="accordion-trigger" 
                        onclick="toggleAccordion('accordion-limits')"
                        aria-expanded="false"
                        aria-controls="panel-limits">
                    <span>What are the limitations?</span>
                    <span class="chevron"></span>
                </button>
                <div class="accordion-panel" id="panel-limits" role="region">
                    <p><strong>This is national data.</strong> Your industry, region, and role may differ significantly. Tech hiring can freeze while healthcare booms. San Francisco and rural Ohio are different markets.</p>
                    <p><strong>The data lags reality.</strong> BLS releases come 4-6 weeks after the reference month. By the time you see it here, conditions may have shifted.</p>
                    <p><strong>The thresholds are calibrated to recent history.</strong> A "bad" quit rate today might have been normal in 2010. The score tells you how now compares to 2015-2025, not to all of history.</p>
                    <p><strong>There's no confidence interval.</strong> The score of "47" should really be read as "somewhere around 45-50" given measurement uncertainty and model choices.</p>
                </div>
            </div>
            
            <div class="accordion-item" id="accordion-data">
                <button class="accordion-trigger" 
                        onclick="toggleAccordion('accordion-data')"
                        aria-expanded="false"
                        aria-controls="panel-data">
                    <span>Where does the data come from?</span>
                    <span class="chevron"></span>
                </button>
                <div class="accordion-panel" id="panel-data" role="region">
                    <p>All data comes from official government sources, retrieved via the <a href="https://fred.stlouisfed.org/" target="_blank">Federal Reserve Economic Data (FRED)</a> API:</p>
                    <ul>
                        <li><strong>Quit rate, hiring rate, layoff rate, job openings:</strong> Bureau of Labor Statistics <a href="https://www.bls.gov/jlt/" target="_blank">Job Openings and Labor Turnover Survey (JOLTS)</a></li>
                        <li><strong>Unemployment rate, workforce participation, wage growth:</strong> Bureau of Labor Statistics <a href="https://www.bls.gov/ces/" target="_blank">Employment Situation Report</a></li>
                        <li><strong>Fed interest rate:</strong> Federal Reserve <a href="https://www.federalreserve.gov/monetarypolicy/openmarket.htm" target="_blank">Open Market Operations</a></li>
                    </ul>
                    <p>Data updates automatically each month after BLS releases. The code is open source if you want to verify or adapt it.</p>
                </div>
            </div>
        </section>

        <footer>
            <div class="footer-content">
                <div class="footer-about">
                    <strong>About this project</strong><br>
                    Built to help workers make informed decisions about job search timing. The score synthesizes government data into an actionable signal—no spin, no narratives, just numbers.<br><br>
                    This project is <a href="https://github.com/jricciardi/labor-market-dashboard">open source</a>. Fork it, adapt it for your industry, or suggest improvements. Built with AI assistance as an experiment in pro-worker tooling.
                </div>
                <div class="footer-links">
                    <strong>Resources</strong><br>
                    <a href="https://www.bls.gov/jlt/">BLS JOLTS</a> · 
                    <a href="https://fred.stlouisfed.org/">FRED</a> · 
                    <a href="https://github.com/jricciardi/labor-market-dashboard">Source Code</a>
                </div>
                <div class="footer-data">
                    <strong>Data Sources</strong><br>
                    BLS JOLTS, BLS Employment Situation, Federal Reserve
                </div>
            </div>
            <div class="footer-bottom">
                Updated monthly after BLS data releases (usually first week of the month). Not financial or career advice.
            </div>
        </footer>
    </div>

    <script>
        // ========================================
        // THEME & UI TOGGLES
        // ========================================
        let mainChartInstance = null;
        let sparklineInstances = {};
        let scenarioChart = null;
        let annotationsVisible = false;

        // Historical event annotations for main chart
        const historicalAnnotations = {
            covidCrash: {
                type: 'label',
                xValue: 'Apr-20',
                yValue: 95,
                content: ['COVID'],
                backgroundColor: 'rgba(255, 77, 106, 0.9)',
                color: '#fff',
                font: { size: 10, weight: 600 },
                padding: { top: 4, bottom: 4, left: 8, right: 8 },
                borderRadius: 4,
                callout: {
                    display: true,
                    side: 10,
                    borderColor: 'rgba(255, 77, 106, 0.6)',
                    borderWidth: 1,
                    borderDash: [3, 3]
                }
            },
            peak2022: {
                type: 'label',
                xValue: 'Feb-22',
                yValue: 95,
                content: ['Peak'],
                backgroundColor: 'rgba(0, 180, 130, 0.9)',
                color: '#fff',
                font: { size: 10, weight: 600 },
                padding: { top: 4, bottom: 4, left: 8, right: 8 },
                borderRadius: 4,
                callout: {
                    display: true,
                    side: 10,
                    borderColor: 'rgba(0, 217, 160, 0.6)',
                    borderWidth: 1,
                    borderDash: [3, 3]
                }
            },
            fedPivot: {
                type: 'label',
                xValue: 'Sep-24',
                yValue: 95,
                content: ['Fed Cuts'],
                backgroundColor: 'rgba(200, 160, 40, 0.9)',
                color: '#fff',
                font: { size: 10, weight: 600 },
                padding: { top: 4, bottom: 4, left: 8, right: 8 },
                borderRadius: 4,
                callout: {
                    display: true,
                    side: 10,
                    borderColor: 'rgba(255, 201, 64, 0.6)',
                    borderWidth: 1,
                    borderDash: [3, 3]
                }
            }
        };
        
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem('dashboard-theme', next);
            updateChartsForTheme();
        }
        
        function getThemeColors() {
            const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
            return {
                grid: isDark ? 'rgba(255, 255, 255, 0.04)' : 'rgba(0, 0, 0, 0.06)',
                tooltipBg: isDark ? 'rgba(22, 22, 32, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                tooltipBorder: isDark ? '#28283a' : '#d8dae0',
                tooltipText: isDark ? '#e8e8ed' : '#1a1a2e',
                tooltipSecondary: isDark ? '#9898a8' : '#5a5a6e',
                textMuted: isDark ? '#606070' : '#8888a0',
                sparklineGood: isDark ? '#00d9a0' : '#00a070',
                sparklineNeutral: isDark ? '#ffc940' : '#b48c00',
                sparklineBad: isDark ? '#ff4d6a' : '#dc3545',
            };
        }
        
        function updateChartsForTheme() {
            const colors = getThemeColors();
            if (mainChartInstance) {
                mainChartInstance.options.scales.x.grid.color = colors.grid;
                mainChartInstance.options.scales.y.grid.color = colors.grid;
                mainChartInstance.options.scales.x.ticks.color = colors.textMuted;
                mainChartInstance.options.scales.y.ticks.color = colors.textMuted;
                mainChartInstance.options.plugins.tooltip.backgroundColor = colors.tooltipBg;
                mainChartInstance.options.plugins.tooltip.borderColor = colors.tooltipBorder;
                mainChartInstance.options.plugins.tooltip.titleColor = colors.tooltipText;
                mainChartInstance.options.plugins.tooltip.bodyColor = colors.tooltipSecondary;
                mainChartInstance.update('none');
            }
            Object.values(sparklineInstances).forEach(chart => { if (chart) chart.update('none'); });
            if (typeof scenarioChart !== 'undefined' && scenarioChart) {
                const isDark = document.documentElement.getAttribute('data-theme') !== 'light';
                scenarioChart.options.scales.x.grid.color = colors.grid;
                scenarioChart.options.scales.y.grid.color = colors.grid;
                scenarioChart.options.scales.x.ticks.color = colors.textMuted;
                scenarioChart.options.scales.y.ticks.color = colors.textMuted;
                scenarioChart.options.plugins.tooltip.backgroundColor = colors.tooltipBg;
                scenarioChart.options.plugins.tooltip.titleColor = colors.tooltipText;
                scenarioChart.options.plugins.tooltip.bodyColor = colors.tooltipSecondary;
                scenarioChart.options.plugins.tooltip.borderColor = colors.tooltipBorder;
                const ann = scenarioChart.options.plugins.annotation.annotations;
                if (ann.branchLine) ann.branchLine.borderColor = isDark ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.08)';
                if (ann.projZone) ann.projZone.backgroundColor = isDark ? 'rgba(255,255,255,0.015)' : 'rgba(0,0,0,0.02)';
                if (ann.projLabel) ann.projLabel.color = isDark ? 'rgba(255,255,255,0.12)' : 'rgba(0,0,0,0.15)';
                scenarioChart.data.datasets[0].pointHoverBackgroundColor = isDark ? '#fff' : '#1a1a2e';
                scenarioChart.update('none');
            }
        }
        
        function toggleAbout() {
            const section = document.getElementById('aboutSection');
            const toggleText = document.getElementById('aboutToggleText');
            const header = document.getElementById('aboutHeader');
            const isCollapsed = !section.classList.contains('collapsed');
            section.classList.toggle('collapsed');
            toggleText.textContent = isCollapsed ? 'Show' : 'Hide';
            header.setAttribute('aria-expanded', !isCollapsed);
            localStorage.setItem('aboutCollapsed', isCollapsed);
        }

        function toggleAccordion(id) {
            const item = document.getElementById(id);
            const trigger = item.querySelector('.accordion-trigger');
            const isOpen = !item.classList.contains('open');
            item.classList.toggle('open');
            trigger.setAttribute('aria-expanded', isOpen);
        }

        function toggleScoreGuide() {
            const content = document.getElementById('scoreGuideContent');
            const trigger = document.getElementById('scoreGuideTrigger');
            const text = document.getElementById('scoreGuideText');
            const chevron = document.getElementById('scoreGuideChevron');
            const isOpen = content.classList.contains('show');
            content.classList.toggle('show');
            trigger.setAttribute('aria-expanded', !isOpen);
            text.textContent = isOpen ? 'What does a different score feel like?' : 'Hide score guide';
            chevron.textContent = isOpen ? '▾' : '▴';
            localStorage.setItem('scoreGuideOpen', !isOpen);
        }

        function toggleChartAnnotations() {
            const checkbox = document.getElementById('annotationsToggle');
            annotationsVisible = checkbox.checked;

            if (mainChartInstance) {
                const annotations = mainChartInstance.options.plugins.annotation.annotations;

                if (annotationsVisible) {
                    // Add historical annotations
                    Object.assign(annotations, historicalAnnotations);
                } else {
                    // Remove historical annotations
                    delete annotations.covidCrash;
                    delete annotations.peak2022;
                    delete annotations.fedPivot;
                }

                mainChartInstance.update();
            }

            // Remember preference
            localStorage.setItem('chartAnnotations', annotationsVisible);
        }

        // PHASE 8: Toggle metrics on mobile
        function toggleMetrics(sectionId) {
            var section = document.getElementById(sectionId);
            var grid = section.querySelector('.metrics-grid');
            var toggle = section.querySelector('.summary-toggle');
            var isCollapsed = grid.classList.contains('mobile-collapsed');
            
            if (isCollapsed) {
                grid.classList.remove('mobile-collapsed');
                toggle.querySelector('.toggle-text').textContent = 'Hide details';
                toggle.setAttribute('aria-expanded', 'true');
                section.classList.add('metrics-expanded');
            } else {
                grid.classList.add('mobile-collapsed');
                toggle.querySelector('.toggle-text').textContent = 'Show ' + grid.querySelectorAll('.metric-card').length + ' metrics';
                toggle.setAttribute('aria-expanded', 'false');
                section.classList.remove('metrics-expanded');
            }
        }

        // Restore UI state on load
        document.addEventListener('DOMContentLoaded', function() {
            // PHASE 8: About section defaults to collapsed; expand only if user chose
            var aboutCollapsed = localStorage.getItem('aboutCollapsed');
            if (aboutCollapsed === 'false') {
                document.getElementById('aboutSection').classList.remove('collapsed');
                document.getElementById('aboutToggleText').textContent = 'Hide';
                document.getElementById('aboutHeader').setAttribute('aria-expanded', 'true');
            }
            
            var scoreGuideOpen = localStorage.getItem('scoreGuideOpen');
            if (scoreGuideOpen === 'true') {
                document.getElementById('scoreGuideContent').classList.add('show');
                document.getElementById('scoreGuideTrigger').setAttribute('aria-expanded', 'true');
                document.getElementById('scoreGuideText').textContent = 'Hide score guide';
                document.getElementById('scoreGuideChevron').textContent = '▴';
            }
        });

        // ========================================
        // TIER NAMES & ACTION ADVICE
        // ========================================
        const tierNames = {
            'good-time': 'Good Time to Move',
            'worth-exploring': 'Worth Exploring', 
            'build-your-position': 'Build Your Position',
            'tough-market': 'Get Creative'
        };

        // Action advice for each tier
        const actionAdvice = {
            'good-time': {
                intro: 'The market favors job seekers right now. People are moving, employers are competing for talent, and there\'s room to negotiate.',
                vibe: null, // Good vibes are self-evident
                actions: [
                    'Active job searching is well-rewarded in this market',
                    'Inbound interest is worth engaging with — recruiters, referrals, former colleagues reaching out',
                    'Negotiation leverage is real—employers expect it',
                    'Informational interviews often lead somewhere'
                ]
            },
            'worth-exploring': {
                intro: 'Conditions are decent for job seekers. Opportunities are out there for those who look, though the market isn\'t handing them to you.',
                vibe: 'If the market feels middling — not terrible, but not exciting — that\'s an accurate read.',
                actions: [
                    'Strong-fit roles are worth pursuing',
                    'Networking tends to pay off in this environment',
                    'There\'s no rush—good opportunities reward patience',
                    'A thoughtful search beats a broad one right now'
                ]
            },
            'build-your-position': {
                intro: 'The market currently tilts toward employers. Competition for open roles is stiffer and timelines are longer.',
                vibe: 'If the market feels harder than the headlines suggest, you\'re not imagining it — the data shows real headwinds.',
                actions: [
                    'If your seat feels stable, invest in it — skill-building pays off when conditions turn',
                    'Quiet networking keeps doors open without pressure',
                    'Financial runway matters more in a slow market',
                    'Exceptional opportunities still exist, but are rarer'
                ]
            },
            'tough-market': {
                intro: 'Conditions favor employers. Hiring is slow, competition is high, and stability has real value.',
                vibe: 'This is genuinely difficult. The numbers confirm what your network is probably telling you.',
                actions: [
                    'Stability is an asset worth protecting right now',
                    'Skills built now will compound when conditions turn',
                    'Keeping your network warm matters—pushing it doesn\'t',
                    'Moves driven by necessity or truly exceptional fit still make sense'
                ]
            }
        };

        // ========================================
        // MAIN DASHBOARD INITIALIZATION
        // ========================================
        async function initDashboard() {
            const response = await fetch('data.json');
            const data = await response.json();
            
            const monthlyData = {
                labels: data.labels,
                quitRate: data.quitRate,
                openingsRatio: data.openingsRatio,
                hiresRate: data.hiresRate,
                layoffsRate: data.layoffsRate,
                unempRate: data.unempRate,
                fedRate: data.fedRate,
                wageGrowth: data.wageGrowth,
                lfpr: data.lfpr
            };
            
            // Timestamps
            const lastUpdated = new Date(data.metadata.lastUpdated);
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            const formattedDate = lastUpdated.toLocaleDateString('en-US', options);
            const dataMonth = data.metadata.dataThrough.split('-');
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const dataThrough = monthNames[parseInt(dataMonth[1]) - 1] + ' ' + dataMonth[0];
            document.getElementById('lastUpdated').textContent = 'Updated ' + formattedDate + ' \u2022 Data through ' + dataThrough;
            
            var dataThroughDate = new Date(parseInt(dataMonth[0]), parseInt(dataMonth[1]) - 1, 1);
            var today = new Date();
            var nextReleaseMonth = new Date(dataThroughDate);
            nextReleaseMonth.setMonth(nextReleaseMonth.getMonth() + 2);
            nextReleaseMonth.setDate(7);
            if (nextReleaseMonth < today) nextReleaseMonth.setMonth(nextReleaseMonth.getMonth() + 1);
            document.getElementById('nextUpdate').textContent = 'Next update: ~' + monthNames[nextReleaseMonth.getMonth()] + ' ' + nextReleaseMonth.getDate();
            
            var dataEndDate = new Date(parseInt(dataMonth[0]), parseInt(dataMonth[1]), 0);
            var daysSinceData = Math.floor((today - dataEndDate) / (1000 * 60 * 60 * 24));
            var freshnessEl = document.getElementById('dataFreshness');
            var freshnessDot = freshnessEl.querySelector('.freshness-dot');
            var freshnessText = freshnessEl.querySelector('.freshness-text');
            var freshnessClass, freshnessLabel;
            if (daysSinceData <= 42) { freshnessClass = 'fresh'; freshnessLabel = 'Current'; }
            else if (daysSinceData <= 70) { freshnessClass = 'stale'; freshnessLabel = Math.floor(daysSinceData / 7) + ' weeks old'; }
            else { freshnessClass = 'old'; freshnessLabel = Math.floor(daysSinceData / 7) + ' weeks old'; }
            freshnessDot.className = 'freshness-dot ' + freshnessClass;
            freshnessText.className = 'freshness-text ' + freshnessClass;
            freshnessText.textContent = freshnessLabel;

            var firstLabel = monthlyData.labels[0];
            var lastLabel = monthlyData.labels[monthlyData.labels.length - 1];
            document.getElementById('chartTitle').textContent = 'How has the market shifted? (' + firstLabel + ' \u2013 ' + lastLabel + ')';

            // Composite score calculation
            function calculateCompositeScore(idx) {
                var quit = monthlyData.quitRate[idx], ratio = monthlyData.openingsRatio[idx];
                var hires = monthlyData.hiresRate[idx], layoffs = monthlyData.layoffsRate[idx];
                var unemp = monthlyData.unempRate[idx], fed = monthlyData.fedRate[idx];
                var wage = monthlyData.wageGrowth[idx], lfpr = monthlyData.lfpr[idx];
                if (quit == null || ratio == null) return null;
                var qs = Math.min(1, Math.max(0, (quit - 1.5) / 1.5));
                var rs = Math.min(1, Math.max(0, (ratio - 0.3) / 1.7));
                var hs = Math.min(1, Math.max(0, (hires - 2.0) / 2.5));
                var ls = Math.min(1, Math.max(0, (2.5 - layoffs) / 1.7));
                var us = unemp != null ? Math.min(1, Math.max(0, (7.0 - unemp) / 3.5)) : 0.5;
                var fs = Math.min(1, Math.max(0, (5.5 - fed) / 5.5));
                var ws = wage != null ? Math.min(1, Math.max(0, (wage - 2.0) / 3.0)) : 0.5;
                var ps = lfpr != null ? Math.min(1, Math.max(0, (lfpr - 79) / 4.0)) : 0.5;
                var t1 = (qs + rs + hs + ls) / 4 * 0.6;
                var t2 = (us + fs + ws + ps) / 4 * 0.4;
                var base = (t1 + t2) * 100;
                if (ratio < 1.0) base *= 0.92;
                base *= (1 - 0.12 * (1 - Math.min(qs, hs)));
                if (fed < 0.5) base *= 1.08;
                return Math.min(100, Math.round(base));
            }

            var compositeScores = monthlyData.labels.map(function(_, idx) { return calculateCompositeScore(idx); });
            
            var peakScore = 0, peakIdx = 0;
            compositeScores.forEach(function(score, idx) { if (score !== null && score > peakScore) { peakScore = score; peakIdx = idx; } });
            
            var currentScore = compositeScores[compositeScores.length - 1];
            var currentIdx = compositeScores.length - 1;
            while (currentScore === null && currentIdx > 0) { currentIdx--; currentScore = compositeScores[currentIdx]; }
            
            var tierClass, tierKey;
            if (currentScore >= 70) { tierClass = 'good-time'; tierKey = 'good-time'; }
            else if (currentScore >= 55) { tierClass = 'worth-exploring'; tierKey = 'worth-exploring'; }
            else if (currentScore >= 40) { tierClass = 'build-your-position'; tierKey = 'build-your-position'; }
            else { tierClass = 'tough-market'; tierKey = 'tough-market'; }
            
            document.getElementById('currentScore').textContent = currentScore;
            document.getElementById('currentScore').className = 'score-value ' + tierClass;
            document.getElementById('scoreVerdict').className = 'score-verdict ' + tierClass;
            document.getElementById('verdictIcon').className = 'verdict-icon ' + tierClass;
            document.getElementById('verdictText').textContent = tierNames[tierKey];
            document.getElementById('actionSection').className = 'action-section ' + tierClass;
            
            var accentColors = { 'good-time': 'var(--accent-green)', 'worth-exploring': 'var(--accent-yellow)', 'build-your-position': 'var(--accent-orange)', 'tough-market': 'var(--accent-red)' };
            document.getElementById('actionSection').style.borderLeft = '3px solid ' + accentColors[tierKey];
            
            // Score guide highlight
            var guideMapping = { 'good-time': 'guideGreen', 'worth-exploring': 'guideYellow', 'build-your-position': 'guideOrange', 'tough-market': 'guideRed' };
            ['guideGreen', 'guideYellow', 'guideOrange', 'guideRed'].forEach(function(id) {
                var el = document.getElementById(id);
                if (el) { el.classList.remove('current'); var r = el.querySelector('.score-guide-range'); if (r) r.textContent = r.textContent.replace(' \u2190', ''); }
            });
            var cg = document.getElementById(guideMapping[tierKey]);
            if (cg) { cg.classList.add('current'); var r = cg.querySelector('.score-guide-range'); if (r && !r.textContent.includes('\u2190')) r.textContent += ' \u2190'; }
            
            var diff = peakScore - currentScore;
            document.getElementById('scoreChange').textContent = '\u2193 ' + diff + ' pts from peak (' + monthlyData.labels[peakIdx] + ')';
            
            // Update action content
            const advice = actionAdvice[tierKey];
            let actionHTML = `<p>${advice.intro}</p>`;
            if (advice.vibe) {
                actionHTML += `<p class="vibe-validation"><em>${advice.vibe}</em></p>`;
            }
            actionHTML += '<ul class="action-list">';
            advice.actions.forEach(action => {
                actionHTML += `<li>${action}</li>`;
            });
            actionHTML += '</ul>';
            document.getElementById('actionContent').innerHTML = actionHTML;

            // ========================================
            // PHASE 8: INLINE SCORE CONTEXT
            // (replaces standalone "How Does This Compare?" section)
            // ========================================
            var covidIdx = monthlyData.labels.indexOf('Apr-20');
            var covidScore = compositeScores[covidIdx];
            var prePandemicIdx = monthlyData.labels.indexOf('Dec-19');
            var prePandemicScore = compositeScores[prePandemicIdx];
            
            // Historical analog
            var bestMatch = { idx: -1, diff: Infinity };
            var excludeStart = monthlyData.labels.indexOf('Mar-20');
            var excludeEnd = monthlyData.labels.indexOf('Dec-20');
            var recentCutoff = compositeScores.length - 12;
            compositeScores.forEach(function(score, idx) {
                if (score === null) return;
                if (idx >= excludeStart && idx <= excludeEnd) return;
                if (idx >= recentCutoff) return;
                if (Math.abs(score - currentScore) < bestMatch.diff) bestMatch = { idx: idx, diff: Math.abs(score - currentScore), score: score };
            });
            
            var analogText = bestMatch.idx >= 0 && bestMatch.diff <= 5
                ? monthlyData.labels[bestMatch.idx] + ' (' + bestMatch.score + ')'
                : 'No close match';
            
            document.getElementById('scoreContext').innerHTML =
                '<span class="context-chip"><span class="context-chip-label">Peak</span> <span class="context-chip-value">' + peakScore + ' (' + monthlyData.labels[peakIdx] + ')</span></span>' +
                '<span class="context-sep">\u00b7</span>' +
                '<span class="context-chip"><span class="context-chip-label">Pre-pandemic</span> <span class="context-chip-value">' + prePandemicScore + '</span></span>' +
                '<span class="context-sep">\u00b7</span>' +
                '<span class="context-chip"><span class="context-chip-label">COVID low</span> <span class="context-chip-value">' + covidScore + '</span></span>' +
                '<span class="context-sep">\u00b7</span>' +
                '<span class="context-chip"><span class="context-chip-label">Similar to</span> <span class="context-chip-value">' + analogText + '</span></span>';

            // ========================================
            // METRIC VALUES
            // ========================================
            var currentMetrics = {
                quitRate: monthlyData.quitRate[currentIdx],
                openingsRatio: monthlyData.openingsRatio[currentIdx],
                hiresRate: monthlyData.hiresRate[currentIdx],
                layoffsRate: monthlyData.layoffsRate[currentIdx],
                unempRate: monthlyData.unempRate[currentIdx],
                fedRate: monthlyData.fedRate[currentIdx],
                wageGrowth: monthlyData.wageGrowth[currentIdx],
                lfpr: monthlyData.lfpr[currentIdx]
            };
            
            var prevIdx = currentIdx > 0 ? currentIdx - 1 : currentIdx;
            var prevMetrics = {
                quitRate: monthlyData.quitRate[prevIdx],
                openingsRatio: monthlyData.openingsRatio[prevIdx],
                hiresRate: monthlyData.hiresRate[prevIdx],
                layoffsRate: monthlyData.layoffsRate[prevIdx],
                unempRate: monthlyData.unempRate[prevIdx],
                fedRate: monthlyData.fedRate[prevIdx],
                wageGrowth: monthlyData.wageGrowth[prevIdx],
                lfpr: monthlyData.lfpr[prevIdx]
            };
            
            function getMetricClass(value, metric) {
                var thresholds = {
                    quitRate: { good: 2.5, neutral: 2.0 },
                    openingsRatio: { good: 1.2, neutral: 1.0 },
                    hiresRate: { good: 3.8, neutral: 3.4 },
                    layoffsRate: { good: 1.0, neutral: 1.3, inverted: true },
                    unempRate: { good: 4.0, neutral: 4.5, inverted: true },
                    fedRate: { good: 2.5, neutral: 4.0, inverted: true },
                    wageGrowth: { good: 4.0, neutral: 3.0 },
                    lfpr: { good: 83.0, neutral: 82.0 }
                };
                var t = thresholds[metric];
                if (!t) return 'neutral';
                if (t.inverted) { return value <= t.good ? 'good' : value <= t.neutral ? 'neutral' : 'bad'; }
                return value >= t.good ? 'good' : value >= t.neutral ? 'neutral' : 'bad';
            }
            
            function getDeltaHTML(current, previous, decimals, isInverted) {
                if (previous == null || current == null) return '';
                var d = current - previous;
                if (Math.abs(d) < 0.01) return '<span class="metric-delta flat">\u2014</span>';
                var sign = d > 0 ? '+' : '';
                var dir = d > 0 ? 'up' : 'down';
                var inv = isInverted ? ' inverted' : '';
                return '<span class="metric-delta ' + dir + inv + '">' + sign + d.toFixed(decimals) + '</span>';
            }
            
            document.getElementById('quitValue').innerHTML = currentMetrics.quitRate.toFixed(1) + '%' + getDeltaHTML(currentMetrics.quitRate, prevMetrics.quitRate, 1);
            document.getElementById('quitValue').className = 'metric-value ' + getMetricClass(currentMetrics.quitRate, 'quitRate');
            document.getElementById('ratioValue').innerHTML = currentMetrics.openingsRatio.toFixed(2) + getDeltaHTML(currentMetrics.openingsRatio, prevMetrics.openingsRatio, 2);
            document.getElementById('ratioValue').className = 'metric-value ' + getMetricClass(currentMetrics.openingsRatio, 'openingsRatio');
            document.getElementById('hiresValue').innerHTML = currentMetrics.hiresRate.toFixed(1) + '%' + getDeltaHTML(currentMetrics.hiresRate, prevMetrics.hiresRate, 1);
            document.getElementById('hiresValue').className = 'metric-value ' + getMetricClass(currentMetrics.hiresRate, 'hiresRate');
            document.getElementById('layoffsValue').innerHTML = currentMetrics.layoffsRate.toFixed(1) + '%' + getDeltaHTML(currentMetrics.layoffsRate, prevMetrics.layoffsRate, 1, true);
            document.getElementById('layoffsValue').className = 'metric-value ' + getMetricClass(currentMetrics.layoffsRate, 'layoffsRate');
            document.getElementById('unempValue').innerHTML = (currentMetrics.unempRate || 0).toFixed(1) + '%' + getDeltaHTML(currentMetrics.unempRate, prevMetrics.unempRate, 1, true);
            document.getElementById('unempValue').className = 'metric-value ' + getMetricClass(currentMetrics.unempRate || 5, 'unempRate');
            document.getElementById('fedValue').innerHTML = currentMetrics.fedRate.toFixed(2) + '%' + getDeltaHTML(currentMetrics.fedRate, prevMetrics.fedRate, 2, true);
            document.getElementById('fedValue').className = 'metric-value ' + getMetricClass(currentMetrics.fedRate, 'fedRate');
            document.getElementById('wageValue').innerHTML = (currentMetrics.wageGrowth || 0).toFixed(1) + '%' + getDeltaHTML(currentMetrics.wageGrowth, prevMetrics.wageGrowth, 1);
            document.getElementById('wageValue').className = 'metric-value ' + getMetricClass(currentMetrics.wageGrowth || 3, 'wageGrowth');
            document.getElementById('lfprValue').innerHTML = (currentMetrics.lfpr || 0).toFixed(1) + '%' + getDeltaHTML(currentMetrics.lfpr, prevMetrics.lfpr, 1);
            document.getElementById('lfprValue').className = 'metric-value ' + getMetricClass(currentMetrics.lfpr || 82, 'lfpr');

            // ========================================
            // PHASE 8: POPULATE METRICS SUMMARIES (mobile)
            // ========================================
            function buildSummaryHTML(items) {
                return items.map(function(m) {
                    return '<span class="summary-item"><span class="summary-dot ' + m.signal + '"></span><span class="summary-label">' + m.name + '</span> <span class="summary-val">' + m.value + '</span></span>';
                }).join('');
            }

            document.getElementById('coreSummaryItems').innerHTML = buildSummaryHTML([
                { name: 'Quit', value: currentMetrics.quitRate.toFixed(1) + '%', signal: getMetricClass(currentMetrics.quitRate, 'quitRate') },
                { name: 'Ratio', value: currentMetrics.openingsRatio.toFixed(2), signal: getMetricClass(currentMetrics.openingsRatio, 'openingsRatio') },
                { name: 'Hires', value: currentMetrics.hiresRate.toFixed(1) + '%', signal: getMetricClass(currentMetrics.hiresRate, 'hiresRate') },
                { name: 'Layoffs', value: currentMetrics.layoffsRate.toFixed(1) + '%', signal: getMetricClass(currentMetrics.layoffsRate, 'layoffsRate') }
            ]);

            document.getElementById('contextSummaryItems').innerHTML = buildSummaryHTML([
                { name: 'Unemp', value: (currentMetrics.unempRate || 0).toFixed(1) + '%', signal: getMetricClass(currentMetrics.unempRate || 5, 'unempRate') },
                { name: 'Fed', value: currentMetrics.fedRate.toFixed(1) + '%', signal: getMetricClass(currentMetrics.fedRate, 'fedRate') },
                { name: 'Wages', value: (currentMetrics.wageGrowth || 0).toFixed(1) + '%', signal: getMetricClass(currentMetrics.wageGrowth || 3, 'wageGrowth') },
                { name: 'LFPR', value: (currentMetrics.lfpr || 0).toFixed(1) + '%', signal: getMetricClass(currentMetrics.lfpr || 82, 'lfpr') }
            ]);

            // ========================================
            // SCENARIOS
            // ========================================
            var CUR = { quitRate: currentMetrics.quitRate, openingsRatio: currentMetrics.openingsRatio, hiresRate: currentMetrics.hiresRate, layoffsRate: currentMetrics.layoffsRate, unempRate: currentMetrics.unempRate, fedRate: currentMetrics.fedRate, wageGrowth: currentMetrics.wageGrowth, lfpr: currentMetrics.lfpr };

            var SCENARIOS = {
                now: Object.assign({}, CUR),
                frozen: Object.assign({}, CUR, { quitRate: 1.9, openingsRatio: 0.88, hiresRate: 3.0, fedRate: 3.5, unempRate: 4.8 }),
                thaw: Object.assign({}, CUR, { quitRate: 2.4, openingsRatio: 1.2, hiresRate: 3.6, fedRate: 2.5, unempRate: 4.2 }),
                boom: Object.assign({}, CUR, { quitRate: 2.5, openingsRatio: 1.4, hiresRate: 3.8, fedRate: 2.25, unempRate: 3.9, wageGrowth: 4.0, layoffsRate: 1.0 }),
                worse: Object.assign({}, CUR, { quitRate: 1.7, openingsRatio: 0.7, hiresRate: 2.8, layoffsRate: 1.5, fedRate: 3.75, unempRate: 5.4 })
            };

            function calcScenarioScore(m) {
                var qs = Math.min(1, Math.max(0, (m.quitRate - 1.5) / 1.5));
                var rs = Math.min(1, Math.max(0, (m.openingsRatio - 0.3) / 1.7));
                var hs = Math.min(1, Math.max(0, (m.hiresRate - 2.0) / 2.5));
                var ls = Math.min(1, Math.max(0, (2.5 - m.layoffsRate) / 1.7));
                var us = Math.min(1, Math.max(0, (7.0 - m.unempRate) / 3.5));
                var fs = Math.min(1, Math.max(0, (5.5 - m.fedRate) / 5.5));
                var ws = Math.min(1, Math.max(0, (m.wageGrowth - 2.0) / 3.0));
                var ps = Math.min(1, Math.max(0, (m.lfpr - 79) / 4.0));
                var t1 = (qs + rs + hs + ls) / 4 * 0.6;
                var t2 = (us + fs + ws + ps) / 4 * 0.4;
                var base = (t1 + t2) * 100;
                if (m.openingsRatio < 1.0) base *= 0.92;
                base *= (1 - 0.12 * (1 - Math.min(qs, hs)));
                if (m.fedRate < 0.5) base *= 1.08;
                return Math.min(100, Math.round(base));
            }

            var CUR_SCORE = calcScenarioScore(CUR);
            var SCENARIO_SCORES = {};
            for (var k in SCENARIOS) SCENARIO_SCORES[k] = calcScenarioScore(SCENARIOS[k]);

            function getScenarioRawColor(s) { return s >= 70 ? '#00d9a0' : s >= 55 ? '#ffc940' : s >= 40 ? '#ff8c40' : '#ff4d6a'; }
            function getScenarioDimColor(s, a) {
                var h = getScenarioRawColor(s);
                var r = parseInt(h.slice(1,3),16), g = parseInt(h.slice(3,5),16), b = parseInt(h.slice(5,7),16);
                return 'rgba(' + r + ',' + g + ',' + b + ',' + (a||0.3) + ')';
            }
            function getScenarioCategory(s) { return s >= 70 ? 'Good Time to Move' : s >= 55 ? 'Worth Exploring' : s >= 40 ? 'Build Your Position' : 'Get Creative'; }

            // Historical data for scenario chart
            var SC_HIST_COUNT = 24;
            var scStartIdx = monthlyData.labels.length - SC_HIST_COUNT;
            var SC_HIST_LABELS = monthlyData.labels.slice(scStartIdx).map(function(l) { return l.replace('-', ' '); });
            var scHistScores = [];
            for (var i = scStartIdx; i < monthlyData.labels.length; i++) scHistScores.push(calculateCompositeScore(i));

            // Narratives
            function ss(score) { return '<span class="score-inline" style="color:' + getScenarioRawColor(score) + '">' + score + '</span>'; }
            function cs(score) { return '<span class="category-inline" style="color:' + getScenarioRawColor(score) + '">' + getScenarioCategory(score) + '</span>'; }

            var SC_NARRATIVES = {
                _invitation: { border: 'var(--accent-blue)', html: '<strong>Four scenarios show the range of plausible futures</strong> \u2014 from continued stasis to genuine recovery. The most likely path is more of the same. Pick one to explore what it means, or build your own.' },
                now: { get border() { return getScenarioRawColor(SCENARIO_SCORES.now); }, get html() { return '<strong>Current conditions \u2192 ' + ss(SCENARIO_SCORES.now) + ', ' + cs(SCENARIO_SCORES.now) + '.</strong> Workers staying put, hiring slow, job openings below 1.0 per unemployed for the first time since 2021. Fed cuts underway but haven\u2019t reached the real economy. Stability is the primary asset worth protecting.'; } },
                frozen: { get border() { return getScenarioRawColor(SCENARIO_SCORES.frozen); }, get html() { return '<strong>Stays Frozen \u2192 ' + ss(SCENARIO_SCORES.frozen) + ', ' + cs(SCENARIO_SCORES.frozen) + '.</strong> Quit rate stuck near 1.9%, hiring flat, Fed pausing around 3.5%. Not a macro crash \u2014 but another year where the aggregate data stays flat while specific sectors keep bleeding. If you\'re in one of them, you already know.'; } },
                thaw: { get border() { return getScenarioRawColor(SCENARIO_SCORES.thaw); }, get html() { return '<strong>Gradual Thaw \u2192 ' + ss(SCENARIO_SCORES.thaw) + ', ' + cs(SCENARIO_SCORES.thaw) + '.</strong> Fed cuts gain traction \u2014 quits climb to 2.4%, openings back above 1.0 per unemployed. Not a boom, but a functional market where active searching is rewarded. Plausible by late 2027 if policy headwinds ease.'; } },
                boom: { get border() { return getScenarioRawColor(SCENARIO_SCORES.boom); }, get html() { return '<strong>Bets Pay Off \u2192 ' + ss(SCENARIO_SCORES.boom) + ', ' + cs(SCENARIO_SCORES.boom) + '.</strong> Aggressive Fed cuts spark hiring \u2014 quits climbing past 2.5%, openings ratio back to 1.4. Even in this optimistic case, you only just cross into Good Time to Move. That\u2019s how far below baseline the market currently sits. Expand the sliders to see what has to be true.'; } },
                worse: { get border() { return getScenarioRawColor(SCENARIO_SCORES.worse); }, get html() { return '<strong>Gets Worse \u2192 ' + ss(SCENARIO_SCORES.worse) + ', ' + cs(SCENARIO_SCORES.worse) + '.</strong> Headwinds intensify \u2014 layoffs rise, hiring freezes deepen, the Fed pauses cuts. Even strong candidates face slow processes and lowball offers. Protecting your current position becomes the priority.'; } }
            };

            function getCustomNarrative(score) {
                var d = score - CUR_SCORE, text;
                if (score >= 70) text = '<strong>Your scenario \u2192 ' + ss(score) + ', ' + cs(score) + '.</strong> At these levels the market is genuinely employee-favorable \u2014 workers quit confidently, employers compete for talent. Strong conditions for an active search.';
                else if (score >= 55) text = '<strong>Your scenario \u2192 ' + ss(score) + ', ' + cs(score) + '.</strong> A functional market with real opportunities. Selective searching for strong-fit roles makes sense. Not a boom, but applications yield meaningful responses.';
                else if (d >= -3 && d <= 3) text = '<strong>Your scenario \u2192 ' + ss(score) + '.</strong> Roughly current conditions \u2014 still ' + cs(score) + '. The holding pattern continues. Stability remains the primary asset worth protecting.';
                else if (score >= 40) text = '<strong>Your scenario \u2192 ' + ss(score) + ', ' + cs(score) + '.</strong> Headwinds still present. Patience and positioning beat aggressive searching. Wait for sustained indicator movement before committing to a search.';
                else text = '<strong>Your scenario \u2192 ' + ss(score) + ', ' + cs(score) + '.</strong> Employer-favorable market \u2014 searching is costly and slow. Focus on stability. Only move for truly exceptional opportunities.';
                return { border: getScenarioRawColor(score), html: text };
            }

            // Sliders
            var SLIDER_DEFS = [
                { key: 'quit', name: 'Quit Rate', metric: 'quitRate', min: 1.4, max: 3.2, step: 0.1, cur: CUR.quitRate, fmt: function(v) { return v.toFixed(1)+'%'; }, inv: false },
                { key: 'ratio', name: 'Openings / Unemployed', metric: 'openingsRatio', min: 0.3, max: 2.0, step: 0.05, cur: CUR.openingsRatio, fmt: function(v) { return v.toFixed(2); }, inv: false },
                { key: 'hires', name: 'Hires Rate', metric: 'hiresRate', min: 2.0, max: 4.8, step: 0.1, cur: CUR.hiresRate, fmt: function(v) { return v.toFixed(1)+'%'; }, inv: false },
                { key: 'fed', name: 'Fed Funds Rate', metric: 'fedRate', min: 0, max: 5.5, step: 0.25, cur: CUR.fedRate, fmt: function(v) { return v.toFixed(2)+'%'; }, inv: true },
                { key: 'unemp', name: 'Unemployment', metric: 'unempRate', min: 3.4, max: 7.0, step: 0.1, cur: CUR.unempRate, fmt: function(v) { return v.toFixed(1)+'%'; }, inv: true }
            ];

            function renderSliders() {
                document.getElementById('slider-grid').innerHTML = SLIDER_DEFS.map(function(d) {
                    return '<div class="slider-group"><div class="slider-header"><span class="slider-name">' + d.name + '</span><div class="slider-vals"><span class="slider-cur">' + d.fmt(d.cur) + '</span><span class="slider-arrow">\u2192</span><span class="slider-proj same" id="sl-' + d.key + '-val">' + d.fmt(d.cur) + '</span></div></div><input type="range" min="' + d.min + '" max="' + d.max + '" step="' + d.step + '" value="' + d.cur + '" id="sl-' + d.key + '" aria-label="' + d.name + '"></div>';
                }).join('');
                SLIDER_DEFS.forEach(function(d) { document.getElementById('sl-' + d.key).addEventListener('input', onSliderInput); });
            }

            function readSliders() { var m = Object.assign({}, CUR); SLIDER_DEFS.forEach(function(d) { m[d.metric] = parseFloat(document.getElementById('sl-' + d.key).value); }); return m; }
            function setSliders(m) { SLIDER_DEFS.forEach(function(d) { document.getElementById('sl-' + d.key).value = m[d.metric]; }); updateSliderLabels(m); }
            function updateSliderLabels(m) {
                SLIDER_DEFS.forEach(function(d) {
                    var val = m[d.metric], el = document.getElementById('sl-' + d.key + '-val');
                    el.textContent = d.fmt(val);
                    var diff = d.inv ? (d.cur - val) : (val - d.cur);
                    el.className = 'slider-proj ' + (diff > 0.03 ? 'better' : diff < -0.03 ? 'worse' : 'same');
                });
            }

            // Scenario Chart
            var SC_PROJ_MONTHS = 12;
            var SC_PROJ_LABELS = Array.from({length: SC_PROJ_MONTHS}, function() { return ''; });
            var SC_ALL_LABELS = SC_HIST_LABELS.concat(SC_PROJ_LABELS);
            var SC_LAST_HIST = SC_HIST_LABELS.length - 1;
            var SC_TOTAL = SC_ALL_LABELS.length;
            var SCENARIO_DS = { frozen: 1, thaw: 2, worse: 3, boom: 4, custom: 5 };
            var PRESET_LINES = ['frozen', 'thaw', 'worse', 'boom'];
            var SC_OVERLAP = 1;

            function buildPath(target) {
                var arr = new Array(SC_TOTAL).fill(null);
                // Start scenario lines from the last historical point
                arr[SC_LAST_HIST] = scHistScores[SC_LAST_HIST];
                for (var i = 1; i <= SC_PROJ_MONTHS; i++) { var t = i / SC_PROJ_MONTHS; arr[SC_LAST_HIST + i] = scHistScores[SC_LAST_HIST] + (target - scHistScores[SC_LAST_HIST]) * (1 - Math.pow(1 - t, 2)); }
                return arr;
            }

            function endpointRadius(size) { return function(ctx) { return ctx.dataIndex === SC_TOTAL - 1 ? size : 0; }; }

            function makeScenarioDataset(label, target, color, order) {
                var isDark = document.documentElement.getAttribute('data-theme') !== 'light';
                return { label: label, data: buildPath(target), borderColor: color, borderDash: [8, 4], tension: 0.3, pointRadius: endpointRadius(5), pointBackgroundColor: color, pointBorderColor: isDark ? '#12121a' : '#ffffff', pointBorderWidth: 2, borderWidth: 2, order: order, spanGaps: false };
            }

            function initScenarioChart() {
                var ctx = document.getElementById('scenarioChart').getContext('2d');
                var histData = scHistScores.concat(new Array(SC_PROJ_MONTHS).fill(null));
                var tc = getThemeColors();
                var isDark = document.documentElement.getAttribute('data-theme') !== 'light';

                scenarioChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: SC_ALL_LABELS,
                        datasets: [
                            { label: 'Historical', data: histData, borderColor: '#9898a8', segment: { borderColor: function(ctx) { return getScenarioRawColor(ctx.p0.parsed.y); } }, backgroundColor: 'transparent', tension: 0.3, pointRadius: 0, pointHoverRadius: 5, pointHoverBackgroundColor: isDark ? '#fff' : '#1a1a2e', borderWidth: 2, spanGaps: true, order: 10 },
                            makeScenarioDataset('\ud83e\udd76 Stays Frozen', SCENARIO_SCORES.frozen, getScenarioRawColor(SCENARIO_SCORES.frozen), 6),
                            makeScenarioDataset('\ud83c\udf24\ufe0f Gradual Thaw', SCENARIO_SCORES.thaw, getScenarioRawColor(SCENARIO_SCORES.thaw), 5),
                            makeScenarioDataset('\u26c8\ufe0f Gets Worse', SCENARIO_SCORES.worse, getScenarioRawColor(SCENARIO_SCORES.worse), 7),
                            makeScenarioDataset('\ud83d\ude80 Bets Pay Off', SCENARIO_SCORES.boom, getScenarioRawColor(SCENARIO_SCORES.boom), 4),
                            { label: '\u2726 Your Scenario', data: new Array(SC_TOTAL).fill(null), borderColor: '#4d9fff', borderDash: [5, 3], tension: 0.3, pointRadius: endpointRadius(7), pointBackgroundColor: '#4d9fff', pointBorderColor: isDark ? '#12121a' : '#ffffff', pointBorderWidth: 2, borderWidth: 2.5, hidden: true, order: 1, spanGaps: false }
                        ]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        animation: { duration: 400, easing: 'easeOutQuart' },
                        interaction: { intersect: false, mode: 'index' },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: tc.tooltipBg, titleColor: tc.tooltipText, bodyColor: tc.tooltipSecondary, borderColor: tc.tooltipBorder, borderWidth: 1, padding: 10,
                                filter: function(item) { if (item.raw === null) return false; if (item.dataIndex > SC_LAST_HIST && item.datasetIndex >= 1 && item.datasetIndex <= 5) { var ds = item.chart.data.datasets[item.datasetIndex]; if (ds.hidden || ds.borderWidth < 2) return false; } return true; },
                                callbacks: { title: function(items) { return !items.length ? '' : items[0].dataIndex > SC_LAST_HIST ? 'Projected' : (items[0].label || ''); }, label: function(item) { var s = Math.round(item.raw); if (item.datasetIndex === 0) return 'Score: ' + s + ' (' + getScenarioCategory(s) + ')'; return item.dataset.label.replace(/^[^\w]+/, '').trim() + ': ' + s + ' (' + getScenarioCategory(s) + ')'; } }
                            },
                            annotation: {
                                annotations: {
                                    branchLine: { type: 'line', xMin: SC_LAST_HIST, xMax: SC_LAST_HIST, borderColor: isDark ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.08)', borderWidth: 1, borderDash: [4,4] },
                                    projZone: { type: 'box', xMin: SC_LAST_HIST, xMax: SC_TOTAL - 1, backgroundColor: isDark ? 'rgba(255,255,255,0.03)' : 'rgba(0,0,0,0.03)', borderWidth: 0 },
                                    projLabel: { type: 'label', xValue: SC_LAST_HIST + 3, yValue: 94, content: ['12-MONTH HORIZON'], font: { size: 8, weight: 600, family: "'JetBrains Mono'" }, color: isDark ? 'rgba(255,255,255,0.28)' : 'rgba(0,0,0,0.25)' },
                                    endFrozen: { type: 'label', xValue: SC_TOTAL - 0.2, yValue: SCENARIO_SCORES.frozen, content: ['\ud83e\udd76 ' + SCENARIO_SCORES.frozen], font: { size: 9 }, color: getScenarioRawColor(SCENARIO_SCORES.frozen), position: { x: 'start' } },
                                    endThaw: { type: 'label', xValue: SC_TOTAL - 0.2, yValue: SCENARIO_SCORES.thaw, content: ['\ud83c\udf24\ufe0f ' + SCENARIO_SCORES.thaw], font: { size: 9 }, color: getScenarioRawColor(SCENARIO_SCORES.thaw), position: { x: 'start' } },
                                    endWorse: { type: 'label', xValue: SC_TOTAL - 0.2, yValue: SCENARIO_SCORES.worse, content: ['\u26c8\ufe0f ' + SCENARIO_SCORES.worse], font: { size: 9 }, color: getScenarioRawColor(SCENARIO_SCORES.worse), position: { x: 'start' } },
                                    endBoom: { type: 'label', xValue: SC_TOTAL - 0.2, yValue: SCENARIO_SCORES.boom, content: ['\ud83d\ude80 ' + SCENARIO_SCORES.boom], font: { size: 9 }, color: getScenarioRawColor(SCENARIO_SCORES.boom), position: { x: 'start' } },
                                    scLine70: { type: 'line', yMin: 70, yMax: 70, borderColor: 'rgba(0,217,160,0.25)', borderWidth: 1, borderDash: [4,4], label: { display: true, content: 'Good Time to Move', position: 'start', font: { size: 8 }, color: 'rgba(0,217,160,0.5)', backgroundColor: 'transparent', padding: 2 } },
                                    scLine55: { type: 'line', yMin: 55, yMax: 55, borderColor: 'rgba(255,201,64,0.25)', borderWidth: 1, borderDash: [4,4], label: { display: true, content: 'Worth Exploring', position: 'start', font: { size: 8 }, color: 'rgba(255,201,64,0.5)', backgroundColor: 'transparent', padding: 2 } },
                                    scLine40: { type: 'line', yMin: 40, yMax: 40, borderColor: 'rgba(255,140,64,0.22)', borderWidth: 1, borderDash: [4,4], label: { display: true, content: 'Get Creative', position: 'start', font: { size: 8 }, color: 'rgba(255,140,64,0.45)', backgroundColor: 'transparent', padding: 2 } }
                                }
                            }
                        },
                        scales: {
                            x: { grid: { color: tc.grid, drawBorder: false }, ticks: { maxTicksLimit: 10, maxRotation: 0, callback: function(value, index) { return index > SC_LAST_HIST ? '' : this.getLabelForValue(value); }, color: tc.textMuted } },
                            y: { min: 20, max: 100, grid: { color: tc.grid, drawBorder: false }, ticks: { stepSize: 20, color: tc.textMuted } }
                        }
                    }
                });
            }

            // Scenario state management
            var activePreset = null;

            function selectPreset(key) {
                activePreset = key;
                document.querySelectorAll('.preset-pill').forEach(function(p) { var a = p.dataset.key === key; p.classList.toggle('active', a); p.setAttribute('aria-pressed', a); });
                setSliders(SCENARIOS[key] || CUR);
                updateChartEmphasis(key);
                setNarrative(SC_NARRATIVES[key] || SC_NARRATIVES.now);
                var panel = document.getElementById('slider-panel'), toggle = document.getElementById('slider-toggle');
                if (panel.classList.contains('collapsed')) { panel.classList.remove('collapsed'); toggle.classList.add('open'); toggle.setAttribute('aria-expanded', 'true'); }
            }

            function updateChartEmphasis(key) {
                scenarioChart.data.datasets[5].hidden = true;
                delete scenarioChart.options.plugins.annotation.annotations.endCustom;
                if (key === 'now') {
                    PRESET_LINES.forEach(function(sk) { var ds = scenarioChart.data.datasets[SCENARIO_DS[sk]]; ds.borderWidth = 2; ds.borderDash = [8, 4]; ds.borderColor = getScenarioRawColor(SCENARIO_SCORES[sk]); });
                } else if (PRESET_LINES.indexOf(key) >= 0) {
                    PRESET_LINES.forEach(function(sk) { var ds = scenarioChart.data.datasets[SCENARIO_DS[sk]]; if (sk === key) { ds.borderWidth = 3; ds.borderDash = [10, 3]; ds.borderColor = getScenarioRawColor(SCENARIO_SCORES[sk]); } else { ds.borderWidth = 1.5; ds.borderDash = [8, 4]; ds.borderColor = getScenarioDimColor(SCENARIO_SCORES[sk]); } });
                }
                scenarioChart.update();
            }

            function onSliderInput() {
                activePreset = 'custom';
                document.querySelectorAll('.preset-pill').forEach(function(p) { p.classList.remove('active'); p.setAttribute('aria-pressed', 'false'); });
                var m = readSliders(); updateSliderLabels(m); var score = calcScenarioScore(m);
                scenarioChart.data.datasets[5].data = buildPath(score); scenarioChart.data.datasets[5].hidden = false;
                scenarioChart.data.datasets[5].borderColor = getScenarioRawColor(score); scenarioChart.data.datasets[5].pointBackgroundColor = getScenarioRawColor(score); scenarioChart.data.datasets[5].borderWidth = 3;
                PRESET_LINES.forEach(function(sk) { var ds = scenarioChart.data.datasets[SCENARIO_DS[sk]]; ds.borderWidth = 1.5; ds.borderColor = getScenarioDimColor(SCENARIO_SCORES[sk]); });
                scenarioChart.options.plugins.annotation.annotations.endCustom = { type: 'label', xValue: SC_TOTAL - 0.2, yValue: score, content: ['\u2726 ' + score], font: { size: 10, weight: 700, family: "'JetBrains Mono'" }, color: getScenarioRawColor(score), position: { x: 'start' } };
                scenarioChart.update();
                setNarrative(getCustomNarrative(score));
            }

            // Narrative management
            function setNarrative(n) {
                var wrap = document.getElementById('recoveryInterpretation'), text = document.getElementById('interp-text'), btn = document.getElementById('interp-more');
                text.classList.remove('expanded'); btn.classList.remove('visible'); btn.textContent = 'more \u25be';
                wrap.classList.add('fading');
                setTimeout(function() { text.innerHTML = n.html; wrap.style.borderLeftColor = n.border; requestAnimationFrame(function() { wrap.classList.remove('fading'); checkMobileTruncation(); }); }, 200);
            }

            function checkMobileTruncation() {
                var text = document.getElementById('interp-text'), btn = document.getElementById('interp-more');
                if (window.innerWidth <= 640) requestAnimationFrame(function() { btn.classList.toggle('visible', text.scrollHeight > text.clientHeight + 2); });
            }

            function resetScenarios() {
                activePreset = null;
                document.querySelectorAll('.preset-pill').forEach(function(p) { p.classList.remove('active'); p.setAttribute('aria-pressed', 'false'); });
                setSliders(CUR);
                PRESET_LINES.forEach(function(sk) { var ds = scenarioChart.data.datasets[SCENARIO_DS[sk]]; ds.borderWidth = 2; ds.borderDash = [8, 4]; ds.borderColor = getScenarioRawColor(SCENARIO_SCORES[sk]); });
                scenarioChart.data.datasets[5].hidden = true; scenarioChart.data.datasets[5].data = new Array(SC_TOTAL).fill(null);
                delete scenarioChart.options.plugins.annotation.annotations.endCustom;
                scenarioChart.update();
                setNarrative(SC_NARRATIVES._invitation);
                var panel = document.getElementById('slider-panel'), toggle = document.getElementById('slider-toggle');
                panel.classList.add('collapsed'); toggle.classList.remove('open'); toggle.setAttribute('aria-expanded', 'false');
            }

            // Populate pill scores
            for (var key in SCENARIO_SCORES) { var el = document.querySelector('[data-pill="' + key + '"]'); if (el) { el.textContent = SCENARIO_SCORES[key]; el.style.color = getScenarioRawColor(SCENARIO_SCORES[key]); } }

            renderSliders();
            initScenarioChart();

            document.querySelectorAll('.preset-pill').forEach(function(p) {
                p.addEventListener('click', function() { if (p.dataset.key === 'now' && activePreset === 'now') resetScenarios(); else selectPreset(p.dataset.key); });
            });

            document.getElementById('slider-toggle').addEventListener('click', function() {
                var panel = document.getElementById('slider-panel'), toggle = document.getElementById('slider-toggle');
                var collapsed = panel.classList.contains('collapsed');
                panel.classList.toggle('collapsed'); toggle.classList.toggle('open'); toggle.setAttribute('aria-expanded', collapsed);
            });

            document.getElementById('interp-more').addEventListener('click', function() {
                var text = document.getElementById('interp-text'), btn = document.getElementById('interp-more');
                var expanded = text.classList.contains('expanded');
                text.classList.toggle('expanded'); btn.textContent = expanded ? 'more \u25be' : 'less \u25b4';
            });

            window.addEventListener('resize', checkMobileTruncation);

            // ========================================
            // CHARTS
            // ========================================
            Chart.defaults.color = '#9898a8';
            Chart.defaults.font.family = "'JetBrains Mono', monospace";
            Chart.defaults.font.size = 10;

            var tc = getThemeColors();

            // Main chart
            mainChartInstance = new Chart(document.getElementById('mainChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: monthlyData.labels,
                    datasets: [{
                        label: 'Score', data: compositeScores,
                        borderColor: 'rgba(255, 201, 64, 1)', spanGaps: true,
                        segment: { borderColor: function(ctx) { var v = ctx.p0.parsed.y; return v >= 70 ? 'rgba(0, 217, 160, 1)' : v >= 55 ? 'rgba(255, 201, 64, 1)' : v >= 40 ? 'rgba(255, 140, 64, 1)' : 'rgba(255, 77, 106, 1)'; } },
                        backgroundColor: function(context) {
                            var chart = context.chart, area = chart.chartArea;
                            if (!area) return 'rgba(255, 201, 64, 0.05)';
                            var g = chart.ctx.createLinearGradient(0, area.bottom, 0, area.top);
                            g.addColorStop(0, 'rgba(255, 77, 106, 0.08)'); g.addColorStop(0.4, 'rgba(255, 140, 64, 0.08)');
                            g.addColorStop(0.55, 'rgba(255, 201, 64, 0.08)'); g.addColorStop(0.7, 'rgba(0, 217, 160, 0.08)');
                            return g;
                        },
                        fill: true, tension: 0.3, pointRadius: 0, pointHoverRadius: 6, pointHoverBackgroundColor: '#fff', borderWidth: 2
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: tc.tooltipBg, titleColor: tc.tooltipText, bodyColor: tc.tooltipSecondary, borderColor: tc.tooltipBorder, borderWidth: 1, padding: 12, displayColors: false,
                            callbacks: { title: function(items) { return items[0].label; }, label: function(item) { var s = item.raw, st = s >= 70 ? 'Good Time to Move' : s >= 55 ? 'Worth Exploring' : s >= 40 ? 'Build Your Position' : 'Get Creative'; return ['Score: ~' + s, st]; } }
                        },
                        annotation: { annotations: {
                            line70: { type: 'line', yMin: 70, yMax: 70, borderColor: 'rgba(0, 217, 160, 0.3)', borderWidth: 1, borderDash: [5, 5] },
                            line55: { type: 'line', yMin: 55, yMax: 55, borderColor: 'rgba(255, 201, 64, 0.3)', borderWidth: 1, borderDash: [5, 5] },
                            line40: { type: 'line', yMin: 40, yMax: 40, borderColor: 'rgba(255, 140, 64, 0.3)', borderWidth: 1, borderDash: [5, 5] }
                            // Historical annotations added dynamically via toggle
                        } }
                    },
                    scales: {
                        x: { grid: { color: tc.grid, drawBorder: false }, ticks: { maxTicksLimit: window.innerWidth < 480 ? 5 : window.innerWidth < 768 ? 8 : 12, maxRotation: 0, font: { size: window.innerWidth < 480 ? 8 : 10 }, color: tc.textMuted } },
                        y: { min: 0, max: 100, grid: { color: tc.grid, drawBorder: false }, ticks: { stepSize: 20, color: tc.textMuted } }
                    }
                }
            });

            // Restore chart annotations preference
            const savedAnnotations = localStorage.getItem('chartAnnotations');
            if (savedAnnotations === 'true') {
                document.getElementById('annotationsToggle').checked = true;
                toggleChartAnnotations();
            }

            // Sparklines
            function createSparkline(canvasId, dataArray, metric, rangeId) {
                var ctx = document.getElementById(canvasId).getContext('2d');
                var thresholds = { quitRate: { good: 2.5, neutral: 2.0 }, openingsRatio: { good: 1.2, neutral: 1.0 }, hiresRate: { good: 3.8, neutral: 3.4 }, layoffsRate: { good: 1.0, neutral: 1.3, inverted: true }, unempRate: { good: 4.0, neutral: 4.5, inverted: true }, fedRate: { good: 2.5, neutral: 4.0, inverted: true }, wageGrowth: { good: 4.0, neutral: 3.0 }, lfpr: { good: 83.0, neutral: 82.0 } };
                var validData = dataArray.filter(function(v) { return v != null && !isNaN(v); });
                var minVal = Math.min.apply(null, validData), maxVal = Math.max.apply(null, validData);
                var formatValue = function(val) { return metric === 'openingsRatio' ? val.toFixed(1) : metric === 'lfpr' ? val.toFixed(0) : val.toFixed(1); };
                if (rangeId) { var rangeEl = document.getElementById(rangeId); if (rangeEl) { rangeEl.querySelector('.max').textContent = formatValue(maxVal); rangeEl.querySelector('.min').textContent = formatValue(minVal); } }
                var getColor = function(val) { var t = thresholds[metric], c = getThemeColors(); if (!t) return c.sparklineNeutral; if (t.inverted) return val <= t.good ? c.sparklineGood : val <= t.neutral ? c.sparklineNeutral : c.sparklineBad; return val >= t.good ? c.sparklineGood : val >= t.neutral ? c.sparklineNeutral : c.sparklineBad; };
                var isDark = document.documentElement.getAttribute('data-theme') !== 'light';
                sparklineInstances[canvasId] = new Chart(ctx, {
                    type: 'line',
                    data: { labels: monthlyData.labels, datasets: [{ data: dataArray, borderColor: getThemeColors().sparklineNeutral, segment: { borderColor: function(ctx) { return getColor(ctx.p0.parsed.y); } }, backgroundColor: isDark ? 'rgba(255,255,255,0.03)' : 'rgba(0,0,0,0.03)', fill: true, tension: 0.4, pointRadius: 0, borderWidth: 1.5 }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { enabled: false } }, scales: { x: { display: false }, y: { display: false } } }
                });
            }

            createSparkline('quitChart', monthlyData.quitRate, 'quitRate', 'quitRange');
            createSparkline('openingsChart', monthlyData.openingsRatio, 'openingsRatio', 'ratioRange');
            createSparkline('hiresChart', monthlyData.hiresRate, 'hiresRate', 'hiresRange');
            createSparkline('layoffsChart', monthlyData.layoffsRate, 'layoffsRate', 'layoffsRange');
            createSparkline('unempChart', monthlyData.unempRate.map(function(v) { return v || 0; }), 'unempRate', 'unempRange');
            createSparkline('fedChart', monthlyData.fedRate, 'fedRate', 'fedRange');
            createSparkline('wageChart', monthlyData.wageGrowth.map(function(v) { return v || 0; }), 'wageGrowth', 'wageRange');
            createSparkline('lfprChart', monthlyData.lfpr.map(function(v) { return v || 0; }), 'lfpr', 'lfprRange');

            // ========================================
            // PHASE 8: Collapse metrics on mobile (after charts render)
            // ========================================
            if (window.innerWidth <= 768) {
                document.querySelectorAll('.metrics-grid').forEach(function(grid) {
                    grid.classList.add('mobile-collapsed');
                });
            }

            // Remove loading state
            document.body.classList.remove('js-loading');
        }

        // ========================================
        // PHASE 8: STICKY NAVIGATION
        // ========================================
        function initStickyNav() {
            var nav = document.getElementById('stickyNav');
            var links = nav.querySelectorAll('.nav-link');
            var headerEl = document.querySelector('header');

            // Show/hide on scroll
            window.addEventListener('scroll', function() {
                if (window.scrollY > (headerEl ? headerEl.offsetHeight + headerEl.offsetTop : 100)) {
                    nav.classList.add('visible');
                } else {
                    nav.classList.remove('visible');
                }
            }, { passive: true });

            // Active section tracking via IntersectionObserver
            var sections = document.querySelectorAll('[data-nav-section]');
            var observer = new IntersectionObserver(function(entries) {
                entries.forEach(function(entry) {
                    if (entry.isIntersecting) {
                        var id = entry.target.getAttribute('data-nav-section');
                        links.forEach(function(link) {
                            link.classList.toggle('active', link.getAttribute('data-nav-target') === id);
                        });
                    }
                });
            }, { rootMargin: '-20% 0px -70% 0px' });

            sections.forEach(function(section) { observer.observe(section); });

            // Smooth scroll on click
            links.forEach(function(link) {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    var targetId = this.getAttribute('data-nav-target');
                    var target = document.querySelector('[data-nav-section="' + targetId + '"]');
                    if (target) {
                        var navHeight = nav.offsetHeight;
                        var top = target.getBoundingClientRect().top + window.scrollY - navHeight - 8;
                        window.scrollTo({ top: top, behavior: 'smooth' });
                    }
                });
            });
        }

        // Initialize everything
        initDashboard();
        initStickyNav();
    </script>
</body>
</html>
