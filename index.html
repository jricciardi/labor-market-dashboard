<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is Now a Good Time? | Job Search Timing</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a25;
            --bg-card: #161620;
            --text-primary: #e8e8ed;
            --text-secondary: #9898a8;
            --text-muted: #606070;
            --accent-green: #00d9a0;
            --accent-green-dim: rgba(0, 217, 160, 0.12);
            --accent-yellow: #ffc940;
            --accent-yellow-dim: rgba(255, 201, 64, 0.12);
            --accent-orange: #ff8c40;
            --accent-orange-dim: rgba(255, 140, 64, 0.12);
            --accent-red: #ff4d6a;
            --accent-red-dim: rgba(255, 77, 106, 0.12);
            --accent-blue: #4d9fff;
            --border-color: #28283a;
            --chart-grid: rgba(255,255,255,0.04);
        }

        /* Skeleton loading animation */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .skeleton {
            background: linear-gradient(90deg, 
                var(--bg-tertiary) 25%, 
                rgba(255,255,255,0.08) 50%, 
                var(--bg-tertiary) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
        }

        .skeleton-text {
            height: 1em;
            display: inline-block;
            min-width: 60px;
        }

        .skeleton-score {
            width: 80px;
            height: 4.5rem;
            display: inline-block;
        }

        .skeleton-badge {
            width: 120px;
            height: 32px;
            border-radius: 20px;
        }

        /* Hide dynamic content until JS loads - prevents FOUC */
        .js-loading .metric-value,
        .js-loading .score-value,
        .js-loading .score-verdict,
        .js-loading .score-change,
        .js-loading .action-content,
        .js-loading .context-value:not(:last-child),
        .js-loading .recovery-summary,
        .js-loading #decompositionList,
        .js-loading #triggerList,
        .js-loading #sensitivityList {
            visibility: hidden;
        }

        .js-loading .skeleton {
            visibility: visible;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.025;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            z-index: 1000;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        header {
            margin-bottom: 32px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 24px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        h1 {
            font-family: 'Instrument Serif', serif;
            font-size: 2.2rem;
            font-weight: 400;
            letter-spacing: -0.02em;
            color: var(--text-primary);
        }

        .header-meta {
            text-align: right;
        }

        .last-updated {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: var(--bg-tertiary);
            padding: 6px 12px;
            border-radius: 4px;
            display: block;
            margin-bottom: 6px;
        }

        .next-update {
            font-size: 0.6rem;
            color: var(--text-muted);
        }

        .subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
            max-width: 700px;
        }

        /* Collapsible About Section */
        .about-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .about-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            cursor: pointer;
            user-select: none;
        }

        .about-header:hover {
            background: var(--bg-tertiary);
        }

        .about-header h2 {
            font-family: 'Instrument Serif', serif;
            font-size: 1.1rem;
            font-weight: 400;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .about-toggle {
            font-size: 0.7rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .about-toggle .icon {
            transition: transform 0.2s ease;
        }

        .about-section.collapsed .about-toggle .icon {
            transform: rotate(-90deg);
        }

        .about-content {
            padding: 0 24px 24px 24px;
            display: grid;
            grid-template-columns: 1.4fr 1fr;
            gap: 32px;
        }

        .about-section.collapsed .about-content {
            display: none;
        }

        .about-main p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .about-main p:last-child {
            margin-bottom: 0;
        }

        .about-main strong {
            color: var(--text-primary);
        }

        .about-main em {
            color: var(--accent-yellow);
            font-style: normal;
        }

        .about-how {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px 20px;
        }

        .about-how h3 {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .about-how ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .about-how li {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            padding-left: 0;
        }

        .about-how li strong {
            color: var(--text-primary);
        }

        /* Hero Score Section */
        .hero-score {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 28px 32px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .hero-score::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-orange) 33%, var(--accent-yellow) 66%, var(--accent-green));
        }

        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .score-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .score-display {
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .score-value {
            font-size: 4.5rem;
            font-weight: 700;
            line-height: 1;
            font-variant-numeric: tabular-nums;
        }

        .score-approx {
            font-size: 1.5rem;
            font-weight: 400;
            color: var(--text-muted);
            margin-right: -4px;
        }

        .score-value.good-time { color: var(--accent-green); }
        .score-value.worth-exploring { color: var(--accent-yellow); }
        .score-value.build-your-position { color: var(--accent-orange); }
        .score-value.tough-market { color: var(--accent-red); }

        .score-max {
            font-size: 1.2rem;
            color: var(--text-muted);
        }

        .score-meta {
            text-align: right;
        }

        .score-verdict {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .score-verdict.good-time {
            background: var(--accent-green-dim);
            color: var(--accent-green);
            border: 1px solid rgba(0, 217, 160, 0.3);
        }

        .score-verdict.worth-exploring {
            background: var(--accent-yellow-dim);
            color: var(--accent-yellow);
            border: 1px solid rgba(255, 201, 64, 0.3);
        }

        .score-verdict.build-your-position {
            background: var(--accent-orange-dim);
            color: var(--accent-orange);
            border: 1px solid rgba(255, 140, 64, 0.3);
        }

        .score-verdict.tough-market {
            background: var(--accent-red-dim);
            color: var(--accent-red);
            border: 1px solid rgba(255, 77, 106, 0.3);
        }

        .verdict-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .verdict-icon.good-time { background: var(--accent-green); }
        .verdict-icon.worth-exploring { background: var(--accent-yellow); }
        .verdict-icon.build-your-position { background: var(--accent-orange); }
        .verdict-icon.tough-market { background: var(--accent-red); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .score-change {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* What Should I Do Section */
        .action-section {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 20px 24px;
        }

        .action-header {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-content {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .action-content strong {
            color: var(--text-primary);
        }

        .action-list {
            margin-top: 12px;
            padding-left: 0;
            list-style: none;
        }

        .action-list li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .action-list li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: var(--accent-green);
            font-size: 0.7rem;
        }

        .action-section.build-your-position .action-list li::before,
        .action-section.tough-market .action-list li::before {
            content: 'â†’';
            color: var(--text-muted);
        }

        /* Main Chart */
        .main-chart {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .chart-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-legend {
            display: flex;
            gap: 16px;
            font-size: 0.65rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }

        .legend-dot.green { background: var(--accent-green); }
        .legend-dot.yellow { background: var(--accent-yellow); }
        .legend-dot.orange { background: var(--accent-orange); }
        .legend-dot.red { background: var(--accent-red); }

        .chart-container {
            position: relative;
            height: 320px;
        }

        /* Tier Sections */
        .tier-section {
            margin-bottom: 32px;
        }

        .tier-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .tier-badge {
            font-size: 0.55rem;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: rgba(77, 159, 255, 0.15);
            color: var(--accent-blue);
            border: 1px solid rgba(77, 159, 255, 0.3);
        }

        .tier-title {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .tier-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-left: 4px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            overflow: hidden; /* Prevent chart overflow */
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .metric-info h3 {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .metric-info .description {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            flex-shrink: 0;
        }

        .metric-value.good { color: var(--accent-green); }
        .metric-value.neutral { color: var(--accent-yellow); }
        .metric-value.bad { color: var(--accent-red); }

        .metric-chart-wrapper {
            display: flex;
            align-items: stretch;
            gap: 6px;
            margin-top: 8px;
            width: 100%;
            max-width: 100%;
        }

        .metric-chart {
            height: 80px;
            flex: 1;
            min-width: 0;
            max-width: calc(100% - 38px); /* Account for sparkline-range width + gap */
            position: relative;
        }

        .sparkline-range {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 0.55rem;
            color: var(--text-muted);
            text-align: right;
            padding: 2px 0;
            min-width: 32px;
        }

        .sparkline-range .max,
        .sparkline-range .min {
            font-variant-numeric: tabular-nums;
        }

        /* How Does This Compare Section */
        .context-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .context-header {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .context-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
        }

        .context-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
        }

        .context-label {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .context-value {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .context-value.highlight {
            color: var(--accent-yellow);
        }

        /* Path to Better Section */
        .recovery-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .recovery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .recovery-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .distance-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.7rem;
            font-weight: 600;
            background: var(--accent-yellow-dim);
            color: var(--accent-yellow);
            border: 1px solid rgba(255, 201, 64, 0.3);
        }

        .recovery-summary {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.6;
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .recovery-summary strong {
            color: var(--text-primary);
        }

        .recovery-summary .trend-positive {
            color: var(--accent-green);
            font-weight: 600;
        }

        .recovery-summary .trend-negative {
            color: var(--accent-red);
            font-weight: 600;
        }

        .recovery-summary .trend-neutral {
            color: var(--accent-yellow);
            font-weight: 600;
        }

        .recovery-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .recovery-grid {
                grid-template-columns: 1fr;
            }
        }

        .recovery-panel {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px;
        }

        .panel-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        /* Score Decomposition */
        .decomposition-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .decomposition-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric-name {
            font-size: 0.7rem;
            color: var(--text-secondary);
            width: 130px;
            flex-shrink: 0;
        }

        .metric-bar-container {
            flex: 1;
            height: 8px;
            background: var(--bg-primary);
            border-radius: 4px;
            overflow: hidden;
        }

        .metric-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .metric-bar.good { background: var(--accent-green); }
        .metric-bar.neutral { background: var(--accent-yellow); }
        .metric-bar.poor { background: var(--accent-orange); }
        .metric-bar.bad { background: var(--accent-red); }

        .metric-score {
            font-size: 0.65rem;
            color: var(--text-muted);
            width: 28px;
            text-align: right;
        }

        .decomposition-footnote {
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            font-size: 0.6rem;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .footnote-marker {
            color: var(--accent-yellow);
            font-weight: 600;
        }

        /* Trigger Conditions */
        .trigger-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .trigger-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: var(--bg-primary);
            border-radius: 6px;
            border-left: 3px solid var(--text-muted);
        }

        .trigger-item.watching {
            border-left-color: var(--accent-yellow);
        }

        .trigger-item.met {
            border-left-color: var(--accent-green);
        }

        .trigger-icon {
            font-size: 0.8rem;
            margin-top: 1px;
        }

        .trigger-content {
            flex: 1;
        }

        .trigger-condition {
            font-size: 0.75rem;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .trigger-status {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        .trigger-trend {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
            font-size: 0.6rem;
        }

        .trend-arrow {
            font-weight: 700;
            font-size: 0.75rem;
        }

        .trend-history {
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        .trigger-trend.trend-good .trend-arrow { color: var(--accent-green); }
        .trigger-trend.trend-bad .trend-arrow { color: var(--accent-red); }
        .trigger-trend.trend-flat .trend-arrow { color: var(--text-muted); }

        /* Sensitivity / What Would It Take */
        .sensitivity-intro {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 12px;
            font-style: italic;
        }

        .sensitivity-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .sensitivity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: var(--bg-primary);
            border-radius: 6px;
        }

        .sensitivity-scenario {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .sensitivity-result {
            font-size: 0.75rem;
            font-weight: 600;
        }

        .sensitivity-result.positive { color: var(--accent-green); }
        .sensitivity-result.neutral { color: var(--accent-yellow); }
        .sensitivity-result.negative { color: var(--accent-orange); }

        /* Understanding the Score Accordion */
        .accordion-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .accordion-header {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .accordion-item {
            border-bottom: 1px solid var(--border-color);
        }

        .accordion-item:last-child {
            border-bottom: none;
        }

        .accordion-trigger {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 16px 24px;
            background: none;
            border: none;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            text-align: left;
        }

        .accordion-trigger:hover {
            background: var(--bg-tertiary);
        }

        .accordion-trigger .icon {
            color: var(--text-muted);
            transition: transform 0.2s ease;
        }

        .accordion-item.open .accordion-trigger .icon {
            transform: rotate(180deg);
        }

        .accordion-panel {
            display: none;
            padding: 0 24px 20px 24px;
        }

        .accordion-item.open .accordion-panel {
            display: block;
        }

        .accordion-panel p {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .accordion-panel p:last-child {
            margin-bottom: 0;
        }

        .accordion-panel ul {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .accordion-panel li {
            margin-bottom: 6px;
        }

        .accordion-panel strong {
            color: var(--text-primary);
        }

        .accordion-panel a {
            color: var(--accent-blue);
            text-decoration: none;
        }

        .accordion-panel a:hover {
            text-decoration: underline;
        }

        /* Footer */
        footer {
            text-align: left;
            padding: 28px 0;
            font-size: 0.7rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border-color);
            margin-top: 20px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr;
            gap: 32px;
            margin-bottom: 20px;
        }

        .footer-content strong {
            color: var(--text-secondary);
            display: block;
            margin-bottom: 6px;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .footer-about {
            line-height: 1.6;
        }

        .footer-links a {
            color: var(--accent-blue);
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .footer-bottom {
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.65rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .about-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .chart-legend {
                justify-content: flex-start;
            }

            .recovery-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .score-value {
                font-size: 3rem;
            }
            
            .score-approx {
                font-size: 1.2rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .header-top {
                flex-direction: column;
                gap: 12px;
            }

            .header-meta {
                text-align: left;
            }

            .context-grid {
                grid-template-columns: 1fr 1fr;
            }

            .chart-legend {
                gap: 8px;
                font-size: 0.55rem;
            }

            .legend-item {
                gap: 4px;
            }

            .legend-dot {
                width: 8px;
                height: 8px;
            }

            .score-header {
                flex-direction: column;
                gap: 16px;
            }

            .score-meta {
                text-align: left;
            }

            .tier-header {
                flex-wrap: wrap;
            }

            .tier-subtitle {
                width: 100%;
                margin-left: 0;
                margin-top: 4px;
            }

            .accordion-trigger {
                padding: 14px 16px;
                font-size: 0.75rem;
            }

            .accordion-panel {
                padding: 0 16px 16px 16px;
            }

            .recovery-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .sensitivity-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .trigger-trend {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .context-grid {
                grid-template-columns: 1fr;
            }

            .chart-legend {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .about-how ul {
                font-size: 0.7rem;
            }

            .action-list li {
                font-size: 0.75rem;
            }

            .metric-header {
                flex-direction: column;
                gap: 8px;
            }

            .metric-value {
                font-size: 1.5rem;
            }

            .sparkline-range {
                font-size: 0.5rem;
                min-width: 28px;
            }

            .metric-chart {
                max-width: calc(100% - 34px); /* Smaller range column on mobile */
            }

            .metric-card {
                padding: 16px;
            }
        }
    </style>
</head>
<body class="js-loading">
    <div class="noise-overlay"></div>
    
    <div class="container">
        <header>
            <div class="header-top">
                <h1>Is Now a Good Time?</h1>
                <div class="header-meta">
                    <span class="last-updated" id="lastUpdated"><span class="skeleton skeleton-text" style="width: 180px;"></span></span>
                    <span class="next-update" id="nextUpdate">Next update expected: ~Feb 7</span>
                </div>
            </div>
            <p class="subtitle">Data to help you decide when to look for a new job.</p>
        </header>

        <!-- Collapsible About Section -->
        <section class="about-section" id="aboutSection">
            <div class="about-header" onclick="toggleAbout()">
                <h2>What is this?</h2>
                <span class="about-toggle">
                    <span id="aboutToggleText">Hide</span>
                    <span class="icon">â–¼</span>
                </span>
            </div>
            <div class="about-content">
                <div class="about-main">
                    <p>This page tracks whether the job market currently favors <strong>people looking for work</strong> or <strong>employers doing the hiring</strong>. It combines eight economic indicators into a single score to help answer: <em>is now a good time to look for a new job?</em></p>
                    <p>The score runs from 0 to 100. Higher means better for job seekers. The data comes from the Bureau of Labor Statistics and Federal Reserve, updated monthly.</p>
                </div>
                <div class="about-how">
                    <h3>How to read this</h3>
                    <ul>
                        <li><strong>The score</strong> â€” A quick read on conditions. Higher = better for job seekers.</li>
                        <li><strong>Core metrics</strong> â€” Direct measures like quit rate and hiring velocity.</li>
                        <li><strong>Bigger picture</strong> â€” Economic forces like unemployment and Fed policy.</li>
                        <li><strong>What would it take</strong> â€” What needs to change for conditions to improve.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Hero Score -->
        <section class="hero-score">
            <div class="score-header">
                <div>
                    <div class="score-label">The Score</div>
                    <div class="score-display">
                        <span class="score-approx">~</span>
                        <span class="score-value" id="currentScore"><span class="skeleton skeleton-score"></span></span>
                        <span class="score-max">/ 100</span>
                    </div>
                </div>
                <div class="score-meta">
                    <div class="score-verdict" id="scoreVerdict">
                        <span class="verdict-icon" id="verdictIcon"></span>
                        <span id="verdictText"><span class="skeleton skeleton-text" style="width: 100px;"></span></span>
                    </div>
                    <div class="score-change" id="scoreChange"><span class="skeleton skeleton-text" style="width: 140px;"></span></div>
                </div>
            </div>
            
            <!-- What Should I Do Section -->
            <div class="action-section" id="actionSection">
                <div class="action-header">
                    <span>ðŸ’¡</span>
                    <span>What should I do?</span>
                </div>
                <div class="action-content" id="actionContent">
                    <span class="skeleton skeleton-text" style="width: 100%;"></span>
                    <span class="skeleton skeleton-text" style="width: 90%; margin-top: 8px;"></span>
                </div>
            </div>
        </section>

        <!-- Main Time Series Chart -->
        <section class="main-chart">
            <div class="chart-header">
                <div class="chart-title">The Score Over Time (2015â€“2025)</div>
                <div class="chart-legend">
                    <div class="legend-item"><span class="legend-dot green"></span> Good Time to Move (70+)</div>
                    <div class="legend-item"><span class="legend-dot yellow"></span> Worth Exploring (55â€“69)</div>
                    <div class="legend-item"><span class="legend-dot orange"></span> Build Your Position (40â€“54)</div>
                    <div class="legend-item"><span class="legend-dot red"></span> Tough Market (&lt;40)</div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="mainChart"></canvas>
            </div>
        </section>

        <!-- Core Metrics -->
        <section class="tier-section">
            <div class="tier-header">
                <span class="tier-badge">Core</span>
                <span class="tier-title">The Core Metrics</span>
                <span class="tier-subtitle">â€” How much leverage do workers have right now?</span>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Quit Rate</h3>
                            <span class="description">Workers confident enough to leave voluntarily</span>
                        </div>
                        <span class="metric-value" id="quitValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="quitChart"></canvas></div>
                        <div class="sparkline-range" id="quitRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Jobs per Job Seeker</h3>
                            <span class="description">Open positions Ã· unemployed workers</span>
                        </div>
                        <span class="metric-value" id="ratioValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="openingsChart"></canvas></div>
                        <div class="sparkline-range" id="ratioRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Hiring Rate</h3>
                            <span class="description">Actual hires happening, not just postings</span>
                        </div>
                        <span class="metric-value" id="hiresValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="hiresChart"></canvas></div>
                        <div class="sparkline-range" id="hiresRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Layoff Rate</h3>
                            <span class="description">Involuntary job losses</span>
                        </div>
                        <span class="metric-value" id="layoffsValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="layoffsChart"></canvas></div>
                        <div class="sparkline-range" id="layoffsRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Bigger Picture -->
        <section class="tier-section">
            <div class="tier-header">
                <span class="tier-badge">Context</span>
                <span class="tier-title">The Bigger Picture</span>
                <span class="tier-subtitle">â€” Economic forces shaping the job market</span>
            </div>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Unemployment Rate</h3>
                            <span class="description">Share of workforce without jobs</span>
                        </div>
                        <span class="metric-value" id="unempValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="unempChart"></canvas></div>
                        <div class="sparkline-range" id="unempRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Fed Interest Rate</h3>
                            <span class="description">Cost of borrowing that affects hiring budgets</span>
                        </div>
                        <span class="metric-value" id="fedValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="fedChart"></canvas></div>
                        <div class="sparkline-range" id="fedRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Wage Growth</h3>
                            <span class="description">Year-over-year change in average pay</span>
                        </div>
                        <span class="metric-value" id="wageValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="wageChart"></canvas></div>
                        <div class="sparkline-range" id="wageRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-info">
                            <h3>Workforce Participation</h3>
                            <span class="description">Share of 25-54 year olds working or looking</span>
                        </div>
                        <span class="metric-value" id="lfprValue"><span class="skeleton skeleton-text"></span></span>
                    </div>
                    <div class="metric-chart-wrapper">
                        <div class="metric-chart"><canvas id="lfprChart"></canvas></div>
                        <div class="sparkline-range" id="lfprRange">
                            <span class="max">--</span>
                            <span class="min">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- How Does This Compare -->
        <section class="context-section">
            <div class="context-header">How Does This Compare?</div>
            <div class="context-grid">
                <div class="context-item">
                    <div class="context-label">Current Conditions</div>
                    <div class="context-value highlight" id="cyclePosition"><span class="skeleton skeleton-text"></span></div>
                </div>
                <div class="context-item">
                    <div class="context-label">Similar to</div>
                    <div class="context-value" id="historicalAnalog"><span class="skeleton skeleton-text"></span></div>
                </div>
                <div class="context-item">
                    <div class="context-label">Best on Record</div>
                    <div class="context-value" id="peakContext"><span class="skeleton skeleton-text"></span></div>
                </div>
                <div class="context-item">
                    <div class="context-label">COVID Crash</div>
                    <div class="context-value" id="covidContext"><span class="skeleton skeleton-text"></span></div>
                </div>
                <div class="context-item">
                    <div class="context-label">Before Pandemic</div>
                    <div class="context-value" id="prePandemicContext"><span class="skeleton skeleton-text"></span></div>
                </div>
                <div class="context-item">
                    <div class="context-label">Key Signal to Watch</div>
                    <div class="context-value">Quit rate above 2.3% for 3+ months</div>
                </div>
            </div>
        </section>

        <!-- Path to Better Section -->
        <section class="recovery-section">
            <div class="recovery-header">
                <div class="recovery-title" id="recoveryTitle">Path to "Worth Exploring"</div>
                <div class="distance-badge" id="distanceBadge">
                    <span id="distancePoints">--</span> points to go
                </div>
            </div>
            <div class="recovery-summary" id="recoverySummary">
                <span class="skeleton skeleton-text" style="width: 100%;"></span>
                <span class="skeleton skeleton-text" style="width: 80%; margin-top: 8px;"></span>
            </div>
            <div class="recovery-grid">
                <!-- What's Holding the Score Down -->
                <div class="recovery-panel">
                    <div class="panel-title">What's Holding the Score Down?</div>
                    <div class="decomposition-list" id="decompositionList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Signs of Improvement -->
                <div class="recovery-panel">
                    <div class="panel-title">Signs of Improvement to Watch</div>
                    <div class="trigger-list" id="triggerList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- What Would It Take -->
                <div class="recovery-panel" style="grid-column: 1 / -1;">
                    <div class="panel-title">What Would It Take?</div>
                    <div class="sensitivity-intro">These scenarios show individual changes. In practice, multiple metrics often move together.</div>
                    <div class="sensitivity-list" id="sensitivityList">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Understanding the Score -->
        <section class="accordion-section">
            <div class="accordion-header">Understanding the Score</div>
            
            <div class="accordion-item" id="accordion-calc">
                <button class="accordion-trigger" onclick="toggleAccordion('accordion-calc')">
                    <span>How is this calculated?</span>
                    <span class="icon">â–¼</span>
                </button>
                <div class="accordion-panel">
                    <p>The score combines eight labor market indicators, weighted by how directly they measure worker leverage:</p>
                    <ul>
                        <li><strong>Core metrics (60% of score):</strong> Quit rate, job openings per unemployed worker, hiring rate, and layoff rate. These directly measure whether workers or employers have the upper hand.</li>
                        <li><strong>Context metrics (40% of score):</strong> Unemployment rate, Fed interest rate, wage growth, and workforce participation. These shape the environment but are less direct.</li>
                    </ul>
                    <p>The score also applies adjustments for unusual conditions: when the job openings ratio falls below 1.0 (more seekers than jobs), when the market is "frozen" (low hiring AND low quitting), and when Fed rates are near zero (historically stimulative).</p>
                </div>
            </div>
            
            <div class="accordion-item" id="accordion-limits">
                <button class="accordion-trigger" onclick="toggleAccordion('accordion-limits')">
                    <span>What are the limitations?</span>
                    <span class="icon">â–¼</span>
                </button>
                <div class="accordion-panel">
                    <p><strong>This is national data.</strong> Your industry, region, and role may differ significantly. Tech hiring can freeze while healthcare booms. San Francisco and rural Ohio are different markets.</p>
                    <p><strong>The data lags reality.</strong> BLS releases come 4-6 weeks after the reference month. By the time you see it here, conditions may have shifted.</p>
                    <p><strong>The thresholds are calibrated to recent history.</strong> A "bad" quit rate today might have been normal in 2010. The score tells you how now compares to 2015-2025, not to all of history.</p>
                    <p><strong>There's no confidence interval.</strong> The score of "47" should really be read as "somewhere around 45-50" given measurement uncertainty and model choices.</p>
                </div>
            </div>
            
            <div class="accordion-item" id="accordion-data">
                <button class="accordion-trigger" onclick="toggleAccordion('accordion-data')">
                    <span>Where does the data come from?</span>
                    <span class="icon">â–¼</span>
                </button>
                <div class="accordion-panel">
                    <p>All data comes from official government sources, retrieved via the <a href="https://fred.stlouisfed.org/" target="_blank">Federal Reserve Economic Data (FRED)</a> API:</p>
                    <ul>
                        <li><strong>Quit rate, hiring rate, layoff rate, job openings:</strong> Bureau of Labor Statistics <a href="https://www.bls.gov/jlt/" target="_blank">Job Openings and Labor Turnover Survey (JOLTS)</a></li>
                        <li><strong>Unemployment rate, workforce participation, wage growth:</strong> Bureau of Labor Statistics <a href="https://www.bls.gov/ces/" target="_blank">Employment Situation Report</a></li>
                        <li><strong>Fed interest rate:</strong> Federal Reserve <a href="https://www.federalreserve.gov/monetarypolicy/openmarket.htm" target="_blank">Open Market Operations</a></li>
                    </ul>
                    <p>Data updates automatically each month after BLS releases. The code is open source if you want to verify or adapt it.</p>
                </div>
            </div>
        </section>

        <footer>
            <div class="footer-content">
                <div class="footer-about">
                    <strong>About this project</strong><br>
                    Built to help workers make informed decisions about job search timing. The score synthesizes government data into an actionable signalâ€”no spin, no narratives, just numbers.<br><br>
                    This project is <a href="https://github.com/jricciardi/labor-market-dashboard">open source</a>. Fork it, adapt it for your industry, or suggest improvements. Built with AI assistance as an experiment in pro-worker tooling.
                </div>
                <div class="footer-links">
                    <strong>Resources</strong><br>
                    <a href="https://www.bls.gov/jlt/">BLS JOLTS</a> Â· 
                    <a href="https://fred.stlouisfed.org/">FRED</a> Â· 
                    <a href="https://github.com/jricciardi/labor-market-dashboard">Source Code</a>
                </div>
                <div class="footer-data">
                    <strong>Data Sources</strong><br>
                    BLS JOLTS, BLS Employment Situation, Federal Reserve
                </div>
            </div>
            <div class="footer-bottom">
                Updated monthly after BLS data releases (usually first week of the month). Not financial or career advice.
            </div>
        </footer>
    </div>

    <script>
        // Toggle functions for collapsible sections
        function toggleAbout() {
            const section = document.getElementById('aboutSection');
            const toggleText = document.getElementById('aboutToggleText');
            section.classList.toggle('collapsed');
            toggleText.textContent = section.classList.contains('collapsed') ? 'Show' : 'Hide';
            
            // Remember preference
            localStorage.setItem('aboutCollapsed', section.classList.contains('collapsed'));
        }

        function toggleAccordion(id) {
            const item = document.getElementById(id);
            item.classList.toggle('open');
        }

        // Check if about section should be collapsed on load
        document.addEventListener('DOMContentLoaded', function() {
            const aboutCollapsed = localStorage.getItem('aboutCollapsed');
            if (aboutCollapsed === 'true') {
                document.getElementById('aboutSection').classList.add('collapsed');
                document.getElementById('aboutToggleText').textContent = 'Show';
            }
        });

        // Tier name mappings
        const tierNames = {
            'good-time': 'Good Time to Move',
            'worth-exploring': 'Worth Exploring', 
            'build-your-position': 'Build Your Position',
            'tough-market': 'Tough Market'
        };

        // Action advice for each tier
        const actionAdvice = {
            'good-time': {
                intro: 'The market favors job seekers right now. If you\'ve been considering a move, this is a rational time to act.',
                actions: [
                    'Apply actively to roles that interest you',
                    'Respond positively to recruiter outreach',
                    'Negotiate confidentlyâ€”you have leverage',
                    'Take informational interviews to expand options'
                ]
            },
            'worth-exploring': {
                intro: 'Conditions are decent for job seekers. Selective searching makes sense, but be thoughtful about what you pursue.',
                actions: [
                    'Apply to roles that are strong fits',
                    'Maintain and expand your network',
                    'Take informational interviews when offered',
                    'Don\'t feel rushedâ€”wait for good opportunities'
                ]
            },
            'build-your-position': {
                intro: 'The market currently favors employers. If you can stay put, this may not be the best time to search actively.',
                actions: [
                    'Focus on building skills in your current role',
                    'Network quietly without urgency',
                    'Save aggressively for runway',
                    'Only pursue exceptional opportunities'
                ]
            },
            'tough-market': {
                intro: 'This is a difficult market for job seekers. Prioritize stability unless you have no choice.',
                actions: [
                    'Protect your current position',
                    'Build skills that will matter when conditions improve',
                    'Keep your network warm but don\'t push',
                    'Only move for truly compelling opportunities or necessity'
                ]
            }
        };

        // Fetch data and initialize dashboard
        async function initDashboard() {
            const response = await fetch('data.json');
            const data = await response.json();
            
            const monthlyData = {
                labels: data.labels,
                quitRate: data.quitRate,
                openingsRatio: data.openingsRatio,
                hiresRate: data.hiresRate,
                layoffsRate: data.layoffsRate,
                unempRate: data.unempRate,
                fedRate: data.fedRate,
                wageGrowth: data.wageGrowth,
                lfpr: data.lfpr
            };
            
            // Update timestamps
            const lastUpdated = new Date(data.metadata.lastUpdated);
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            const formattedDate = lastUpdated.toLocaleDateString('en-US', options);
            const dataMonth = data.metadata.dataThrough.split('-');
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const dataThrough = monthNames[parseInt(dataMonth[1]) - 1] + ' ' + dataMonth[0];
            document.getElementById('lastUpdated').textContent = `Updated ${formattedDate} â€¢ Data through ${dataThrough}`;
            
            // Calculate next update (roughly 7th of next month)
            const nextMonth = new Date(lastUpdated);
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            nextMonth.setDate(7);
            const nextUpdateText = `Next update: ~${monthNames[nextMonth.getMonth()]} ${nextMonth.getDate()}`;
            document.getElementById('nextUpdate').textContent = nextUpdateText;

            // Calculate composite scores
            function calculateCompositeScore(idx) {
                const quit = monthlyData.quitRate[idx];
                const ratio = monthlyData.openingsRatio[idx];
                const hires = monthlyData.hiresRate[idx];
                const layoffs = monthlyData.layoffsRate[idx];
                const unemp = monthlyData.unempRate[idx];
                const fed = monthlyData.fedRate[idx];
                const wage = monthlyData.wageGrowth[idx];
                const lfpr = monthlyData.lfpr[idx];
                
                if (quit == null || ratio == null) return null;
                
                const quitScore = Math.min(1, Math.max(0, (quit - 1.5) / 1.5));
                const ratioScore = Math.min(1, Math.max(0, (ratio - 0.3) / 1.7));
                const hiresScore = Math.min(1, Math.max(0, (hires - 2.0) / 2.5));
                const layoffsScore = Math.min(1, Math.max(0, (2.5 - layoffs) / 1.7));
                const unempScore = unemp != null ? Math.min(1, Math.max(0, (7.0 - unemp) / 3.5)) : 0.5;
                const fedScore = Math.min(1, Math.max(0, (5.5 - fed) / 5.5));
                const wageScore = wage != null ? Math.min(1, Math.max(0, (wage - 2.0) / 3.0)) : 0.5;
                const lfprScore = lfpr != null ? Math.min(1, Math.max(0, (lfpr - 79) / 4.0)) : 0.5;
                
                const tier1 = (quitScore + ratioScore + hiresScore + layoffsScore) / 4 * 0.6;
                const tier2 = (unempScore + fedScore + wageScore + lfprScore) / 4 * 0.4;
                
                let baseScore = (tier1 + tier2) * 100;
                
                if (ratio < 1.0) baseScore *= 0.92;
                const churnPenalty = 0.12 * (1 - Math.min(quitScore, hiresScore));
                baseScore *= (1 - churnPenalty);
                if (fed < 0.5) baseScore *= 1.08;
                
                return Math.min(100, Math.round(baseScore));
            }

            const compositeScores = monthlyData.labels.map((_, idx) => calculateCompositeScore(idx));
            
            // Find peak and current
            let peakScore = 0;
            let peakIdx = 0;
            compositeScores.forEach((score, idx) => {
                if (score !== null && score > peakScore) {
                    peakScore = score;
                    peakIdx = idx;
                }
            });
            
            let currentScore = compositeScores[compositeScores.length - 1];
            let currentIdx = compositeScores.length - 1;
            while (currentScore === null && currentIdx > 0) {
                currentIdx--;
                currentScore = compositeScores[currentIdx];
            }
            
            // Determine tier
            let tierClass, tierKey;
            if (currentScore >= 70) {
                tierClass = 'good-time';
                tierKey = 'good-time';
            } else if (currentScore >= 55) {
                tierClass = 'worth-exploring';
                tierKey = 'worth-exploring';
            } else if (currentScore >= 40) {
                tierClass = 'build-your-position';
                tierKey = 'build-your-position';
            } else {
                tierClass = 'tough-market';
                tierKey = 'tough-market';
            }
            
            // Update score display
            document.getElementById('currentScore').textContent = currentScore;
            document.getElementById('currentScore').className = 'score-value ' + tierClass;
            document.getElementById('scoreVerdict').className = 'score-verdict ' + tierClass;
            document.getElementById('verdictIcon').className = 'verdict-icon ' + tierClass;
            document.getElementById('verdictText').textContent = tierNames[tierKey];
            document.getElementById('actionSection').className = 'action-section ' + tierClass;
            
            // Set border color for action section
            const accentColors = {
                'good-time': 'var(--accent-green)',
                'worth-exploring': 'var(--accent-yellow)',
                'build-your-position': 'var(--accent-orange)',
                'tough-market': 'var(--accent-red)'
            };
            document.getElementById('actionSection').style.borderLeft = '3px solid ' + accentColors[tierKey];
            
            const diff = peakScore - currentScore;
            document.getElementById('scoreChange').textContent = `â†“ ${diff} pts from peak (${monthlyData.labels[peakIdx]})`;
            
            // Update action content
            const advice = actionAdvice[tierKey];
            let actionHTML = `<p>${advice.intro}</p><ul class="action-list">`;
            advice.actions.forEach(action => {
                actionHTML += `<li>${action}</li>`;
            });
            actionHTML += '</ul>';
            document.getElementById('actionContent').innerHTML = actionHTML;
            
            // Update metric values
            const currentMetrics = {
                quitRate: monthlyData.quitRate[currentIdx],
                openingsRatio: monthlyData.openingsRatio[currentIdx],
                hiresRate: monthlyData.hiresRate[currentIdx],
                layoffsRate: monthlyData.layoffsRate[currentIdx],
                unempRate: monthlyData.unempRate[currentIdx],
                fedRate: monthlyData.fedRate[currentIdx],
                wageGrowth: monthlyData.wageGrowth[currentIdx],
                lfpr: monthlyData.lfpr[currentIdx]
            };
            
            // Update displayed values with color coding
            function getMetricClass(value, metric) {
                const thresholds = {
                    quitRate: { good: 2.5, neutral: 2.0 },
                    openingsRatio: { good: 1.2, neutral: 1.0 },
                    hiresRate: { good: 3.8, neutral: 3.4 },
                    layoffsRate: { good: 1.0, neutral: 1.3, inverted: true },
                    unempRate: { good: 4.0, neutral: 4.5, inverted: true },
                    fedRate: { good: 2.5, neutral: 4.0, inverted: true },
                    wageGrowth: { good: 4.0, neutral: 3.0 },
                    lfpr: { good: 83.0, neutral: 82.0 }
                };
                const t = thresholds[metric];
                if (!t) return 'neutral';
                if (t.inverted) {
                    if (value <= t.good) return 'good';
                    if (value <= t.neutral) return 'neutral';
                    return 'bad';
                } else {
                    if (value >= t.good) return 'good';
                    if (value >= t.neutral) return 'neutral';
                    return 'bad';
                }
            }
            
            document.getElementById('quitValue').textContent = currentMetrics.quitRate.toFixed(1) + '%';
            document.getElementById('quitValue').className = 'metric-value ' + getMetricClass(currentMetrics.quitRate, 'quitRate');
            
            document.getElementById('ratioValue').textContent = currentMetrics.openingsRatio.toFixed(2);
            document.getElementById('ratioValue').className = 'metric-value ' + getMetricClass(currentMetrics.openingsRatio, 'openingsRatio');
            
            document.getElementById('hiresValue').textContent = currentMetrics.hiresRate.toFixed(1) + '%';
            document.getElementById('hiresValue').className = 'metric-value ' + getMetricClass(currentMetrics.hiresRate, 'hiresRate');
            
            document.getElementById('layoffsValue').textContent = currentMetrics.layoffsRate.toFixed(1) + '%';
            document.getElementById('layoffsValue').className = 'metric-value ' + getMetricClass(currentMetrics.layoffsRate, 'layoffsRate');
            
            document.getElementById('unempValue').textContent = (currentMetrics.unempRate || 0).toFixed(1) + '%';
            document.getElementById('unempValue').className = 'metric-value ' + getMetricClass(currentMetrics.unempRate || 5, 'unempRate');
            
            document.getElementById('fedValue').textContent = currentMetrics.fedRate.toFixed(2) + '%';
            document.getElementById('fedValue').className = 'metric-value ' + getMetricClass(currentMetrics.fedRate, 'fedRate');
            
            document.getElementById('wageValue').textContent = (currentMetrics.wageGrowth || 0).toFixed(1) + '%';
            document.getElementById('wageValue').className = 'metric-value ' + getMetricClass(currentMetrics.wageGrowth || 3, 'wageGrowth');
            
            document.getElementById('lfprValue').textContent = (currentMetrics.lfpr || 0).toFixed(1) + '%';
            document.getElementById('lfprValue').className = 'metric-value ' + getMetricClass(currentMetrics.lfpr || 82, 'lfpr');

            // Historical context
            document.getElementById('peakContext').textContent = `${peakScore} (${monthlyData.labels[peakIdx]})`;
            
            const covidIdx = monthlyData.labels.indexOf('Apr-20');
            const covidScore = compositeScores[covidIdx];
            document.getElementById('covidContext').textContent = `${covidScore} (Apr 2020)`;
            
            const prePandemicIdx = monthlyData.labels.indexOf('Dec-19');
            const prePandemicScore = compositeScores[prePandemicIdx];
            document.getElementById('prePandemicContext').textContent = `${prePandemicScore} (Dec 2019)`;
            
            // Cycle position
            const cycleEl = document.getElementById('cyclePosition');
            if (currentScore >= 70) {
                cycleEl.textContent = 'Favoring workers';
            } else if (currentScore >= 55) {
                cycleEl.textContent = 'Roughly balanced';
            } else if (currentScore >= 40) {
                cycleEl.textContent = 'Favoring employers';
            } else {
                cycleEl.textContent = 'Strongly favoring employers';
            }
            
            // Historical analog
            const analogEl = document.getElementById('historicalAnalog');
            let bestMatch = { idx: -1, diff: Infinity };
            const excludeStart = monthlyData.labels.indexOf('Mar-20');
            const excludeEnd = monthlyData.labels.indexOf('Dec-20');
            const recentCutoff = compositeScores.length - 12;
            
            compositeScores.forEach((score, idx) => {
                if (score === null) return;
                if (idx >= excludeStart && idx <= excludeEnd) return;
                if (idx >= recentCutoff) return;
                
                const scoreDiff = Math.abs(score - currentScore);
                if (scoreDiff < bestMatch.diff) {
                    bestMatch = { idx, diff: scoreDiff, score };
                }
            });
            
            if (bestMatch.idx >= 0 && bestMatch.diff <= 5) {
                analogEl.textContent = `${monthlyData.labels[bestMatch.idx]} (score: ${bestMatch.score})`;
            } else {
                analogEl.textContent = 'No close match';
            }

            // Recovery section
            const nextTierThreshold = currentScore >= 55 ? 70 : 55;
            const nextTierName = currentScore >= 55 ? 'Good Time to Move' : 'Worth Exploring';
            const distanceToTarget = Math.max(0, nextTierThreshold - currentScore);
            
            document.getElementById('recoveryTitle').textContent = `Path to "${nextTierName}"`;
            document.getElementById('distancePoints').textContent = distanceToTarget;

            // Score decomposition
            function getMetricScore(metric, value) {
                switch(metric) {
                    case 'quitRate': return Math.min(1, Math.max(0, (value - 1.5) / 1.5));
                    case 'openingsRatio': return Math.min(1, Math.max(0, (value - 0.3) / 1.7));
                    case 'hiresRate': return Math.min(1, Math.max(0, (value - 2.0) / 2.5));
                    case 'layoffsRate': return Math.min(1, Math.max(0, (2.5 - value) / 1.7));
                    case 'unempRate': return Math.min(1, Math.max(0, (7.0 - value) / 3.5));
                    case 'fedRate': return Math.min(1, Math.max(0, (5.5 - value) / 5.5));
                    case 'wageGrowth': return Math.min(1, Math.max(0, (value - 2.0) / 3.0));
                    case 'lfpr': return Math.min(1, Math.max(0, (value - 79) / 4.0));
                    default: return 0.5;
                }
            }
            
            function getScoreCategory(score) {
                if (score >= 0.7) return 'good';
                if (score >= 0.5) return 'neutral';
                if (score >= 0.3) return 'poor';
                return 'bad';
            }
            
            const metricDisplayNames = {
                quitRate: 'Quit Rate',
                openingsRatio: 'Jobs/Seeker',
                hiresRate: 'Hiring Rate',
                layoffsRate: 'Layoff Rate',
                unempRate: 'Unemployment',
                fedRate: 'Fed Rate',
                wageGrowth: 'Wage Growth',
                lfpr: 'Participation'
            };
            
            const metricScores = Object.entries(currentMetrics)
                .filter(([k, v]) => v != null)
                .map(([metric, value]) => ({
                    metric,
                    value,
                    score: getMetricScore(metric, value),
                    name: metricDisplayNames[metric]
                }))
                .sort((a, b) => a.score - b.score);
            
            const quitScoreVal = getMetricScore('quitRate', currentMetrics.quitRate);
            const hiresScoreVal = getMetricScore('hiresRate', currentMetrics.hiresRate);
            const isFrozenMarket = quitScoreVal < 0.5 && hiresScoreVal < 0.6;
            
            const decompositionEl = document.getElementById('decompositionList');
            decompositionEl.innerHTML = metricScores.map(m => {
                const isLayoffs = m.metric === 'layoffsRate';
                const showFootnote = isLayoffs && isFrozenMarket && m.score > 0.7;
                return `
                    <div class="decomposition-item">
                        <span class="metric-name">${m.name}${showFootnote ? ' <span class="footnote-marker">â€ </span>' : ''}</span>
                        <div class="metric-bar-container">
                            <div class="metric-bar ${getScoreCategory(m.score)}" style="width: ${m.score * 100}%"></div>
                        </div>
                        <span class="metric-score">${Math.round(m.score * 100)}</span>
                    </div>
                `;
            }).join('');
            
            if (isFrozenMarket) {
                decompositionEl.innerHTML += `
                    <div class="decomposition-footnote">
                        <span class="footnote-marker">â€ </span> Low layoffs in a "frozen" market (low quits + low hiring) provides less benefit than the score suggests. 
                        Employers aren't cutting, but they're also not hiringâ€”limited opportunities for job seekers.
                    </div>
                `;
            }

            // Trigger conditions
            const getRecentValues = (dataArray, count = 3) => {
                const values = [];
                for (let i = 0; i < count && (currentIdx - i) >= 0; i++) {
                    const val = dataArray[currentIdx - i];
                    if (val != null) values.push(val);
                }
                return values;
            };
            
            const getTrend = (values) => {
                if (values.length < 2) return { arrow: 'â†’', direction: 'flat' };
                const recent = values[0];
                const older = values[values.length - 1];
                const diff = recent - older;
                const threshold = Math.abs(older) * 0.05;
                
                if (diff > threshold) return { arrow: 'â†‘', direction: 'up' };
                if (diff < -threshold) return { arrow: 'â†“', direction: 'down' };
                return { arrow: 'â†’', direction: 'flat' };
            };
            
            const formatTrendHistory = (values, decimals = 2) => {
                return values.slice(0, 3).reverse().map(v => v.toFixed(decimals)).join(' â†’ ');
            };
            
            const triggers = [
                {
                    condition: 'Quit rate rises above 2.3% for 3+ months',
                    current: currentMetrics.quitRate,
                    target: 2.3,
                    recentValues: getRecentValues(monthlyData.quitRate),
                    decimals: 1,
                    goodDirection: 'up',
                    status: currentMetrics.quitRate > 2.3 ? 'met' : 
                            currentMetrics.quitRate > 2.1 ? 'watching' : ''
                },
                {
                    condition: 'Jobs per seeker rises above 1.1',
                    current: currentMetrics.openingsRatio,
                    target: 1.1,
                    recentValues: getRecentValues(monthlyData.openingsRatio),
                    decimals: 2,
                    goodDirection: 'up',
                    status: currentMetrics.openingsRatio > 1.1 ? 'met' :
                            currentMetrics.openingsRatio > 1.0 ? 'watching' : ''
                },
                {
                    condition: 'Hiring rate rises above 3.5%',
                    current: currentMetrics.hiresRate,
                    target: 3.5,
                    recentValues: getRecentValues(monthlyData.hiresRate),
                    decimals: 1,
                    goodDirection: 'up',
                    status: currentMetrics.hiresRate > 3.5 ? 'met' :
                            currentMetrics.hiresRate > 3.3 ? 'watching' : ''
                },
                {
                    condition: 'Fed rate drops below 3.0%',
                    current: currentMetrics.fedRate,
                    target: 3.0,
                    recentValues: getRecentValues(monthlyData.fedRate),
                    decimals: 2,
                    goodDirection: 'down',
                    status: currentMetrics.fedRate < 3.0 ? 'met' :
                            currentMetrics.fedRate < 3.5 ? 'watching' : ''
                }
            ];
            
            const triggerEl = document.getElementById('triggerList');
            triggerEl.innerHTML = triggers.map(t => {
                const icon = t.status === 'met' ? 'âœ“' : t.status === 'watching' ? 'â—' : 'â—‹';
                const trend = getTrend(t.recentValues);
                const trendIsGood = (trend.direction === t.goodDirection) || 
                                   (trend.direction === 'flat' && t.status === 'met');
                const trendClass = trendIsGood ? 'trend-good' : 
                                  trend.direction === 'flat' ? 'trend-flat' : 'trend-bad';
                const trendHistory = formatTrendHistory(t.recentValues, t.decimals);
                
                const statusText = t.status === 'met' ? 'Condition met' :
                                  t.status === 'watching' ? 'Getting close' :
                                  `Current: ${t.current.toFixed(t.decimals)}`;
                return `
                    <div class="trigger-item ${t.status}">
                        <span class="trigger-icon">${icon}</span>
                        <div class="trigger-content">
                            <div class="trigger-condition">${t.condition}</div>
                            <div class="trigger-status">${statusText}</div>
                            <div class="trigger-trend ${trendClass}">
                                <span class="trend-arrow">${trend.arrow}</span>
                                <span class="trend-history">Last 3 months: ${trendHistory}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Recovery summary
            const triggerAnalysis = triggers.map(t => {
                const trend = getTrend(t.recentValues);
                const trendIsGood = trend.direction === t.goodDirection;
                const trendIsBad = trend.direction !== 'flat' && !trendIsGood;
                return { ...t, trend, trendIsGood, trendIsBad };
            });
            
            const metConditions = triggerAnalysis.filter(t => t.status === 'met');
            const improvingConditions = triggerAnalysis.filter(t => t.trendIsGood);
            const worseningConditions = triggerAnalysis.filter(t => t.trendIsBad);
            
            let summaryParts = [];
            
            if (metConditions.length >= 3) {
                summaryParts.push(`<strong>Recovery signals strengthening.</strong> ${metConditions.length} of 4 conditions now met.`);
            } else if (metConditions.length >= 2) {
                summaryParts.push(`<strong>Early signs of improvement.</strong> ${metConditions.length} of 4 conditions metâ€”worth watching.`);
            } else if (improvingConditions.length >= 2) {
                summaryParts.push(`<strong>Some positive movement.</strong> No trigger conditions met yet, but trends bear watching.`);
            } else if (worseningConditions.length >= 3) {
                summaryParts.push(`<strong>Conditions weakening.</strong> Most indicators moving in the wrong direction.`);
            } else {
                summaryParts.push(`<strong>Holding pattern.</strong> No trigger conditions met, limited momentum in either direction.`);
            }
            
            if (improvingConditions.length > 0) {
                const names = improvingConditions.map(t => {
                    if (t.condition.includes('Quit')) return 'quit rate';
                    if (t.condition.includes('Jobs')) return 'jobs ratio';
                    if (t.condition.includes('Hiring')) return 'hiring';
                    if (t.condition.includes('Fed')) return 'Fed rate';
                    return '';
                }).filter(n => n);
                if (names.length) summaryParts.push(`<span class="trend-positive">â†‘ Improving:</span> ${names.join(', ')}.`);
            }
            
            if (worseningConditions.length > 0) {
                const names = worseningConditions.map(t => {
                    if (t.condition.includes('Quit')) return 'quit rate';
                    if (t.condition.includes('Jobs')) return 'jobs ratio';
                    if (t.condition.includes('Hiring')) return 'hiring';
                    if (t.condition.includes('Fed')) return 'Fed rate';
                    return '';
                }).filter(n => n);
                if (names.length) summaryParts.push(`<span class="trend-negative">â†“ Worsening:</span> ${names.join(', ')}.`);
            }
            
            document.getElementById('recoverySummary').innerHTML = summaryParts.join(' ');

            // Sensitivity analysis
            function calculateHypotheticalScore(overrides) {
                const metrics = { ...currentMetrics, ...overrides };
                
                const quitScore = Math.min(1, Math.max(0, (metrics.quitRate - 1.5) / 1.5));
                const ratioScore = Math.min(1, Math.max(0, (metrics.openingsRatio - 0.3) / 1.7));
                const hiresScore = Math.min(1, Math.max(0, (metrics.hiresRate - 2.0) / 2.5));
                const layoffsScore = Math.min(1, Math.max(0, (2.5 - metrics.layoffsRate) / 1.7));
                const unempScore = Math.min(1, Math.max(0, (7.0 - metrics.unempRate) / 3.5));
                const fedScore = Math.min(1, Math.max(0, (5.5 - metrics.fedRate) / 5.5));
                const wageScore = Math.min(1, Math.max(0, (metrics.wageGrowth - 2.0) / 3.0));
                const lfprScore = Math.min(1, Math.max(0, (metrics.lfpr - 79) / 4.0));
                
                const tier1 = (quitScore + ratioScore + hiresScore + layoffsScore) / 4 * 0.6;
                const tier2 = (unempScore + fedScore + wageScore + lfprScore) / 4 * 0.4;
                
                let baseScore = (tier1 + tier2) * 100;
                
                if (metrics.openingsRatio < 1.0) baseScore *= 0.92;
                const churnPenalty = 0.12 * (1 - Math.min(quitScore, hiresScore));
                baseScore *= (1 - churnPenalty);
                if (metrics.fedRate < 0.5) baseScore *= 1.08;
                
                return Math.min(100, Math.round(baseScore));
            }
            
            const scenarios = [
                {
                    name: 'Quit rate rises to 2.3%',
                    score: calculateHypotheticalScore({ quitRate: 2.3 })
                },
                {
                    name: 'Jobs per seeker returns to 1.1',
                    score: calculateHypotheticalScore({ openingsRatio: 1.1 })
                },
                {
                    name: 'Fed cuts rates to 2.5%',
                    score: calculateHypotheticalScore({ fedRate: 2.5 })
                },
                {
                    name: 'Hiring rate recovers to 3.6%',
                    score: calculateHypotheticalScore({ hiresRate: 3.6 })
                },
                {
                    name: 'Combined: Quit 2.3% + Ratio 1.1',
                    score: calculateHypotheticalScore({ quitRate: 2.3, openingsRatio: 1.1 })
                }
            ];
            
            const sensitivityEl = document.getElementById('sensitivityList');
            sensitivityEl.innerHTML = scenarios.map(s => {
                const delta = s.score - currentScore;
                const deltaStr = delta >= 0 ? `+${delta}` : `${delta}`;
                const category = s.score >= 55 ? 'positive' : s.score >= 48 ? 'neutral' : 'negative';
                const reachesTarget = s.score >= nextTierThreshold ? ` â†’ ${nextTierName}` : '';
                return `
                    <div class="sensitivity-item">
                        <span class="sensitivity-scenario">${s.name}</span>
                        <span class="sensitivity-result ${category}">Score: ${s.score} (${deltaStr})${reachesTarget}</span>
                    </div>
                `;
            }).join('');

            // Charts
            Chart.defaults.color = '#9898a8';
            Chart.defaults.font.family = "'JetBrains Mono', monospace";
            Chart.defaults.font.size = 10;

            // Main chart
            const mainCtx = document.getElementById('mainChart').getContext('2d');
            new Chart(mainCtx, {
                type: 'line',
                data: {
                    labels: monthlyData.labels,
                    datasets: [{
                        label: 'Score',
                        data: compositeScores,
                        borderColor: 'rgba(255, 201, 64, 1)',
                        segment: {
                            borderColor: ctx => {
                                const val = ctx.p0.parsed.y;
                                if (val >= 70) return 'rgba(0, 217, 160, 1)';
                                if (val >= 55) return 'rgba(255, 201, 64, 1)';
                                if (val >= 40) return 'rgba(255, 140, 64, 1)';
                                return 'rgba(255, 77, 106, 1)';
                            }
                        },
                        backgroundColor: function(context) {
                            const chart = context.chart;
                            const {ctx, chartArea} = chart;
                            if (!chartArea) return 'rgba(255, 201, 64, 0.05)';
                            const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
                            gradient.addColorStop(0, 'rgba(255, 77, 106, 0.08)');
                            gradient.addColorStop(0.4, 'rgba(255, 140, 64, 0.08)');
                            gradient.addColorStop(0.55, 'rgba(255, 201, 64, 0.08)');
                            gradient.addColorStop(0.7, 'rgba(0, 217, 160, 0.08)');
                            return gradient;
                        },
                        fill: true,
                        tension: 0.3,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointHoverBackgroundColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(22, 22, 32, 0.95)',
                            titleColor: '#e8e8ed',
                            bodyColor: '#9898a8',
                            borderColor: '#28283a',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                title: (items) => items[0].label,
                                label: (item) => {
                                    const score = item.raw;
                                    let status = 'Tough Market';
                                    if (score >= 70) status = 'Good Time to Move';
                                    else if (score >= 55) status = 'Worth Exploring';
                                    else if (score >= 40) status = 'Build Your Position';
                                    return [`Score: ~${score}`, `${status}`];
                                }
                            }
                        },
                        annotation: {
                            annotations: {
                                line70: { type: 'line', yMin: 70, yMax: 70, borderColor: 'rgba(0, 217, 160, 0.3)', borderWidth: 1, borderDash: [5, 5] },
                                line55: { type: 'line', yMin: 55, yMax: 55, borderColor: 'rgba(255, 201, 64, 0.3)', borderWidth: 1, borderDash: [5, 5] },
                                line40: { type: 'line', yMin: 40, yMax: 40, borderColor: 'rgba(255, 140, 64, 0.3)', borderWidth: 1, borderDash: [5, 5] }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255,255,255,0.04)', drawBorder: false },
                            ticks: { maxTicksLimit: 12, maxRotation: 0 }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            grid: { color: 'rgba(255,255,255,0.04)', drawBorder: false },
                            ticks: { stepSize: 20 }
                        }
                    }
                }
            });

            // Sparklines with min/max range labels
            function createSparkline(canvasId, dataArray, metric, rangeId) {
                const ctx = document.getElementById(canvasId).getContext('2d');
                const thresholds = {
                    quitRate: { good: 2.5, neutral: 2.0 },
                    openingsRatio: { good: 1.2, neutral: 1.0 },
                    hiresRate: { good: 3.8, neutral: 3.4 },
                    layoffsRate: { good: 1.0, neutral: 1.3, inverted: true },
                    unempRate: { good: 4.0, neutral: 4.5, inverted: true },
                    fedRate: { good: 2.5, neutral: 4.0, inverted: true },
                    wageGrowth: { good: 4.0, neutral: 3.0 },
                    lfpr: { good: 83.0, neutral: 82.0 }
                };
                
                // Calculate and display min/max range
                const validData = dataArray.filter(v => v != null && !isNaN(v));
                const minVal = Math.min(...validData);
                const maxVal = Math.max(...validData);
                
                // Format based on metric type
                const formatValue = (val) => {
                    if (metric === 'openingsRatio') return val.toFixed(1);
                    if (metric === 'lfpr') return val.toFixed(0);
                    return val.toFixed(1);
                };
                
                // Populate range labels
                if (rangeId) {
                    const rangeEl = document.getElementById(rangeId);
                    if (rangeEl) {
                        rangeEl.querySelector('.max').textContent = formatValue(maxVal);
                        rangeEl.querySelector('.min').textContent = formatValue(minVal);
                    }
                }
                
                const getColor = (val) => {
                    const t = thresholds[metric];
                    if (!t) return 'rgba(255, 201, 64, 1)';
                    if (t.inverted) {
                        if (val <= t.good) return 'rgba(0, 217, 160, 1)';
                        if (val <= t.neutral) return 'rgba(255, 201, 64, 1)';
                        return 'rgba(255, 77, 106, 1)';
                    } else {
                        if (val >= t.good) return 'rgba(0, 217, 160, 1)';
                        if (val >= t.neutral) return 'rgba(255, 201, 64, 1)';
                        return 'rgba(255, 77, 106, 1)';
                    }
                };
                
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: monthlyData.labels,
                        datasets: [{
                            data: dataArray,
                            borderColor: 'rgba(255, 201, 64, 1)',
                            segment: {
                                borderColor: ctx => getColor(ctx.p0.parsed.y)
                            },
                            backgroundColor: 'rgba(255, 255, 255, 0.03)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0,
                            borderWidth: 1.5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false }, tooltip: { enabled: false } },
                        scales: { x: { display: false }, y: { display: false } }
                    }
                });
            }

            createSparkline('quitChart', monthlyData.quitRate, 'quitRate', 'quitRange');
            createSparkline('openingsChart', monthlyData.openingsRatio, 'openingsRatio', 'ratioRange');
            createSparkline('hiresChart', monthlyData.hiresRate, 'hiresRate', 'hiresRange');
            createSparkline('layoffsChart', monthlyData.layoffsRate, 'layoffsRate', 'layoffsRange');
            createSparkline('unempChart', monthlyData.unempRate.map(v => v || 0), 'unempRate', 'unempRange');
            createSparkline('fedChart', monthlyData.fedRate, 'fedRate', 'fedRange');
            createSparkline('wageChart', monthlyData.wageGrowth.map(v => v || 0), 'wageGrowth', 'wageRange');
            createSparkline('lfprChart', monthlyData.lfpr.map(v => v || 0), 'lfpr', 'lfprRange');

            // Remove loading state - reveal all content
            document.body.classList.remove('js-loading');
        }

        // Initialize
        initDashboard();
    </script>
</body>
</html>
